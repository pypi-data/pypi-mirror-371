"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[2123,2298,7211,7667],{2756:(t,e,s)=>{s.r(e),s.d(e,{ABCComponent:()=>c,Labeled:()=>d,LeafComponentBase:()=>_,LeafComponentDelayedValue:()=>m,LeafComponentInput:()=>g,LeafComponentInputChoices:()=>f,maintainTableWidth:()=>p,name:()=>u});var i=s(5247),n=s(7881),l=s.n(n),o=s(6606),a=s(1151),r=s(3748);const u="LinoComponentUtils";let h;h={classNames:s.e(4166).then(s.t.bind(s,8041,23)),prDropdown:Promise.all([s.e(7134),s.e(5573),s.e(7236),s.e(4600),s.e(4292),s.e(3454),s.e(5350)]).then(s.bind(s,5384)),prInputText:Promise.all([s.e(9109),s.e(5573),s.e(7236),s.e(4600),s.e(2123)]).then(s.bind(s,8016)),queryString:Promise.all([s.e(4166),s.e(2298)]).then(s.bind(s,9320)),u:Promise.resolve().then(s.bind(s,1367))};function p(t,e){let s;s=void 0!==t?t:this;let i=Object.keys(s.flexs);(void 0!==e?i.length===e:i.length>1)&&i.forEach((t=>{var e=document.getElementById(t).getElementsByClassName("p-datatable");if(1===e.length){(e=e[0]).getBoundingClientRect().width/document.getElementsByClassName("layout-topbar")[0].getBoundingClientRect().width>s.flexs[t]&&Array.from(e.querySelectorAll(".p-datatable table")).forEach((t=>{Array.from(t.classList).join(" ").includes("p-datatable")&&t.style.setProperty("table-layout","auto")}))}}))}(0,o.RegisterImportPool)(h);const d=({actions:t=[],label:e,elem:s,children:n,hide_label:l=!1,isFilled:a=!1})=>{const u=(0,o.getExReady)(h,["classNames"]);return e=e||s.label,u.ready?(0,r.jsxs)(i.Fragment,{children:[!l&&e&&(0,r.jsxs)(i.Fragment,{children:[(0,r.jsxs)("label",{className:u.classNames.default("l-label","l-span-clickable",{"l-label--unfilled":!a}),title:Object.assign({},s.value||{}).quicktip||s.help_text,children:[e,t.map(((t,e)=>(0,r.jsxs)(i.Fragment,{children:[" | ",(0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:t}})]},e))),":"]}),(0,r.jsx)("br",{})]}),n]}):null};d.propTypes={actions:l().array,label:l().string,elem:l().object.isRequired,hide_label:l().bool,isFilled:l().bool,children:l().element.isRequired};class c{static getValueByName({name:t,props:e,context:s}){return e[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_PARAMS?s.param_values[t]:e[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_TABLE?s.rows[e.column.rowIndex][t]:e[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_CARDS?s[t]:s.data[t]}}class _ extends o.Component{constructor(t,e){super(t,e),this.filled=()=>!["",null,void 0].includes(this.getValue()),this.wrapperClasses=[],this.dataKey=t[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_TABLE?t.elem.fields_index:t.elem.name,this.upController=t.urlParams.controller,this.c=t.urlParams.controller,this.filled=this.filled.bind(this),this.getValue=this.getValue.bind(this),this.getValueByName=this.getValueByName.bind(this),this.innerHTML=this.innerHTML.bind(this),this.setLeafRef=this.setLeafRef.bind(this)}getValueByName(t){return c.getValueByName({name:t,props:this.props,context:this.context})}getValue(){return this.getValueByName(this.dataKey)}innerHTML(t,e={}){let s=this.getValue()||" ";return s instanceof Object&&(s=JSON.stringify(s)),t?(0,r.jsx)("div",{style:e,dangerouslySetInnerHTML:{__html:s}}):(0,r.jsx)("div",{style:e,children:s})}setLeafRef({input:t=!1,type:e=""}={}){if(this.props[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_DETAIL||this.props[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_INSERT){this.upController.dataContext.setLeafRef({name:"slave"===e?this.actorID:this.props.elem.name,ref:this,input:t,type:e});const{controller:s}=this.props.urlParams;s.onLeafMount()}}}_.requiredModules=["classNames"],_.iPool=h,_.contextType=o.DataContextType,_.propTypesFromLinoLayout={column:l().object,editing_mode:l().bool,hide_label:l().bool,[a.URL_PARAM_WINDOW_TYPE]:l().oneOf([a.WINDOW_TYPE_TABLE,a.WINDOW_TYPE_DETAIL,a.WINDOW_TYPE_CARDS,a.WINDOW_TYPE_GALLERIA,a.WINDOW_TYPE_INSERT,a.WINDOW_TYPE_PARAMS,a.WINDOW_TYPE_UNKNOWN]),tabIndex:l().number.isRequired},_.propTypes={..._.propTypesFromLinoLayout,elem:l().object.isRequired,urlParams:l().object.isRequired},_.defaultProps={editing_mode:!1,hide_label:!1,[a.URL_PARAM_WINDOW_TYPE]:a.WINDOW_TYPE_UNKNOWN};class m extends _{constructor(t,e){super(t,e),this.liveUpdate=t=>{(null===t.mk||t.mk===this.state.mk&&t.mt===this.state.mt)&&this.update()};const s={};t.hasOwnContext||Object.assign(s,this.upController.actionHandler.masterRelateForSlave()),this.state={...this.state,value:null,data_url:null,...s},this.actorID=t.elem.actor_id||(t.elem.name.includes(".")?t.elem.name:`${t.urlParams.packId}.${t.elem.name}`),this.delayed=t.elem.delayed_value,this.shouldComponentUpdate=this.shouldComponentUpdate.bind(this),this.getData=this.getData.bind(this),this.getValue=this.getValue.bind(this),this.update=this.update.bind(this)}onReady(){let t=super.getValue();this.delayed?(this.props.hasOwnContext||this.setLeafRef({type:"slave"}),this.upController.globals.panels[this.actorID]=this,null!==t?this.getData(t.delayed_value_url):this.setState({value:" ",data_url:void 0})):this.setState({value:t})}shouldComponentUpdate(t,e,s){const i=super.getValue();let n;return n=this.delayed?this.state.value!==e.value||null!==this.state.value&&(i||{}).delayed_value_url!==this.state.data_url:this.state.value!==e.value,n}componentDidUpdate(t,e){const s=super.getValue();this.delayed?this.state.data_url!==(s||{}).delayed_value_url&&(this.setState({value:null}),null!==s?this.update():this.setState({value:" ",data_url:void 0})):this.setState({value:s})}componentWillUnmount(){delete this.upController.globals.panels[this.actorID]}getValue(){return this.state.value}getData(t){this.upController.actionHandler.silentFetch({path:`${t}?${this.ex.queryString.default.stringify(this.upController.actionHandler.getParams())}`}).then((e=>{this.setState({value:e.data,buttons:e.buttons,data_url:t})}))}update(){this.getData(super.getValue().delayed_value_url)}}m.requiredModules=["queryString"].concat(_.requiredModules),m.propTypes={..._.propTypes,hasOwnContext:l().bool.isRequired},m.defaultProps={..._.defaultProps,hasOwnContext:!1};class g extends _{constructor(t,e){super(t,e),this.state={...this.state,textSelected:!1},this.styleClasses=["disabled-input","l-card","unsaved-modification"],this.disabled=this.disabled.bind(this),this.filled=this.filled.bind(this),this.focus=this.focus.bind(this),this.getCellStyleClasses=this.getCellStyleClasses.bind(this),this.getLinoInput=this.getLinoInput.bind(this),this.onChangeUpdate=this.onChangeUpdate.bind(this),this.onInputRef=this.onInputRef.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onRef=this.onRef.bind(this),this.setCellStyle=this.setCellStyle.bind(this),this.submit=this.submit.bind(this),this.tabIndexMatch=this.tabIndexMatch.bind(this),this.update=this.update.bind(this)}async prepare(){this.inputState={inputComponent:this.ex.prInputText.InputText,inputOnly:!1,inputProps:{},onChangeUpdateAssert:t=>!0,postOnChange:t=>null},this.setLeafRef({input:!0})}disabled(){if(this.props[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_CARDS)return!0;if(this.props[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_PARAMS)return!1;if(!this.props.elem.editable)return!0;if(this.props[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_TABLE){let t=this.context.rows[this.props.column.rowIndex],e=t[t.length-1];return!(!e||!e.meta||e.phantom)&&(!!t[t.length-2]||(t[t.length-3][this.props.elem.name]||!1))}return!!this.context.data.disable_editing||(this.context.data.disabled_fields[this.props.elem.name]||!1)}findHTMLInputElement(t){return t.focusInput?t=t.focusInput:t.inputRef?t=t.inputRef.current:t.hasOwnProperty("getInput")&&(t=t.getInput()),t}select(t){const e=t=>{this.state.textSelected=!0,t.select()};t.select?e(t):(this.container&&(t=this.container.getElementsByTagName("input")[0]),t&&t.select&&e(t))}focus(){let t=this.findHTMLInputElement(this.inputEl);t&&t.focus&&(t.click(),this.select(t))}getCellStyleClasses(){let t=[];return this.props[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_TABLE?this.context.modifiedRows[this.props.column.rowIndex].includes(this.props.elem.fields_index)&&t.push("unsaved-modification"):(t.push("l-card"),this.props[a.URL_PARAM_WINDOW_TYPE]!==a.WINDOW_TYPE_CARDS&&(this.disabled()?t.push("disabled-input"):this.context.modified.includes(this.props.elem.name)&&t.push("unsaved-modification"))),t}getLinoInput(){return(0,r.jsx)(this.inputState.inputComponent,{onChange:t=>{this.inputState.onChangeUpdateAssert(t)&&(this.onChangeUpdate(t),this.inputState.postOnChange(t))},ref:this.onInputRef,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()||"",...this.inputState.inputProps})}onChangeUpdate(t){this.update({[this.dataKey]:t.target.value}),this.setState({})}onInputRef(t){if(t&&(t!=this.inputEl&&(this.focusDone=!1),this.inputEl=t,!this.focusDone)){let e=this.findHTMLInputElement(t);if(document.activeElement===e)return;this.tabIndexMatch()&&this.focus(),this.focusDone=!0}}onKeyDown(t){"Escape"===t.code&&this.props[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_DETAIL&&this.props.editing_mode&&this.ex.u.toggleEditingMode(this.props.urlParams)}onRef(t){const e=()=>{this.container.onclick=t=>{this.disabled()||(Object.assign(this.upController.globals,{currentInputRowIndex:Object.assign({rowIndex:0},this.props.column).rowIndex,currentInputTabIndex:this.props.tabIndex,currentInputWindowType:this.props[a.URL_PARAM_WINDOW_TYPE],currentInputAHRefName:this.upController.actionHandler.refName}),this.props[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_DETAIL&&(this.props.editing_mode?this.state.textSelected?this.setState({textSelected:!1}):this.select(this.findHTMLInputElement(this.inputEl)):this.upController.history.replaceState({editing_mode:!0})))}};t&&(this.container=t,this.props[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_TABLE?(this.container=t.closest("td"),e()):this.props[a.URL_PARAM_WINDOW_TYPE]!==a.WINDOW_TYPE_DETAIL&&this.props[a.URL_PARAM_WINDOW_TYPE]!==a.WINDOW_TYPE_INSERT||e()),this.setCellStyle(this.container)}setCellStyle(t){if(t){let e=this.getCellStyleClasses();this.styleClasses.forEach((e=>{t.classList.remove(e)})),e.forEach((e=>{t.classList.add(e)}))}}submit(){this.upController.actionHandler.submit({cellInfo:{rowIndex:this.props.column.rowIndex}})}tabIndexMatch(){return(this.props[a.URL_PARAM_WINDOW_TYPE]!==a.WINDOW_TYPE_TABLE||this.props.column.rowIndex===this.upController.globals.currentInputRowIndex)&&(this.props[a.URL_PARAM_WINDOW_TYPE]===this.upController.globals.currentInputWindowType&&this.upController.actionHandler.refName===this.upController.globals.currentInputAHRefName&&this.props.tabIndex===this.upController.globals.currentInputTabIndex)}update(t){this.upController.actionHandler.update({values:t,elem:this.props.elem,col:this.props.column,windowType:this.props[a.URL_PARAM_WINDOW_TYPE]})}render(t=this.props.hide_label){return this.state.ready?(this.container&&this.setCellStyle(this.container),(0,r.jsx)(d,{...this.props,actions:(this.context.field_actions||{})[this.props.elem.name]||[],hide_label:t||this.props.hide_label,elem:this.props.elem,isFilled:this.filled(),children:(0,r.jsx)("div",{className:this.ex.classNames.default(this.wrapperClasses),onKeyDown:this.onKeyDown,ref:this.onRef,children:this.inputState.inputOnly||this.props.editing_mode&&!this.disabled()?this.getLinoInput():this.innerHTML()})})):null}}g.requiredModules=["prInputText","u"].concat(_.requiredModules);class f extends g{constructor(t,e){super(t,e),this.onKeyDown=t=>{super.onKeyDown(t),"Enter"===t.key&&this.inputEl.getOverlay()&&t.stopPropagation()},this.wrapperClasses.push("l-ChoiceListFieldElement"),this.state={...this.state,hidden_value:null},this.dataKeyHidden=t[a.URL_PARAM_WINDOW_TYPE]===a.WINDOW_TYPE_TABLE?t.elem.fields_index_hidden:t.elem.name+"Hidden",this.getLinoInput=this.getLinoInput.bind(this),this.getValue=this.getValue.bind(this),this.innerHTML=this.innerHTML.bind(this)}getValue(){return{text:super.getValue(),value:this.getValueByName(this.dataKeyHidden)}}getLinoInput(){return(0,r.jsx)(this.ex.prDropdown.Dropdown,{autoFocus:!0,itemTemplate:t=>(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:t.text}}),onChange:t=>{t.originalEvent.ctrlKey||t.originalEvent.altKey||(this.update({[this.dataKey]:t.value||null,[this.dataKeyHidden]:t.value||null}),this.setState({}))},optionLabel:"text",options:this.options,showClear:this.props.elem.field_options.allowBlank,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue().value,valueTemplate:(t,e)=>t?(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:t.text}}):(0,r.jsx)("div",{children:" "})})}innerHTML(){let t=super.getValue()||" ";return(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:t}})}}f.requiredModules=["prDropdown"].concat(g.requiredModules)},2292:(t,e,s)=>{s.r(e),s.d(e,{TransInit:()=>r,default:()=>u});var i=s(1151),n=s(1884),l=s(8682),o=s(9974),a=s(6433);const r=(t,e)=>{const s=new l.A;s.addDetector({name:"LinoLanguageDetector",lookup:e=>t.value[i.URL_PARAM_USER_LANGUAGE],cacheUserLanguage(e,s){t.fillPlaceHolder(i.PARAM_TYPE_WINDOW,i.URL_PARAM_USER_LANGUAGE,e),t.history.replaceByType({[i.URL_PARAM_USER_LANGUAGE]:e},i.PARAM_TYPE_WINDOW,!1,!0)}}),n.Ay.use(o.A).use(s).use(a.initReactI18next).init({debug:!1,load:"languageOnly",fallbackLng:window.Lino.i18nFallbackLng,keySeparator:!1,interpolation:{escapeValue:!1},react:{useSuspense:!0},backend:{loadPath:"/static/react/locales/{{lng}}/{{ns}}.json"},detection:{order:["queryString","cookie","LinoLanguageDetector","localStorage"],lookupQuerystring:i.URL_PARAM_USER_LANGUAGE,lookupCookie:i.URL_PARAM_USER_LANGUAGE,lookupLocalStorage:i.URL_PARAM_USER_LANGUAGE,caches:["LinoLanguageDetector","localStorage","cookie"]}}),e(n.Ay)},u=n.Ay},8295:(t,e,s)=>{s.d(e,{I:()=>o});var i=s(5247),n=s(9074);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},l.apply(this,arguments)}var o=i.memo(i.forwardRef((function(t,e){var s=n.z.getPTI(t);return i.createElement("svg",l({ref:e,width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 14C5.61553 14 4.26215 13.5895 3.11101 12.8203C1.95987 12.0511 1.06266 10.9579 0.532846 9.67879C0.00303296 8.3997 -0.13559 6.99224 0.134506 5.63437C0.404603 4.2765 1.07129 3.02922 2.05026 2.05026C3.02922 1.07129 4.2765 0.404603 5.63437 0.134506C6.99224 -0.13559 8.3997 0.00303296 9.67879 0.532846C10.9579 1.06266 12.0511 1.95987 12.8203 3.11101C13.5895 4.26215 14 5.61553 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM7 1.16667C5.84628 1.16667 4.71846 1.50879 3.75918 2.14976C2.79989 2.79074 2.05222 3.70178 1.61071 4.76768C1.16919 5.83358 1.05367 7.00647 1.27876 8.13803C1.50384 9.26958 2.05941 10.309 2.87521 11.1248C3.69102 11.9406 4.73042 12.4962 5.86198 12.7212C6.99353 12.9463 8.16642 12.8308 9.23232 12.3893C10.2982 11.9478 11.2093 11.2001 11.8502 10.2408C12.4912 9.28154 12.8333 8.15373 12.8333 7C12.8333 5.45291 12.2188 3.96918 11.1248 2.87521C10.0308 1.78125 8.5471 1.16667 7 1.16667ZM4.66662 9.91668C4.58998 9.91704 4.51404 9.90209 4.44325 9.87271C4.37246 9.84333 4.30826 9.8001 4.2544 9.74557C4.14516 9.6362 4.0838 9.48793 4.0838 9.33335C4.0838 9.17876 4.14516 9.0305 4.2544 8.92113L6.17553 7L4.25443 5.07891C4.15139 4.96832 4.09529 4.82207 4.09796 4.67094C4.10063 4.51982 4.16185 4.37563 4.26872 4.26876C4.3756 4.16188 4.51979 4.10066 4.67091 4.09799C4.82204 4.09532 4.96829 4.15142 5.07887 4.25446L6.99997 6.17556L8.92106 4.25446C9.03164 4.15142 9.1779 4.09532 9.32903 4.09799C9.48015 4.10066 9.62434 4.16188 9.73121 4.26876C9.83809 4.37563 9.89931 4.51982 9.90198 4.67094C9.90464 4.82207 9.84855 4.96832 9.74551 5.07891L7.82441 7L9.74554 8.92113C9.85478 9.0305 9.91614 9.17876 9.91614 9.33335C9.91614 9.48793 9.85478 9.6362 9.74554 9.74557C9.69168 9.8001 9.62748 9.84333 9.55669 9.87271C9.4859 9.90209 9.40996 9.91704 9.33332 9.91668C9.25668 9.91704 9.18073 9.90209 9.10995 9.87271C9.03916 9.84333 8.97495 9.8001 8.9211 9.74557L6.99997 7.82444L5.07884 9.74557C5.02499 9.8001 4.96078 9.84333 4.88999 9.87271C4.81921 9.90209 4.74326 9.91704 4.66662 9.91668Z",fill:"currentColor"}))})));o.displayName="TimesCircleIcon"},1820:(t,e,s)=>{s.d(e,{Q:()=>o});var i=s(1684);function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,i=new Array(e);s<e;s++)i[s]=t[s];return i}function l(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o={DEFAULT_MASKS:{pint:/[\d]/,int:/[\d\-]/,pnum:/[\d\.]/,money:/[\d\.\s,]/,num:/[\d\-\.]/,hex:/[0-9a-f]/i,email:/[a-z0-9_\.\-@]/i,alpha:/[a-z_]/i,alphanum:/[a-z0-9_]/i},getRegex:function(t){return o.DEFAULT_MASKS[t]?o.DEFAULT_MASKS[t]:t},onBeforeInput:function(t,e,s){!s&&i.DV.isAndroid()&&this.validateKey(t,t.data,e)},onKeyPress:function(t,e,s){s||i.DV.isAndroid()||t.ctrlKey||t.altKey||t.metaKey||this.validateKey(t,t.key,e)},onPaste:function(t,e,s){if(!s){var i=this.getRegex(e);l(t.clipboardData.getData("text")).forEach((function(e){if(!i.test(e))return t.preventDefault(),!1}))}},validateKey:function(t,e,s){null!=e&&(e.length<=2&&(this.getRegex(s).test(e)||t.preventDefault()))},validate:function(t,e){var s=t.target.value,i=!0,n=this.getRegex(e);return s&&!n.test(s)&&(i=!1),i}}},2617:function(t,e,s){var i,n=this&&this.__createBinding||(Object.create?function(t,e,s,i){void 0===i&&(i=s);var n=Object.getOwnPropertyDescriptor(e,s);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,n)}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]}),l=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||(i=function(t){return i=Object.getOwnPropertyNames||function(t){var e=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[e.length]=s);return e},i(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s=i(t),o=0;o<s.length;o++)"default"!==s[o]&&n(e,t,s[o]);return l(e,t),e}),a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.QuickFilter=e.AutoComplete=e.name=void 0,e.name="AutoComplete";const r=a(s(5247)),u=a(s(7881)),h=s(6606),p=s(2756),d=o(s(1151));let c;c={queryString:Promise.resolve().then((()=>o(s(9320)))),prAutoComplete:Promise.resolve().then((()=>o(s(8282)))),AbortController:Promise.resolve().then((()=>o(s(1181)))),i18n:Promise.resolve().then((()=>o(s(2292))))};(0,h.RegisterImportPool)(c);class _ extends p.LeafComponentInput{constructor(t){super(t),this.onKeyDown=t=>{if(super.onKeyDown(t),["Enter","NumpadEnter"].includes(t.code)&&this.inputEl.getOverlay()&&t.stopPropagation(),["ArrowDown","ArrowUp"].includes(t.code)){if(this.inputEl&&!this.inputEl.getOverlay())this.state.rows.length||this.getChoices(this.state[d.URL_PARAM_FILTER]),this.inputEl.show();else if(!this.state.lazyLoading){let t=this.scroller.getElementRef().current.querySelector("li.p-highlight");if(t){let{top:e,bottom:s}=this.scroller.getElementRef().current.getBoundingClientRect(),i=t.getBoundingClientRect();i.top<e?t.scrollIntoView(!0):i.bottom>s&&t.scrollIntoView(!1)}}t.stopPropagation()}},this.itemTemplate=(t,e)=>{let s="object"==typeof t?t.text:t;return r.default.createElement("div",null,s||" ")},this.getChoices=(t,e)=>{this.controller.abort(),this.controller=new this.ex.AbortController.default;let s=(e=e||this.state[d.URL_PARAM_LIMIT])===this.state[d.URL_PARAM_LIMIT]?this.state[d.URL_PARAM_START]:this.state[d.URL_PARAM_LIMIT];this.upController.actionHandler.silentFetch({path:this.choicesURL(t,s,e),signal:this.controller.signal}).then((s=>{let i=s.rows;this.state.rows.length&&(i=i.filter((t=>""!==t.text&&null!==t.value))),i=this.state.rows.concat(i),(this.props.elem.field_options||{}).allowCreate&&0===i.filter((e=>e.text==t)).length&&i.unshift({text:t,value:t}),this.setState({[d.URL_PARAM_FILTER]:t,[d.URL_PARAM_LIMIT]:e,count:s.count,lazyLoading:!1,rows:i})}))},this.state={...this.state,count:999,[d.URL_PARAM_FILTER]:"",[d.URL_PARAM_LIMIT]:15,[d.URL_PARAM_START]:0,lazyLoading:!1,rows:[],value:null},this.hasClearButton=!1,this.getChoices=this.getChoices.bind(this),this.getLinoInput=this.getLinoInput.bind(this),this.itemTemplate=this.itemTemplate.bind(this),this.onKeyDown=this.onKeyDown.bind(this)}onReady(){if(this.hasClearButton&&!this.clear)throw Error("clear NotImplemented");let t=this.getValue();this.setState({[d.URL_PARAM_FILTER]:t.text,[d.URL_PARAM_LIMIT]:this.props.urlParams[d.URL_PARAM_LIMIT],value:t}),this.controller=new this.ex.AbortController.default}getLinoInput(t={}){return null===this.state.value?null:r.default.createElement(r.default.Fragment,null,r.default.createElement(this.ex.prAutoComplete.AutoComplete,{completeMethod:t=>{"click"===t.originalEvent.type&&this.state.rows.length?this.inputEl.show():(this.state.rows=[],this.getChoices(t.query,this.state[d.URL_PARAM_LIMIT]))},dropdown:!0,field:"text",itemTemplate:this.itemTemplate,onChange:t=>this.setState({value:Object.assign(this.state.value,{text:t.value,value:null}),rows:[],[d.URL_PARAM_LIMIT]:this.props.urlParams[d.URL_PARAM_LIMIT]}),onSelect:this.onSelect,onShow:()=>{this.clearButton&&(this.clearButton.style.visibility="hidden")},ref:this.onInputRef,scrollHeight:"200px",suggestions:this.state.rows,tabIndex:this.props.tabIndex,value:this.state.value.text,virtualScrollerOptions:{itemSize:35,lazy:!0,loading:this.state.lazyLoading,onScrollIndexChange:t=>{let e=this.state[d.URL_PARAM_LIMIT];e-t.first<15&&!this.state.lazyLoading&&this.state.count>e&&(this.setState({lazyLoading:!0}),this.getChoices(this.state[d.URL_PARAM_FILTER],e+15))},ref:t=>this.scroller=t,scrollHeight:"195px",style:{minWidth:"30ch"}},...t}),this.hasClearButton&&this.props.elem.field_options.allowBlank&&this.state.value.text&&r.default.createElement("i",{key:this.state.touch,ref:t=>this.clearButton=t,className:"pi pi-times l-fk-clear",onClick:this.clear,style:{visibility:"visible",cursor:"pointer"}}))}}e.AutoComplete=_,_.requiredModules=["prAutoComplete","AbortController"].concat(p.LeafComponentInput.requiredModules),_.iPool=Object.assign(c,p.LeafComponentInput.iPool.copy());class m extends _{async prepare(){await super.prepare(),this.ex.i18n=this.ex.i18n.default}constructor(t){super(t),this.wrapperClasses=["l-grid-quickfilter"],this.styleClasses=[],this.choicesURL=this.choicesURL.bind(this),this.getLinoInput=this.getLinoInput.bind(this),this.getValue=this.getValue.bind(this),this.onSelect=this.onSelect.bind(this)}getLinoInput(){return super.getLinoInput({placeholder:this.ex.i18n.t("Quick search"),style:{width:this.props.wide?"100%":void 0,marginRight:this.props.wide?"1ch":void 0,marginLeft:this.props.wide?"1ch":void 0}})}getValue(){return{text:this.props.urlParams[d.URL_PARAM_FILTER],value:null}}choicesURL(t,e,s){return`choices/${this.props.urlParams.packId}/${this.props.urlParams.actorId}?${this.ex.queryString.default.stringify(Object.assign(this.upController.actionHandler.defaultStaticParams(),{[d.URL_PARAM_FILTER]:t,[d.URL_PARAM_START]:e,[d.URL_PARAM_LIMIT]:s}))}`}onSelect(t){let e=t.value.value,s=this.upController;s.history.pushPath({pathname:`/api/${this.props.urlParams.packId}/${this.props.urlParams.actorId}/${e}`,params:s.actionHandler.defaultStaticParams()})}render(){return this.state.ready?this.getLinoInput():null}}e.QuickFilter=m,m.requiredModules=["queryString","i18n"].concat(_.requiredModules),m.propTypes={..._.propTypes,wide:u.default.bool},m.defaultProps={..._.defaultProps,editing_mode:!0,elem:{},tabIndex:0,wide:!1,[d.URL_PARAM_WINDOW_TYPE]:d.WINDOW_TYPE_UNKNOWN}},936:(t,e,s)=>{s.d(e,{A:()=>r});const i="%[a-f0-9]{2}",n=new RegExp("("+i+")|([^%]+?)","gi"),l=new RegExp("("+i+")+","gi");function o(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(1===t.length)return t;e=e||1;const s=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],o(s),o(i))}function a(t){try{return decodeURIComponent(t)}catch{let e=t.match(n)||[];for(let s=1;s<e.length;s++)e=(t=o(e,s).join("")).match(n)||[];return t}}function r(t){if("string"!=typeof t)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return decodeURIComponent(t)}catch{return function(t){const e={"%FE%FF":"��","%FF%FE":"��"};let s=l.exec(t);for(;s;){try{e[s[0]]=decodeURIComponent(s[0])}catch{const t=a(s[0]);t!==s[0]&&(e[s[0]]=t)}s=l.exec(t)}e["%C2"]="�";const i=Object.keys(e);for(const s of i)t=t.replace(new RegExp(s,"g"),e[s]);return t}(t)}}},7157:(t,e,s)=>{function i(t,e){const s={};if(Array.isArray(e))for(const i of e){const e=Object.getOwnPropertyDescriptor(t,i);e?.enumerable&&Object.defineProperty(s,i,e)}else for(const i of Reflect.ownKeys(t)){const n=Object.getOwnPropertyDescriptor(t,i);if(n.enumerable){e(i,t[i],t)&&Object.defineProperty(s,i,n)}}return s}s.d(e,{b:()=>i})},9274:(t,e,s)=>{function i(t,e){if("string"!=typeof t||"string"!=typeof e)throw new TypeError("Expected the arguments to be of type `string`");if(""===t||""===e)return[];const s=t.indexOf(e);return-1===s?[]:[t.slice(0,s),t.slice(s+e.length)]}s.d(e,{A:()=>i})}}]);
//# sourceMappingURL=main.AutoComplete_LinoToolbar.27a010af299085726591.js.map