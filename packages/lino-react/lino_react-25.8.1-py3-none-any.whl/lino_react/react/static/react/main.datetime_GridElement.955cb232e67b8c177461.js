"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[7681],{2756:(t,e,s)=>{s.r(e),s.d(e,{ABCComponent:()=>c,Labeled:()=>p,LeafComponentBase:()=>m,LeafComponentDelayedValue:()=>_,LeafComponentInput:()=>g,LeafComponentInputChoices:()=>I,maintainTableWidth:()=>u,name:()=>h});var i=s(5247),n=s(7881),l=s.n(n),a=s(6606),o=s(1151),r=s(3748);const h="LinoComponentUtils";let d;d={classNames:s.e(4166).then(s.t.bind(s,8041,23)),prDropdown:Promise.all([s.e(7134),s.e(5573),s.e(7236),s.e(4600),s.e(4292),s.e(3454),s.e(5350)]).then(s.bind(s,5384)),prInputText:Promise.all([s.e(9109),s.e(5573),s.e(7236),s.e(4600),s.e(2123)]).then(s.bind(s,8016)),queryString:Promise.all([s.e(4166),s.e(2298)]).then(s.bind(s,9320)),u:Promise.resolve().then(s.bind(s,1367))};function u(t,e){let s;s=void 0!==t?t:this;let i=Object.keys(s.flexs);(void 0!==e?i.length===e:i.length>1)&&i.forEach((t=>{var e=document.getElementById(t).getElementsByClassName("p-datatable");if(1===e.length){(e=e[0]).getBoundingClientRect().width/document.getElementsByClassName("layout-topbar")[0].getBoundingClientRect().width>s.flexs[t]&&Array.from(e.querySelectorAll(".p-datatable table")).forEach((t=>{Array.from(t.classList).join(" ").includes("p-datatable")&&t.style.setProperty("table-layout","auto")}))}}))}(0,a.RegisterImportPool)(d);const p=({actions:t=[],label:e,elem:s,children:n,hide_label:l=!1,isFilled:o=!1})=>{const h=(0,a.getExReady)(d,["classNames"]);return e=e||s.label,h.ready?(0,r.jsxs)(i.Fragment,{children:[!l&&e&&(0,r.jsxs)(i.Fragment,{children:[(0,r.jsxs)("label",{className:h.classNames.default("l-label","l-span-clickable",{"l-label--unfilled":!o}),title:Object.assign({},s.value||{}).quicktip||s.help_text,children:[e,t.map(((t,e)=>(0,r.jsxs)(i.Fragment,{children:[" | ",(0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:t}})]},e))),":"]}),(0,r.jsx)("br",{})]}),n]}):null};p.propTypes={actions:l().array,label:l().string,elem:l().object.isRequired,hide_label:l().bool,isFilled:l().bool,children:l().element.isRequired};class c{static getValueByName({name:t,props:e,context:s}){return e[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_PARAMS?s.param_values[t]:e[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?s.rows[e.column.rowIndex][t]:e[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_CARDS?s[t]:s.data[t]}}class m extends a.Component{constructor(t,e){super(t,e),this.filled=()=>!["",null,void 0].includes(this.getValue()),this.wrapperClasses=[],this.dataKey=t[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?t.elem.fields_index:t.elem.name,this.upController=t.urlParams.controller,this.c=t.urlParams.controller,this.filled=this.filled.bind(this),this.getValue=this.getValue.bind(this),this.getValueByName=this.getValueByName.bind(this),this.innerHTML=this.innerHTML.bind(this),this.setLeafRef=this.setLeafRef.bind(this)}getValueByName(t){return c.getValueByName({name:t,props:this.props,context:this.context})}getValue(){return this.getValueByName(this.dataKey)}innerHTML(t,e={}){let s=this.getValue()||" ";return s instanceof Object&&(s=JSON.stringify(s)),t?(0,r.jsx)("div",{style:e,dangerouslySetInnerHTML:{__html:s}}):(0,r.jsx)("div",{style:e,children:s})}setLeafRef({input:t=!1,type:e=""}={}){if(this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_DETAIL||this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_INSERT){this.upController.dataContext.setLeafRef({name:"slave"===e?this.actorID:this.props.elem.name,ref:this,input:t,type:e});const{controller:s}=this.props.urlParams;s.onLeafMount()}}}m.requiredModules=["classNames"],m.iPool=d,m.contextType=a.DataContextType,m.propTypesFromLinoLayout={column:l().object,editing_mode:l().bool,hide_label:l().bool,[o.URL_PARAM_WINDOW_TYPE]:l().oneOf([o.WINDOW_TYPE_TABLE,o.WINDOW_TYPE_DETAIL,o.WINDOW_TYPE_CARDS,o.WINDOW_TYPE_GALLERIA,o.WINDOW_TYPE_INSERT,o.WINDOW_TYPE_PARAMS,o.WINDOW_TYPE_UNKNOWN]),tabIndex:l().number.isRequired},m.propTypes={...m.propTypesFromLinoLayout,elem:l().object.isRequired,urlParams:l().object.isRequired},m.defaultProps={editing_mode:!1,hide_label:!1,[o.URL_PARAM_WINDOW_TYPE]:o.WINDOW_TYPE_UNKNOWN};class _ extends m{constructor(t,e){super(t,e),this.liveUpdate=t=>{(null===t.mk||t.mk===this.state.mk&&t.mt===this.state.mt)&&this.update()};const s={};t.hasOwnContext||Object.assign(s,this.upController.actionHandler.masterRelateForSlave()),this.state={...this.state,value:null,data_url:null,...s},this.actorID=t.elem.actor_id||(t.elem.name.includes(".")?t.elem.name:`${t.urlParams.packId}.${t.elem.name}`),this.delayed=t.elem.delayed_value,this.shouldComponentUpdate=this.shouldComponentUpdate.bind(this),this.getData=this.getData.bind(this),this.getValue=this.getValue.bind(this),this.update=this.update.bind(this)}onReady(){let t=super.getValue();this.delayed?(this.props.hasOwnContext||this.setLeafRef({type:"slave"}),this.upController.globals.panels[this.actorID]=this,null!==t?this.getData(t.delayed_value_url):this.setState({value:" ",data_url:void 0})):this.setState({value:t})}shouldComponentUpdate(t,e,s){const i=super.getValue();let n;return n=this.delayed?this.state.value!==e.value||null!==this.state.value&&(i||{}).delayed_value_url!==this.state.data_url:this.state.value!==e.value,n}componentDidUpdate(t,e){const s=super.getValue();this.delayed?this.state.data_url!==(s||{}).delayed_value_url&&(this.setState({value:null}),null!==s?this.update():this.setState({value:" ",data_url:void 0})):this.setState({value:s})}componentWillUnmount(){delete this.upController.globals.panels[this.actorID]}getValue(){return this.state.value}getData(t){this.upController.actionHandler.silentFetch({path:`${t}?${this.ex.queryString.default.stringify(this.upController.actionHandler.getParams())}`}).then((e=>{this.setState({value:e.data,buttons:e.buttons,data_url:t})}))}update(){this.getData(super.getValue().delayed_value_url)}}_.requiredModules=["queryString"].concat(m.requiredModules),_.propTypes={...m.propTypes,hasOwnContext:l().bool.isRequired},_.defaultProps={...m.defaultProps,hasOwnContext:!1};class g extends m{constructor(t,e){super(t,e),this.state={...this.state,textSelected:!1},this.styleClasses=["disabled-input","l-card","unsaved-modification"],this.disabled=this.disabled.bind(this),this.filled=this.filled.bind(this),this.focus=this.focus.bind(this),this.getCellStyleClasses=this.getCellStyleClasses.bind(this),this.getLinoInput=this.getLinoInput.bind(this),this.onChangeUpdate=this.onChangeUpdate.bind(this),this.onInputRef=this.onInputRef.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onRef=this.onRef.bind(this),this.setCellStyle=this.setCellStyle.bind(this),this.submit=this.submit.bind(this),this.tabIndexMatch=this.tabIndexMatch.bind(this),this.update=this.update.bind(this)}async prepare(){this.inputState={inputComponent:this.ex.prInputText.InputText,inputOnly:!1,inputProps:{},onChangeUpdateAssert:t=>!0,postOnChange:t=>null},this.setLeafRef({input:!0})}disabled(){if(this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_CARDS)return!0;if(this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_PARAMS)return!1;if(!this.props.elem.editable)return!0;if(this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE){let t=this.context.rows[this.props.column.rowIndex],e=t[t.length-1];return!(!e||!e.meta||e.phantom)&&(!!t[t.length-2]||(t[t.length-3][this.props.elem.name]||!1))}return!!this.context.data.disable_editing||(this.context.data.disabled_fields[this.props.elem.name]||!1)}findHTMLInputElement(t){return t.focusInput?t=t.focusInput:t.inputRef?t=t.inputRef.current:t.hasOwnProperty("getInput")&&(t=t.getInput()),t}select(t){const e=t=>{this.state.textSelected=!0,t.select()};t.select?e(t):(this.container&&(t=this.container.getElementsByTagName("input")[0]),t&&t.select&&e(t))}focus(){let t=this.findHTMLInputElement(this.inputEl);t&&t.focus&&(t.click(),this.select(t))}getCellStyleClasses(){let t=[];return this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?this.context.modifiedRows[this.props.column.rowIndex].includes(this.props.elem.fields_index)&&t.push("unsaved-modification"):(t.push("l-card"),this.props[o.URL_PARAM_WINDOW_TYPE]!==o.WINDOW_TYPE_CARDS&&(this.disabled()?t.push("disabled-input"):this.context.modified.includes(this.props.elem.name)&&t.push("unsaved-modification"))),t}getLinoInput(){return(0,r.jsx)(this.inputState.inputComponent,{onChange:t=>{this.inputState.onChangeUpdateAssert(t)&&(this.onChangeUpdate(t),this.inputState.postOnChange(t))},ref:this.onInputRef,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()||"",...this.inputState.inputProps})}onChangeUpdate(t){this.update({[this.dataKey]:t.target.value}),this.setState({})}onInputRef(t){if(t&&(t!=this.inputEl&&(this.focusDone=!1),this.inputEl=t,!this.focusDone)){let e=this.findHTMLInputElement(t);if(document.activeElement===e)return;this.tabIndexMatch()&&this.focus(),this.focusDone=!0}}onKeyDown(t){"Escape"===t.code&&this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_DETAIL&&this.props.editing_mode&&this.ex.u.toggleEditingMode(this.props.urlParams)}onRef(t){const e=()=>{this.container.onclick=t=>{this.disabled()||(Object.assign(this.upController.globals,{currentInputRowIndex:Object.assign({rowIndex:0},this.props.column).rowIndex,currentInputTabIndex:this.props.tabIndex,currentInputWindowType:this.props[o.URL_PARAM_WINDOW_TYPE],currentInputAHRefName:this.upController.actionHandler.refName}),this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_DETAIL&&(this.props.editing_mode?this.state.textSelected?this.setState({textSelected:!1}):this.select(this.findHTMLInputElement(this.inputEl)):this.upController.history.replaceState({editing_mode:!0})))}};t&&(this.container=t,this.props[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?(this.container=t.closest("td"),e()):this.props[o.URL_PARAM_WINDOW_TYPE]!==o.WINDOW_TYPE_DETAIL&&this.props[o.URL_PARAM_WINDOW_TYPE]!==o.WINDOW_TYPE_INSERT||e()),this.setCellStyle(this.container)}setCellStyle(t){if(t){let e=this.getCellStyleClasses();this.styleClasses.forEach((e=>{t.classList.remove(e)})),e.forEach((e=>{t.classList.add(e)}))}}submit(){this.upController.actionHandler.submit({cellInfo:{rowIndex:this.props.column.rowIndex}})}tabIndexMatch(){return(this.props[o.URL_PARAM_WINDOW_TYPE]!==o.WINDOW_TYPE_TABLE||this.props.column.rowIndex===this.upController.globals.currentInputRowIndex)&&(this.props[o.URL_PARAM_WINDOW_TYPE]===this.upController.globals.currentInputWindowType&&this.upController.actionHandler.refName===this.upController.globals.currentInputAHRefName&&this.props.tabIndex===this.upController.globals.currentInputTabIndex)}update(t){this.upController.actionHandler.update({values:t,elem:this.props.elem,col:this.props.column,windowType:this.props[o.URL_PARAM_WINDOW_TYPE]})}render(t=this.props.hide_label){return this.state.ready?(this.container&&this.setCellStyle(this.container),(0,r.jsx)(p,{...this.props,actions:(this.context.field_actions||{})[this.props.elem.name]||[],hide_label:t||this.props.hide_label,elem:this.props.elem,isFilled:this.filled(),children:(0,r.jsx)("div",{className:this.ex.classNames.default(this.wrapperClasses),onKeyDown:this.onKeyDown,ref:this.onRef,children:this.inputState.inputOnly||this.props.editing_mode&&!this.disabled()?this.getLinoInput():this.innerHTML()})})):null}}g.requiredModules=["prInputText","u"].concat(m.requiredModules);class I extends g{constructor(t,e){super(t,e),this.onKeyDown=t=>{super.onKeyDown(t),"Enter"===t.key&&this.inputEl.getOverlay()&&t.stopPropagation()},this.wrapperClasses.push("l-ChoiceListFieldElement"),this.state={...this.state,hidden_value:null},this.dataKeyHidden=t[o.URL_PARAM_WINDOW_TYPE]===o.WINDOW_TYPE_TABLE?t.elem.fields_index_hidden:t.elem.name+"Hidden",this.getLinoInput=this.getLinoInput.bind(this),this.getValue=this.getValue.bind(this),this.innerHTML=this.innerHTML.bind(this)}getValue(){return{text:super.getValue(),value:this.getValueByName(this.dataKeyHidden)}}getLinoInput(){return(0,r.jsx)(this.ex.prDropdown.Dropdown,{autoFocus:!0,itemTemplate:t=>(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:t.text}}),onChange:t=>{t.originalEvent.ctrlKey||t.originalEvent.altKey||(this.update({[this.dataKey]:t.value||null,[this.dataKeyHidden]:t.value||null}),this.setState({}))},optionLabel:"text",options:this.options,showClear:this.props.elem.field_options.allowBlank,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue().value,valueTemplate:(t,e)=>t?(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:t.text}}):(0,r.jsx)("div",{children:" "})})}innerHTML(){let t=super.getValue()||" ";return(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:t}})}}I.requiredModules=["prDropdown"].concat(g.requiredModules)},6415:(t,e,s)=>{s.r(e),s.d(e,{DateFieldElement:()=>p,DateFilter:()=>m,TimeFieldElement:()=>c,name:()=>h});s(5247);var i=s(7881),n=s.n(i),l=s(1151),a=s(2756),o=s(6606),r=s(3748);const h="datetime";let d;d={prCalendar:Promise.all([s.e(8026),s.e(9109),s.e(1927),s.e(5573),s.e(7236),s.e(4600),s.e(4292),s.e(8065)]).then(s.bind(s,7698))};(0,o.RegisterImportPool)(d);class u extends a.LeafComponentInput{constructor(t){super(t),this.innerHTML=()=>(0,r.jsx)("div",{children:super.getValue()||" "}),this.isValid=t=>null===t||t instanceof Date||this.str2date(t)instanceof Date,this.getLinoInput=this.getLinoInput.bind(this),this.getValue=this.getValue.bind(this),this.innerHTML=this.innerHTML.bind(this),this.isValid=this.isValid.bind(this),this.updateValue=this.updateValue.bind(this)}getLinoInput(t={}){return(0,r.jsx)(this.ex.prCalendar.Calendar,{...t,className:"l-DateFieldElement",inputMode:this.props.urlParams.controller.globals.isMobile?"numeric":"none",inputStyle:{width:"100%"},keepInvalid:!0,onChange:t=>this.updateValue(t),onClearButtonClick:t=>{t.value=null,this.updateValue(t)},ref:this.onInputRef,showButtonBar:!0,showIcon:this.props[l.URL_PARAM_WINDOW_TYPE]!==l.WINDOW_TYPE_TABLE,showOnFocus:!1,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()})}getValue(){let t=super.getValue();return this.props.urlParams.controller.filled(t)?this.str2date(t):null}updateValue(t){let e=t.value;this.props.urlParams.controller.filled(e)?e instanceof Date&&(e=this.date2str(e)):e=null,this.container.classList.remove("dangling-modification"),this.container.classList.remove("unsaved-modification"),this.isValid(e)?(this.update({[this.dataKey]:e}),this.setCellStyle(this.container)):this.container.classList.add("dangling-modification")}}u.requiredModules=["prCalendar"].concat(a.LeafComponentInput.requiredModules),u.iPool=Object.assign(d,a.LeafComponentInput.iPool.copy());class p extends u{constructor(t){super(t),this.getLinoInput=()=>super.getLinoInput({dateFormat:"dd.mm.yy",yearNavigator:!0,yearRange:"1900:2900"}),this.date2str=this.date2str.bind(this),this.getLinoInput=this.getLinoInput.bind(this),this.str2date=this.str2date.bind(this)}date2str(t){return("0"+t.getDate()).slice(-2)+"."+("0"+(t.getMonth()+1)).slice(-2)+"."+t.getFullYear()}str2date(t){let e=t.split(".");return 3===e.length&&!e.includes("")&&4===e[2].length&&new Date(e[2],e[1]-1,e[0])}}class c extends u{constructor(t){super(t),this.getLinoInput=()=>super.getLinoInput({hourFormat:"24",showTime:!0,timeOnly:!0}),this.date2str=this.date2str.bind(this),this.getLinoInput=this.getLinoInput.bind(this),this.str2date=this.str2date.bind(this)}date2str(t){return("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)}str2date(t){let e=/^(\d(?:\d(?=[.,:; ]?\d\d|[.,:; ]\d|$))?)?[.,:; ]?(\d{0,2})$/g;if(t.match(e)){let s=e.exec(t),i=new Date,n=s[1],l=s[2];return i.setHours(n||0),i.setMinutes(l||0),i}return!1}}class m extends p{constructor(t){super(t),this.filled=()=>this.props.parent.context.controller.filled(this.props.value),this.disabled=()=>!1,this.update=t=>this.props.parent.pushFilter({value:t[this.dataKey]}),this.disabled=this.disabled.bind(this),this.filled=this.filled.bind(this),this.getValue=this.getValue.bind(this),this.update=this.update.bind(this)}getValue(){return this.filled()?this.str2date(this.props.parent.state.value):null}}m.propTypes={parent:n().object.isRequired},m.defaultProps={editing_mode:!0,hide_label:!0}}}]);
//# sourceMappingURL=main.datetime_GridElement.955cb232e67b8c177461.js.map