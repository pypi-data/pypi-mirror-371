"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[8923],{6511:(t,e,n)=>{n.r(e),n.d(e,{LayoutButton:()=>E,LinoToolbar:()=>I,name:()=>m});var i=n(5072),o=n.n(i),r=n(7825),l=n.n(r),a=n(7659),s=n.n(a),c=n(5056),d=n.n(c),h=n(540),p=n.n(h),u=n(1113),_=n.n(u),A=n(8462),x={};x.styleTagTransform=_(),x.setAttributes=d(),x.insert=s().bind(null,"head"),x.domAPI=l(),x.insertStyleElement=p();o()(A.A,x);A.A&&A.A.locals&&A.A.locals;var D=n(5247),L=n(1151),S=n(6606),b=n(3748);const m="LinoToolbar";let P;P={AbortController:n.e(4166).then(n.t.bind(n,1181,23)),prButton:Promise.all([n.e(1927),n.e(5573),n.e(7236),n.e(4600),n.e(7801)]).then(n.bind(n,6286)),prInputText:Promise.all([n.e(9109),n.e(5573),n.e(7236),n.e(4600),n.e(2123)]).then(n.bind(n,8016)),prOverlayPanel:Promise.all([n.e(6190),n.e(5573),n.e(7236),n.e(4292),n.e(3618)]).then(n.bind(n,6014)),prMultiSelect:Promise.all([n.e(9109),n.e(5573),n.e(7236),n.e(4600),n.e(4292),n.e(3454),n.e(7529)]).then(n.bind(n,1496)),prSelectButton:Promise.all([n.e(7134),n.e(5573),n.e(7236),n.e(4600),n.e(8320)]).then(n.bind(n,4598)),prSplitButton:Promise.all([n.e(6190),n.e(1927),n.e(5573),n.e(7236),n.e(4600),n.e(4292),n.e(2315)]).then(n.bind(n,9360)),prToggleButton:Promise.all([n.e(7134),n.e(5573),n.e(7236),n.e(4600),n.e(5145)]).then(n.bind(n,5718)),u:Promise.resolve().then(n.bind(n,1367)),bb:Promise.resolve().then(n.bind(n,7741)),lm:Promise.resolve().then(n.bind(n,8546)),ac:Promise.all([n.e(8026),n.e(9109),n.e(4166),n.e(1927),n.e(5573),n.e(7236),n.e(4600),n.e(4292),n.e(3454),n.e(1304),n.e(644),n.e(7667)]).then(n.t.bind(n,2617,23)),i18n:Promise.all([n.e(1304),n.e(644),n.e(7211)]).then(n.bind(n,2292))};function E(t){const e=D.useContext(S.URLContextType),n=(0,S.getExReady)(P,["prSelectButton","u","i18n"],(t=>(t.i18n=t.i18n.default,t))),i=e.controller,o=D.useCallback(((t,n)=>{const o=t=>{i.isModified()?i.actionHandler.discardModDConfirm({agree:t}):t()};let r;switch(t){case L.DISPLAY_MODE_DETAIL:if(i.contextType===L.CONTEXT_TYPE_SINGLE_ROW)return;if(0===e[L.URL_PARAM_SELECTED].length){let t,e=i.dataContext.mutableContext.rows[0];e&&(t=e.hasOwnProperty("id")?e.id:"object"==typeof e?e[i.static.actorData.pk_index]:null),i.filled(t)?o((()=>i.actionHandler.singleRow(n,t))):(void 0===t&&console.warn("actorData.pk_index is undefined, cannot resolve pk!"),null===t&&console.warn("cannot open detail on a phantom row!"),i.history.replaceState({hasDetail:!1}))}else o((()=>i.actionHandler.singleRow(n,e[L.URL_PARAM_SELECTED][0])));break;case"external":const l={};[L.DISPLAY_MODE_HTML,L.DISPLAY_MODE_SUMMARY].includes(e[L.URL_PARAM_DISPLAY_MODE])&&Object.assign(l,{[L.URL_PARAM_DISPLAY_MODE]:L.DISPLAY_MODE_TABLE}),o((()=>i.actionHandler.copyContext(i.APP.URLContext,l)));break;case L.DISPLAY_MODE_HTML:case L.DISPLAY_MODE_SUMMARY:case L.DISPLAY_MODE_TABLE:case L.DISPLAY_MODE_CARDS:case L.DISPLAY_MODE_LIST:case L.DISPLAY_MODE_GALLERY:case L.DISPLAY_MODE_STORY:case L.DISPLAY_MODE_TILES:const a={[L.URL_PARAM_DISPLAY_MODE]:t};r||(r=i.contextType===L.CONTEXT_TYPE_SINGLE_ROW?i.actionHandler.multiRow:i.history.replace),o((()=>r(a)))}})),[r,l]=D.useState([]);return D.useEffect((()=>{if(!n.ready)return;const t=i.static.actorData,o=[];o.push({icon:"pi-table",help:n.i18n.t("Table view"),value:L.DISPLAY_MODE_TABLE}),e.hasDetail&&o.push({icon:"pi-file-o",help:n.i18n.t("Detail view"),value:L.DISPLAY_MODE_DETAIL}),t.available_display_modes.includes(L.DISPLAY_MODE_HTML)&&o.push({icon:"pi-arrows-h",help:n.i18n.t("Simple table view"),value:L.DISPLAY_MODE_HTML}),t.available_display_modes.includes(L.DISPLAY_MODE_LIST)&&o.push({icon:"pi-bars",help:n.i18n.t("List view"),value:L.DISPLAY_MODE_LIST}),t.available_display_modes.includes(L.DISPLAY_MODE_SUMMARY)&&o.push({icon:"pi-ellipsis-h",help:n.i18n.t("Summary view"),value:L.DISPLAY_MODE_SUMMARY}),t.available_display_modes.includes(L.DISPLAY_MODE_TILES)&&o.push({icon:"pi-microsoft",help:n.i18n.t("Tiles view"),value:L.DISPLAY_MODE_TILES}),t.available_display_modes.includes(L.DISPLAY_MODE_STORY)&&o.push({icon:"pi-map",help:n.i18n.t("Story view"),value:L.DISPLAY_MODE_STORY}),t.available_display_modes.includes(L.DISPLAY_MODE_GALLERY)&&o.push({icon:"pi-clone",help:n.i18n.t("Gallery view"),value:L.DISPLAY_MODE_GALLERY}),t.available_display_modes.includes(L.DISPLAY_MODE_CARDS)&&o.push({icon:"pi-th-large",help:n.i18n.t("Card view"),value:L.DISPLAY_MODE_CARDS}),i.isSlave&&t.editable&&o.push({icon:"pi-eject",help:n.i18n.t("Expand this panel to own window"),value:"external"}),l(o)}),[n.ready,e.hasDetail]),n.ready?(0,b.jsx)(n.prSelectButton.SelectButton,{itemTemplate:t=>(0,b.jsx)("i",{title:t.help,className:"pi "+t.icon}),onChange:t=>o(t.value,t),options:r,value:e[L.URL_PARAM_DISPLAY_MODE]}):null}(0,S.RegisterImportPool)(P);class I extends S.Component{async prepare(){await super.prepare(),this.ex.i18n=this.ex.i18n.default}constructor(t){super(t),this.state={...this.state,query:t.query||"",key:"whatev"},this.renderActionBar=this.renderActionBar.bind(this),this.renderDataViewSortButton=this.renderDataViewSortButton.bind(this),this.renderDetailNavigator=this.renderDetailNavigator.bind(this),this.renderEditorButton=this.renderEditorButton.bind(this),this.renderParamValueControls=this.renderParamValueControls.bind(this),this.renderQuickFilter=this.renderQuickFilter.bind(this),this.renderToggle_colControls=this.renderToggle_colControls.bind(this)}onReady(){this.controller=new this.ex.AbortController.default}renderActionBar(t,e){const n=this.context.controller.static.actorData,{APP:i}=this.context.controller;return(0,b.jsx)(this.ex.bb.LinoBbar,{onSide:t,nonCollapsibles:e,action_full_name:this.context[L.URL_PARAM_DISPLAY_MODE]===L.DISPLAY_MODE_DETAIL?n.default_action.endsWith(".show")?n.default_action:n.detail_action:n.grid_action||i.state.site_data.common_actions.show_table})}renderDataViewSortButton(){if(this.context[L.URL_PARAM_DISPLAY_MODE]===L.DISPLAY_MODE_DETAIL)return;let t=this.context.controller.static.actorData;const e=t.col.map((e=>({label:e.name,value:String(e.fields_index),command:e=>{let n=parseInt(e.item.value);this.context.controller.history.replace({[L.URL_PARAM_SORT]:t.col.filter((t=>t.fields_index===n))[0].name,[L.URL_PARAM_SORTDIR]:"DESC",sortField:n,sortOrder:1})}})));return(0,b.jsx)(this.ex.prSplitButton.SplitButton,{icon:0===this.context.sortOrder?"pi pi-sort-alt":1===this.context.sortOrder?"pi pi-sort-amount-up":"pi pi-sort-amount-down",label:this.ex.i18n.t("Sort by {{value}}",{value:this.context[L.URL_PARAM_SORT]||""}),model:e,onClick:t=>{let e=1===this.context.sortOrder?-1:1;this.context.controller.history.replace({[L.URL_PARAM_SORTDIR]:1===e?"DESC":"ASC",sortOrder:e})},style:{verticalAlign:"bottom"}})}renderDetailNavigator(){if(this.context[L.URL_PARAM_DISPLAY_MODE]!==L.DISPLAY_MODE_DETAIL)return null;let t=this.context.controller.dataContext.mutableContext.navinfo,e=this.props.parent.state.loading;const n=t=>{this.props.parent.LinoDetail.navigate(t)};return t&&(0,b.jsxs)(D.Fragment,{children:[(0,b.jsx)(this.ex.prButton.Button,{disabled:e||null===t.prev,className:"l-nav-first",icon:"pi pi-angle-double-left",onClick:t=>n("first")}),(0,b.jsx)(this.ex.prButton.Button,{disabled:e||null===t.prev,className:"l-nav-prev",icon:"pi pi-angle-left",onClick:t=>n("prev")}),(0,b.jsx)(this.ex.prButton.Button,{disabled:e||null===t.next,className:"l-nav-next",icon:"pi pi-angle-right",onClick:t=>n("next")}),(0,b.jsx)(this.ex.prButton.Button,{disabled:e||null===t.next,className:"l-nav-last",icon:"pi pi-angle-double-right",onClick:t=>n("last")})]})}renderEditorButton(){let t=this.context.controller,e=t.static.actorData;return this.context[L.URL_PARAM_DISPLAY_MODE]!==L.DISPLAY_MODE_DETAIL||!e.editable||e.edit_safe||t.dataContext.contextBackup.disable_editing?null:(0,b.jsx)(this.ex.prToggleButton.ToggleButton,{checked:!this.context.editing_mode,className:"l-bbar-editor-button",onChange:t=>{this.ex.u.toggleEditingMode(this.context)},onLabel:"",offLabel:"",offIcon:"pi pi-times",onIcon:"pi pi-pencil",tooltip:this.context.editing_mode?this.ex.i18n.t("Cancel"):this.ex.i18n.t("Edit"),tooltipOptions:{position:"bottom"}})}renderParamValueControls(){return this.context.controller.static.actorData.params_layout&&(0,b.jsxs)(D.Fragment,{children:[(0,b.jsx)(this.ex.prButton.Button,{className:"l-button-pv_control",icon:"pi pi-sliders-h",onClick:t=>{this.context.controller.history.replace({pvPVisible:!this.context.pvPVisible})},tooltip:this.context.pvPVisible?this.ex.i18n.t("Hide parameters panel"):this.ex.i18n.t("Show parameters panel"),tooltipOptions:{position:"bottom"}}),0!==Object.keys(this.context[L.URL_PARAM_PARAM_VALUES]||{}).length&&(0,b.jsx)(this.ex.prButton.Button,{icon:"pi pi-times-circle",onClick:()=>{let t=this.context.controller;t.dataContext.updateState({param_values:{...t.dataContext.contextBackup.param_values}}),t.history.replace({pv:[]})},tooltip:this.ex.i18n.t("Clear and set the parameter values to default"),tooltipOptions:{position:"bottom"}})]})}renderQuickFilter(t){return(0,b.jsx)("span",{onKeyDown:t=>{"Delete"===t.code&&t.stopPropagation()},children:this.context[L.URL_PARAM_DISPLAY_MODE]===L.DISPLAY_MODE_DETAIL?(0,b.jsx)(this.ex.ac.QuickFilter,{urlParams:this.context,wide:!!t}):(0,b.jsx)(this.ex.prInputText.InputText,{className:"l-grid-quickfilter",onChange:t=>{let e=t.target.value;this.setState({query:e}),this.props.parent.quickFilter({query:e})},placeholder:this.ex.i18n.t("Quick search"),ref:t=>{t&&this.context.currentInputWindowType===L.WINDOW_TYPE_UNKNOWN&&0===this.context.currentInputTabIndex&&t.focus()},style:{width:t?"100%":void 0,marginRight:t?"1ch":void 0,marginLeft:t?"1ch":void 0},value:this.state.query})})}renderToggle_colControls(){return this.context[L.URL_PARAM_DISPLAY_MODE]!==L.DISPLAY_MODE_TABLE?null:(0,b.jsxs)(D.Fragment,{children:[(0,b.jsx)(this.ex.prButton.Button,{icon:"pi pi-list",onClick:t=>this.col_selector_op.toggle(t),tooltip:this.ex.i18n.t("Configure visibility of the grid columns"),tooltipOptions:{position:"bottom"}}),(0,b.jsx)(this.ex.prOverlayPanel.OverlayPanel,{onHide:t=>this.col_selector.hide(),onShow:t=>this.col_selector.show(),ref:t=>this.col_selector_op=t,children:(0,b.jsx)(this.ex.prMultiSelect.MultiSelect,{display:"chip",filter:!0,onChange:t=>{let e=new Map;t.value.forEach(((t,n)=>{e.set(t,this.context.controller.static.actorData.col.find((e=>e.fields_index===t)).name)})),this.context.controller.history.replace({showableColumns:e}),this.props.parent.GridElement.set_cols()},onHide:t=>this.col_selector_op.hide(),options:this.context.controller.static.actorData.col.map((t=>({label:t.name,value:t.fields_index}))),panelStyle:{zIndex:"99999",height:"auto",width:"auto",position:"absolute"},ref:t=>this.col_selector=t,style:{maxWidth:"90vw"},value:Array.from(this.context.showableColumns.keys())})})]})}render(){if(!this.state.ready)return null;let t=this.context.controller.static.actorData;return(0,b.jsxs)(D.Fragment,{children:[this.context.toolbarState==L.TOOLBAR_STATE_VISIBLE?(0,b.jsx)(D.Fragment,{children:(0,b.jsxs)("div",{className:"table-header",children:[(0,b.jsxs)("div",{className:"l-bbar-left",style:{background:"transparent"},children:[!t.hide_navigator&&(0,b.jsxs)(D.Fragment,{children:[this.renderQuickFilter(),this.renderParamValueControls(),this.context[L.URL_PARAM_DISPLAY_MODE]!==L.DISPLAY_MODE_TABLE?this.renderDataViewSortButton():this.renderToggle_colControls(),this.renderDetailNavigator()]}),this.renderActionBar(!1),this.renderEditorButton()]}),(0,b.jsx)(E,{})]})}):this.props.side?(0,b.jsxs)(D.Fragment,{children:[!t.hide_navigator&&(0,b.jsxs)(D.Fragment,{children:[this.renderDetailNavigator(),this.context[L.URL_PARAM_DISPLAY_MODE]===L.DISPLAY_MODE_TABLE&&this.renderToggle_colControls()]}),this.renderActionBar(!0),this.renderEditorButton()]}):!t.hide_top_toolbar&&this.context.toolbarState==L.TOOLBAR_STATE_PARTIALLY_VISIBLE&&(0,b.jsx)(D.Fragment,{children:(0,b.jsxs)("div",{className:"table-header",children:[(0,b.jsxs)("div",{className:"l-bbar-left",style:{background:"transparent"},children:[!t.hide_navigator&&(0,b.jsxs)(D.Fragment,{children:[this.renderQuickFilter(),this.renderParamValueControls(),this.context[L.URL_PARAM_DISPLAY_MODE]!==L.DISPLAY_MODE_TABLE&&this.renderDataViewSortButton()]}),this.renderActionBar(!1,!0)]}),(0,b.jsx)(E,{})]})}),!this.props.side&&(0,b.jsx)(this.ex.lm.LinoProgressBar,{loading:this.props.parent.state.loading})]},this.state.key)}}I.requiredModules=["AbortController","prButton","prInputText","prOverlayPanel","prMultiSelect","prSplitButton","prToggleButton","bb","lm","u","ac","i18n"],I.iPool=P,I.contextType=S.URLContextType},8462:(t,e,n)=>{n.d(e,{A:()=>a});var i=n(6995),o=n.n(i),r=n(8065),l=n.n(r)()(o());l.push([t.id,".l-header {\n    padding: 3px;\n    border: 1px solid #8080804d;\n}\n.l-whitewall-body-container .p-button.p-component {\n    /* color: #ffffff70; */\n}\n.l-whitewall-body-container .p-inputtext {\n    /* background: transparent;\n    color: unset; */\n}\n","",{version:3,sources:["webpack://./lino_react/react/components/LinoToolbar.css"],names:[],mappings:"AAAA;IACI,YAAY;IACZ,2BAA2B;AAC/B;AACA;IACI,sBAAsB;AAC1B;AACA;IACI;mBACe;AACnB",sourcesContent:[".l-header {\n    padding: 3px;\n    border: 1px solid #8080804d;\n}\n.l-whitewall-body-container .p-button.p-component {\n    /* color: #ffffff70; */\n}\n.l-whitewall-body-container .p-inputtext {\n    /* background: transparent;\n    color: unset; */\n}\n"],sourceRoot:""}]);const a=l}}]);
//# sourceMappingURL=main.LinoToolbar_LinoComponents.24920bcf2274a1748ad0.js.map