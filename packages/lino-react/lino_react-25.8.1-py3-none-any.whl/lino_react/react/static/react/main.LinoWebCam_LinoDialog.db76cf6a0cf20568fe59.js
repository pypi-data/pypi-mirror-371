"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[3211,7211],{2756:(e,t,s)=>{s.r(t),s.d(t,{ABCComponent:()=>c,Labeled:()=>p,LeafComponentBase:()=>m,LeafComponentDelayedValue:()=>_,LeafComponentInput:()=>g,LeafComponentInputChoices:()=>b,maintainTableWidth:()=>h,name:()=>u});var i=s(5247),n=s(7881),a=s.n(n),l=s(6606),r=s(1151),o=s(3748);const u="LinoComponentUtils";let d;d={classNames:s.e(4166).then(s.t.bind(s,8041,23)),prDropdown:Promise.all([s.e(7134),s.e(5573),s.e(7236),s.e(4600),s.e(4292),s.e(3454),s.e(5350)]).then(s.bind(s,5384)),prInputText:Promise.all([s.e(9109),s.e(5573),s.e(7236),s.e(4600),s.e(2123)]).then(s.bind(s,8016)),queryString:Promise.all([s.e(4166),s.e(2298)]).then(s.bind(s,9320)),u:Promise.resolve().then(s.bind(s,1367))};function h(e,t){let s;s=void 0!==e?e:this;let i=Object.keys(s.flexs);(void 0!==t?i.length===t:i.length>1)&&i.forEach((e=>{var t=document.getElementById(e).getElementsByClassName("p-datatable");if(1===t.length){(t=t[0]).getBoundingClientRect().width/document.getElementsByClassName("layout-topbar")[0].getBoundingClientRect().width>s.flexs[e]&&Array.from(t.querySelectorAll(".p-datatable table")).forEach((e=>{Array.from(e.classList).join(" ").includes("p-datatable")&&e.style.setProperty("table-layout","auto")}))}}))}(0,l.RegisterImportPool)(d);const p=({actions:e=[],label:t,elem:s,children:n,hide_label:a=!1,isFilled:r=!1})=>{const u=(0,l.getExReady)(d,["classNames"]);return t=t||s.label,u.ready?(0,o.jsxs)(i.Fragment,{children:[!a&&t&&(0,o.jsxs)(i.Fragment,{children:[(0,o.jsxs)("label",{className:u.classNames.default("l-label","l-span-clickable",{"l-label--unfilled":!r}),title:Object.assign({},s.value||{}).quicktip||s.help_text,children:[t,e.map(((e,t)=>(0,o.jsxs)(i.Fragment,{children:[" | ",(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:e}})]},t))),":"]}),(0,o.jsx)("br",{})]}),n]}):null};p.propTypes={actions:a().array,label:a().string,elem:a().object.isRequired,hide_label:a().bool,isFilled:a().bool,children:a().element.isRequired};class c{static getValueByName({name:e,props:t,context:s}){return t[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_PARAMS?s.param_values[e]:t[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?s.rows[t.column.rowIndex][e]:t[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_CARDS?s[e]:s.data[e]}}class m extends l.Component{constructor(e,t){super(e,t),this.filled=()=>!["",null,void 0].includes(this.getValue()),this.wrapperClasses=[],this.dataKey=e[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?e.elem.fields_index:e.elem.name,this.upController=e.urlParams.controller,this.c=e.urlParams.controller,this.filled=this.filled.bind(this),this.getValue=this.getValue.bind(this),this.getValueByName=this.getValueByName.bind(this),this.innerHTML=this.innerHTML.bind(this),this.setLeafRef=this.setLeafRef.bind(this)}getValueByName(e){return c.getValueByName({name:e,props:this.props,context:this.context})}getValue(){return this.getValueByName(this.dataKey)}innerHTML(e,t={}){let s=this.getValue()||" ";return s instanceof Object&&(s=JSON.stringify(s)),e?(0,o.jsx)("div",{style:t,dangerouslySetInnerHTML:{__html:s}}):(0,o.jsx)("div",{style:t,children:s})}setLeafRef({input:e=!1,type:t=""}={}){if(this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_DETAIL||this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_INSERT){this.upController.dataContext.setLeafRef({name:"slave"===t?this.actorID:this.props.elem.name,ref:this,input:e,type:t});const{controller:s}=this.props.urlParams;s.onLeafMount()}}}m.requiredModules=["classNames"],m.iPool=d,m.contextType=l.DataContextType,m.propTypesFromLinoLayout={column:a().object,editing_mode:a().bool,hide_label:a().bool,[r.URL_PARAM_WINDOW_TYPE]:a().oneOf([r.WINDOW_TYPE_TABLE,r.WINDOW_TYPE_DETAIL,r.WINDOW_TYPE_CARDS,r.WINDOW_TYPE_GALLERIA,r.WINDOW_TYPE_INSERT,r.WINDOW_TYPE_PARAMS,r.WINDOW_TYPE_UNKNOWN]),tabIndex:a().number.isRequired},m.propTypes={...m.propTypesFromLinoLayout,elem:a().object.isRequired,urlParams:a().object.isRequired},m.defaultProps={editing_mode:!1,hide_label:!1,[r.URL_PARAM_WINDOW_TYPE]:r.WINDOW_TYPE_UNKNOWN};class _ extends m{constructor(e,t){super(e,t),this.liveUpdate=e=>{(null===e.mk||e.mk===this.state.mk&&e.mt===this.state.mt)&&this.update()};const s={};e.hasOwnContext||Object.assign(s,this.upController.actionHandler.masterRelateForSlave()),this.state={...this.state,value:null,data_url:null,...s},this.actorID=e.elem.actor_id||(e.elem.name.includes(".")?e.elem.name:`${e.urlParams.packId}.${e.elem.name}`),this.delayed=e.elem.delayed_value,this.shouldComponentUpdate=this.shouldComponentUpdate.bind(this),this.getData=this.getData.bind(this),this.getValue=this.getValue.bind(this),this.update=this.update.bind(this)}onReady(){let e=super.getValue();this.delayed?(this.props.hasOwnContext||this.setLeafRef({type:"slave"}),this.upController.globals.panels[this.actorID]=this,null!==e?this.getData(e.delayed_value_url):this.setState({value:" ",data_url:void 0})):this.setState({value:e})}shouldComponentUpdate(e,t,s){const i=super.getValue();let n;return n=this.delayed?this.state.value!==t.value||null!==this.state.value&&(i||{}).delayed_value_url!==this.state.data_url:this.state.value!==t.value,n}componentDidUpdate(e,t){const s=super.getValue();this.delayed?this.state.data_url!==(s||{}).delayed_value_url&&(this.setState({value:null}),null!==s?this.update():this.setState({value:" ",data_url:void 0})):this.setState({value:s})}componentWillUnmount(){delete this.upController.globals.panels[this.actorID]}getValue(){return this.state.value}getData(e){this.upController.actionHandler.silentFetch({path:`${e}?${this.ex.queryString.default.stringify(this.upController.actionHandler.getParams())}`}).then((t=>{this.setState({value:t.data,buttons:t.buttons,data_url:e})}))}update(){this.getData(super.getValue().delayed_value_url)}}_.requiredModules=["queryString"].concat(m.requiredModules),_.propTypes={...m.propTypes,hasOwnContext:a().bool.isRequired},_.defaultProps={...m.defaultProps,hasOwnContext:!1};class g extends m{constructor(e,t){super(e,t),this.state={...this.state,textSelected:!1},this.styleClasses=["disabled-input","l-card","unsaved-modification"],this.disabled=this.disabled.bind(this),this.filled=this.filled.bind(this),this.focus=this.focus.bind(this),this.getCellStyleClasses=this.getCellStyleClasses.bind(this),this.getLinoInput=this.getLinoInput.bind(this),this.onChangeUpdate=this.onChangeUpdate.bind(this),this.onInputRef=this.onInputRef.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onRef=this.onRef.bind(this),this.setCellStyle=this.setCellStyle.bind(this),this.submit=this.submit.bind(this),this.tabIndexMatch=this.tabIndexMatch.bind(this),this.update=this.update.bind(this)}async prepare(){this.inputState={inputComponent:this.ex.prInputText.InputText,inputOnly:!1,inputProps:{},onChangeUpdateAssert:e=>!0,postOnChange:e=>null},this.setLeafRef({input:!0})}disabled(){if(this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_CARDS)return!0;if(this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_PARAMS)return!1;if(!this.props.elem.editable)return!0;if(this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE){let e=this.context.rows[this.props.column.rowIndex],t=e[e.length-1];return!(!t||!t.meta||t.phantom)&&(!!e[e.length-2]||(e[e.length-3][this.props.elem.name]||!1))}return!!this.context.data.disable_editing||(this.context.data.disabled_fields[this.props.elem.name]||!1)}findHTMLInputElement(e){return e.focusInput?e=e.focusInput:e.inputRef?e=e.inputRef.current:e.hasOwnProperty("getInput")&&(e=e.getInput()),e}select(e){const t=e=>{this.state.textSelected=!0,e.select()};e.select?t(e):(this.container&&(e=this.container.getElementsByTagName("input")[0]),e&&e.select&&t(e))}focus(){let e=this.findHTMLInputElement(this.inputEl);e&&e.focus&&(e.click(),this.select(e))}getCellStyleClasses(){let e=[];return this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?this.context.modifiedRows[this.props.column.rowIndex].includes(this.props.elem.fields_index)&&e.push("unsaved-modification"):(e.push("l-card"),this.props[r.URL_PARAM_WINDOW_TYPE]!==r.WINDOW_TYPE_CARDS&&(this.disabled()?e.push("disabled-input"):this.context.modified.includes(this.props.elem.name)&&e.push("unsaved-modification"))),e}getLinoInput(){return(0,o.jsx)(this.inputState.inputComponent,{onChange:e=>{this.inputState.onChangeUpdateAssert(e)&&(this.onChangeUpdate(e),this.inputState.postOnChange(e))},ref:this.onInputRef,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()||"",...this.inputState.inputProps})}onChangeUpdate(e){this.update({[this.dataKey]:e.target.value}),this.setState({})}onInputRef(e){if(e&&(e!=this.inputEl&&(this.focusDone=!1),this.inputEl=e,!this.focusDone)){let t=this.findHTMLInputElement(e);if(document.activeElement===t)return;this.tabIndexMatch()&&this.focus(),this.focusDone=!0}}onKeyDown(e){"Escape"===e.code&&this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_DETAIL&&this.props.editing_mode&&this.ex.u.toggleEditingMode(this.props.urlParams)}onRef(e){const t=()=>{this.container.onclick=e=>{this.disabled()||(Object.assign(this.upController.globals,{currentInputRowIndex:Object.assign({rowIndex:0},this.props.column).rowIndex,currentInputTabIndex:this.props.tabIndex,currentInputWindowType:this.props[r.URL_PARAM_WINDOW_TYPE],currentInputAHRefName:this.upController.actionHandler.refName}),this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_DETAIL&&(this.props.editing_mode?this.state.textSelected?this.setState({textSelected:!1}):this.select(this.findHTMLInputElement(this.inputEl)):this.upController.history.replaceState({editing_mode:!0})))}};e&&(this.container=e,this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?(this.container=e.closest("td"),t()):this.props[r.URL_PARAM_WINDOW_TYPE]!==r.WINDOW_TYPE_DETAIL&&this.props[r.URL_PARAM_WINDOW_TYPE]!==r.WINDOW_TYPE_INSERT||t()),this.setCellStyle(this.container)}setCellStyle(e){if(e){let t=this.getCellStyleClasses();this.styleClasses.forEach((t=>{e.classList.remove(t)})),t.forEach((t=>{e.classList.add(t)}))}}submit(){this.upController.actionHandler.submit({cellInfo:{rowIndex:this.props.column.rowIndex}})}tabIndexMatch(){return(this.props[r.URL_PARAM_WINDOW_TYPE]!==r.WINDOW_TYPE_TABLE||this.props.column.rowIndex===this.upController.globals.currentInputRowIndex)&&(this.props[r.URL_PARAM_WINDOW_TYPE]===this.upController.globals.currentInputWindowType&&this.upController.actionHandler.refName===this.upController.globals.currentInputAHRefName&&this.props.tabIndex===this.upController.globals.currentInputTabIndex)}update(e){this.upController.actionHandler.update({values:e,elem:this.props.elem,col:this.props.column,windowType:this.props[r.URL_PARAM_WINDOW_TYPE]})}render(e=this.props.hide_label){return this.state.ready?(this.container&&this.setCellStyle(this.container),(0,o.jsx)(p,{...this.props,actions:(this.context.field_actions||{})[this.props.elem.name]||[],hide_label:e||this.props.hide_label,elem:this.props.elem,isFilled:this.filled(),children:(0,o.jsx)("div",{className:this.ex.classNames.default(this.wrapperClasses),onKeyDown:this.onKeyDown,ref:this.onRef,children:this.inputState.inputOnly||this.props.editing_mode&&!this.disabled()?this.getLinoInput():this.innerHTML()})})):null}}g.requiredModules=["prInputText","u"].concat(m.requiredModules);class b extends g{constructor(e,t){super(e,t),this.onKeyDown=e=>{super.onKeyDown(e),"Enter"===e.key&&this.inputEl.getOverlay()&&e.stopPropagation()},this.wrapperClasses.push("l-ChoiceListFieldElement"),this.state={...this.state,hidden_value:null},this.dataKeyHidden=e[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?e.elem.fields_index_hidden:e.elem.name+"Hidden",this.getLinoInput=this.getLinoInput.bind(this),this.getValue=this.getValue.bind(this),this.innerHTML=this.innerHTML.bind(this)}getValue(){return{text:super.getValue(),value:this.getValueByName(this.dataKeyHidden)}}getLinoInput(){return(0,o.jsx)(this.ex.prDropdown.Dropdown,{autoFocus:!0,itemTemplate:e=>(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:e.text}}),onChange:e=>{e.originalEvent.ctrlKey||e.originalEvent.altKey||(this.update({[this.dataKey]:e.value||null,[this.dataKeyHidden]:e.value||null}),this.setState({}))},optionLabel:"text",options:this.options,showClear:this.props.elem.field_options.allowBlank,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue().value,valueTemplate:(e,t)=>e?(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:e.text}}):(0,o.jsx)("div",{children:" "})})}innerHTML(){let e=super.getValue()||" ";return(0,o.jsx)("div",{dangerouslySetInnerHTML:{__html:e}})}}b.requiredModules=["prDropdown"].concat(g.requiredModules)},2292:(e,t,s)=>{s.r(t),s.d(t,{TransInit:()=>o,default:()=>u});var i=s(1151),n=s(1884),a=s(8682),l=s(9974),r=s(6433);const o=(e,t)=>{const s=new a.A;s.addDetector({name:"LinoLanguageDetector",lookup:t=>e.value[i.URL_PARAM_USER_LANGUAGE],cacheUserLanguage(t,s){e.fillPlaceHolder(i.PARAM_TYPE_WINDOW,i.URL_PARAM_USER_LANGUAGE,t),e.history.replaceByType({[i.URL_PARAM_USER_LANGUAGE]:t},i.PARAM_TYPE_WINDOW,!1,!0)}}),n.Ay.use(l.A).use(s).use(r.initReactI18next).init({debug:!1,load:"languageOnly",fallbackLng:window.Lino.i18nFallbackLng,keySeparator:!1,interpolation:{escapeValue:!1},react:{useSuspense:!0},backend:{loadPath:"/static/react/locales/{{lng}}/{{ns}}.json"},detection:{order:["queryString","cookie","LinoLanguageDetector","localStorage"],lookupQuerystring:i.URL_PARAM_USER_LANGUAGE,lookupCookie:i.URL_PARAM_USER_LANGUAGE,lookupLocalStorage:i.URL_PARAM_USER_LANGUAGE,caches:["LinoLanguageDetector","localStorage","cookie"]}}),t(n.Ay)},u=n.Ay},9850:function(e,t,s){var i,n=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,n)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=i(e),l=0;l<s.length;l++)"default"!==s[l]&&n(t,e,s[l]);return a(t,e),t}),r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LinoWebCam=t.name=void 0,t.name="LinoWebCam";const o=l(s(5247)),u=r(s(7881)),d=s(6606),h=r(s(8313));let p;p={prButton:Promise.resolve().then((()=>l(s(6286)))),prOverlayPanel:Promise.resolve().then((()=>l(s(6014)))),prInputNumber:Promise.resolve().then((()=>l(s(5248)))),prInputSwitch:Promise.resolve().then((()=>l(s(6868)))),lcu:Promise.resolve().then((()=>l(s(2756)))),i18n:Promise.resolve().then((()=>l(s(2292))))};(0,d.RegisterImportPool)(p);class c{constructor(e){this.store=e,this.buildMediaConstraints()}buildMediaConstraints(){const e={};return this.settings=window.App.getSettings().webcam,void 0!==this.settings?(e.height=this.settings.height,e.width=this.settings.width):(e.height=this.store.props.height*devicePixelRatio,e.width=this.store.props.width*devicePixelRatio,this.settings=Object.assign({},e,{pixelRatio:devicePixelRatio,mirrored:!0}),window.App.setSettings({webcam:this.settings})),this.settingsMod={...this.settings},this.store.state.deviceId?e.deviceId=this.store.state.deviceId:e.facingMode="environment",this.mediaTrackConstraints=e,e}}c.buildReferences=e=>{e.webcamRef=o.useRef(null),e.capture=o.useCallback((t=>{e.props.captureDone(e.webcamRef.current.getScreenshot())}),[e.webcamRef]);const[t,s]=o.useState({err_msg:null,deviceId:null,devices:[]});return e.state=t,e.setState=o.useCallback((e=>s((t=>Object.assign({},t,e)))),[]),e.switchCamera=o.useCallback((s=>{let i=(t.devices.indexOf(t.deviceId)+1)%t.devices.length;e.setState({deviceId:t.devices[i]})}),[]),e};const m=e=>{const{settings:t,settingsMod:s}=e.CC,[i,n]=o.useState(t.mirrored),a=(0,d.getExReady)(p,["prInputNumber","prInputSwitch","lcu","i18n"]),l=o.useCallback((({label:e,max:t=null,min:s,onValueChange:i,suffix:n,value:l})=>o.createElement("div",null,o.createElement(a.lcu.Labeled,{elem:{label:e}},o.createElement(a.prInputNumber.InputNumber,{buttonLayout:"horizontal",max:t,min:s,onValueChange:i,showButtons:!0,suffix:n,value:l})))),[a]);return a.ready?o.createElement(o.Fragment,null,l({label:"Height (# > 512)",max:e.CC.store.props.height,min:512,onValueChange:e=>Object.assign(s,{height:e.value*s.pixelRatio}),suffix:"px",value:t.height/t.pixelRatio}),o.createElement("br",null),l({label:"Width (# > 512)",max:e.CC.store.props.width,min:512,onValueChange:e=>Object.assign(s,{width:e.value*s.pixelRatio}),suffix:"px",value:t.width/t.pixelRatio}),o.createElement("br",null),l({label:"Pixel ratio (# > 1)",min:1,onValueChange:e=>{Object.assign(s,{height:s.height/s.pixelRatio*e.value,width:s.width/s.pixelRatio*e.value,pixelRatio:e.value})},suffix:"dpr",value:t.pixelRatio}),o.createElement("br",null),o.createElement("div",null,o.createElement(a.lcu.Labeled,{elem:{label:a.i18n.t("Mirrored")}},o.createElement(a.prInputSwitch.InputSwitch,{checked:i,onChange:e=>{n(e.value),Object.assign(s,{mirrored:e.value})}})))):null};m.propTypes={CC:u.default.instanceOf(c).isRequired};const _=e=>{const t=o.useRef(null),s={background:"white",color:"black",borderRadius:"50%",width:"5ch",height:"5ch",margin:"5px"},i=(0,d.getExReady)(p,["prButton","prOverlayPanel"]);return i.ready?o.createElement(o.Fragment,null,o.createElement(i.prButton.Button,{icon:"pi pi-camera",onClick:e.CC.store.capture,style:s}),e.CC.store.state.devices.length>1&&o.createElement(i.prButton.Button,{icon:"pi pi-undo",onClick:e.CC.store.switchCamera,style:s}),o.createElement(i.prButton.Button,{icon:"pi pi-cog",onClick:e=>t.current.toggle(e),style:s}),o.createElement("div",{onKeyDown:e=>e.stopPropagation()},o.createElement(i.prOverlayPanel.OverlayPanel,{onHide:t=>{document.activeElement.blur(),window.App.setSettings({webcam:e.CC.settingsMod}),e.CC.buildMediaConstraints(),e.CC.store.setState({})},onShow:e=>t.current.align(),ref:t,showCloseIcon:!0},o.createElement(m,{CC:e.CC})))):null};_.propTypes={CC:u.default.instanceOf(c).isRequired};t.LinoWebCam=e=>{const t=o.useRef({props:e});c.buildReferences(t.current);const{state:s,setState:i}=t.current;o.useEffect((()=>{document.activeElement.blur(),t.current.self=new c(t.current),navigator.mediaDevices.enumerateDevices().then((e=>i({devices:e.filter((({kind:e})=>"videoinput"===e)).map((e=>e.deviceId))})))}),[]);const{self:n}=t.current;return s.devices.length?o.createElement(o.Fragment,null,o.createElement("div",{style:{position:"absolute"}},s.err_msg),o.createElement(h.default,{audio:!1,forceScreenshotSourceSize:!0,height:n.settings.height/n.settings.pixelRatio,mirrored:n.settings.mirrored,onUserMedia:e=>{null===s.deviceId&&i({deviceId:e.getVideoTracks()[0].getSettings().deviceId})},onUserMediaError:e=>{null===s.err_msg&&i({err_msg:"Please allow camera access to take a photo."})},ref:t.current.webcamRef,screenshotFormat:"image/jpeg",videoConstraints:n.mediaTrackConstraints,width:n.settings.width/n.settings.pixelRatio}),o.createElement("div",{style:{position:"absolute",bottom:"40px",left:"50%",transform:"translate(-50%, 0)"}},o.createElement(_,{CC:n}))):null},t.LinoWebCam.propTypes={height:u.default.number.isRequired,width:u.default.number.isRequired,captureDone:u.default.func.isRequired}}}]);
//# sourceMappingURL=main.LinoWebCam_LinoDialog.db76cf6a0cf20568fe59.js.map