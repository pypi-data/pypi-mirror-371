trigger:
  batch: true
  branches:
    include:
      - main
  paths:
    include:
      - src
      - tests

pool:
  vmImage: ubuntu-latest

steps:

  - task: UsePythonVersion@0
    displayName: 'Use Python 3.11'
    inputs:
      versionSpec: 3.11
      addToPath: true
      architecture: 'x64'

  - task: Bash@3
    displayName: Creating virtual env and installing checkers
    inputs:
      targetType: 'inline'
      script: |
        pip install --user uv && uv sync --all-extras --dev

  - task: Bash@3
    displayName: Run pytest
    inputs:
      targetType: 'inline'
      script: |
        uv run pytest --junitxml=test_results.xml

  - task: PublishTestResults@2
    displayName: Publish results
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '**/test_results.xml'
