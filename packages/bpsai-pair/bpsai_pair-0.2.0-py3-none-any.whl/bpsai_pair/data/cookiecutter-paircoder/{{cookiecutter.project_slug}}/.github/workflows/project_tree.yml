
name: Refresh Project Tree

on:
  schedule:
    - cron: 17 3 CODEOWNERS context CONTRIBUTING.md docs infra prompts scripts SECURITY.md services src templates tests tools CODEOWNERS context CONTRIBUTING.md docs infra prompts scripts SECURITY.md services src templates tests tools *
  workflow_dispatch: {}

permissions:
  contents: write

jobs:
  refresh:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Generate project tree
        run: |
          TS=$(date -u +%Y-%m-%dT%H:%M:%SZ)
          echo "# Project Tree (snapshot)" > context/project_tree.md
          echo "_Generated: ${TS}_" >> context/project_tree.md
          echo >> context/project_tree.md
          echo  >> context/project_tree.md
      - name: Commit changes if any
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add context/project_tree.md || true
          if ! git diff --cached --quiet; then
            git commit -m "chore(context): refresh project_tree snapshot" && git push;
          else
            echo "No changes to commit.";
          fi
