[build-system]
requires = ["setuptools>=61.2"]
build-backend = "setuptools.build_meta"

[project]
name = "llg3d"
authors = [
    { name = "Clémentine Courtès", email = "clementine.courtes@math.unistra.fr" },
    { name = "Matthieu Boileau", email = "matthieu.boileau@math.unistra.fr" },
]
description = "A solver for the stochastic Landau-Lifshitz-Gilbert equation in 3D"
classifiers = [
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
]
requires-python = ">=3.9"
dependencies = ["numpy", "matplotlib", "scipy"]
dynamic = ["version"]


[project.readme]
file = "README.md"
content-type = "text/markdown"

[project.urls]
Homepage = "https://gitlab.math.unistra.fr/llg3d/llg3d"

[project.scripts]
llg3d = "llg3d.main:main"
"llg3d.post" = "llg3d.post.temperature:main"
"llg3d.plot_results" = "llg3d.post.plot_results:main"

[project.optional-dependencies]
mpi = ["mpi4py"]
opencl = ["pyopencl", "mako"]
jax = [
    "jax[cuda] ; sys_platform != 'darwin'",
    "jax[cpu] ; sys_platform == 'darwin'",
]

[tool.setuptools]
include-package-data = true

[tool.setuptools.package-dir]
"" = "src"

[tool.setuptools.packages.find]
where = ["src"]
namespaces = false

[tool.setuptools.dynamic.version]
attr = "llg3d.__version__"

[tool.coverage.run]
parallel = true
source = ["src/"]

[dependency-groups]
dev = [
    { include-group = "lint" },
    { include-group = "test" },
    { include-group = "doc" },
]
test = ["pytest", "pytest-cov", "pytest-mpi"]
lint = ["ruff"]
doc = [
    "Sphinx >= 7.2.2",
    "sphinx-design",
    "myst-parser",
    "furo",
    "nbsphinx",
    "sphinx-copybutton",
    "sphinx-autobuild",
    "sphinx-prompt",
    "sphinx-last-updated-by-git",
    "sphinxcontrib-programoutput",
    "sphinxcontrib-bibtex",
    "ipython",
]

[tool.ruff]
# Set line length to 88 (compatible with Black)
line-length = 88
exclude = ["src/llg3d/process_tmp/"]

[tool.ruff.lint.per-file-ignores]
# Ignore all directories named `tests`.
"tests/**" = ["D"]

[tool.ruff.lint]
# Enable pydocstyle (D) rules along with existing rules
select = ["E", "F", "W", "D"]
extend-select = ["D213"]
ignore = [
    "D107", # Missing docstring in __init__()
    # Style preferences - ignore D212 to enable D213 (Google convention)
    "D212", # Multi-line docstring summary should start at the first line (we prefer D213)
]

[tool.ruff.lint.pydocstyle]
# Use Google convention for docstrings
convention = "google"

[tool.ruff.format]
# Use double quotes for strings (compatible with Black)
quote-style = "double"
# Use 4 spaces for indentation (compatible with Black)
indent-style = "space"
# Respect magic trailing comma (compatible with Black)
skip-magic-trailing-comma = false
# Line length compatible with Black
line-ending = "auto"
