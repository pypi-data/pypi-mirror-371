"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["50709"],{55815:function(t,e,i){i.d(e,{Eu:function(){return o},hZ:function(){return a},o9:function(){return c}});var s=i(28105),n=i(45657);const r=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function o(t){return r[t%r.length]}function a(t,e){const i=e.getPropertyValue(`--graph-color-${t+1}`)||o(t);return(0,n.Rq)(i)}const c=(0,s.Z)(t=>r.map((e,i)=>a(i,t)),(t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1"))},10388:function(t,e,i){i.a(t,async function(t,s){try{i.d(e,{c:function(){return m},computeStateDisplay:function(){return f}});i(39710),i(87799),i(56389);var n=i(16230),r=i(38763),o=i(93836),a=i(40142),c=i(74266),u=i(45691),d=i(28598),l=i(27417),h=i(44272),_=t([o,d,a,u,c]);[o,d,a,u,c]=_.then?(await _)():_;const f=(t,e,i,s,n,r,o)=>{const a=null==r?void 0:r[e.entity_id];return m(t,i,s,n,a,e.entity_id,e.attributes,void 0!==o?o:e.state)},m=(t,e,i,s,_,f,m,y)=>{if(y===n.lz||y===n.nZ)return t(`state.default.${y}`);const g=(0,h.M)(f),p="counter"===g||"number"===g||"input_number"===g;if((0,d.sJ)(m,"sensor"===g?i:[])||p){if("duration"===m.device_class&&m.unit_of_measurement&&o.a_.includes(m.unit_of_measurement))try{return(0,o.LU)(e,y,m.unit_of_measurement,null==_?void 0:_.display_precision)}catch(b){}if("monetary"===m.device_class)try{return(0,d.uf)(y,e,Object.assign({style:"currency",currency:m.unit_of_measurement,minimumFractionDigits:2},(0,d.l4)({state:y,attributes:m},_)))}catch(b){}const i=(0,d.uf)(y,e,(0,d.l4)({state:y,attributes:m},_)),s=(null==_?void 0:_.translation_key)&&t(`component.${_.platform}.entity.${g}.${_.translation_key}.unit_of_measurement`)||m.unit_of_measurement;return s?`${i}${(0,l.L)(s,e)}${s}`:i}if(["date","input_datetime","time"].includes(g))try{const t=y.split(" ");if(2===t.length)return(0,c.o0)(new Date(t.join("T")),Object.assign(Object.assign({},e),{},{time_zone:r.c_.local}),s);if(1===t.length){if(y.includes("-"))return(0,a.p6)(new Date(`${y}T00:00`),Object.assign(Object.assign({},e),{},{time_zone:r.c_.local}),s);if(y.includes(":")){const t=new Date;return(0,u.mr)(new Date(`${t.toISOString().split("T")[0]}T${y}`),Object.assign(Object.assign({},e),{},{time_zone:r.c_.local}),s)}}return y}catch(v){return y}if(["ai_task","button","conversation","event","image","input_button","notify","scene","stt","tag","tts","wake_word","datetime"].includes(g)||"sensor"===g&&"timestamp"===m.device_class)try{return(0,c.o0)(new Date(y),e,s)}catch(b){return y}return(null==_?void 0:_.translation_key)&&t(`component.${_.platform}.entity.${g}.${_.translation_key}.state.${y}`)||m.device_class&&t(`component.${g}.entity_component.${m.device_class}.state.${y}`)||t(`component.${g}.entity_component._.state.${y}`)||y};s()}catch(f){s(f)}})},32483:function(t,e,i){i.d(e,{U:function(){return _}});i(26847),i(27530);var s=i(55815),n=i(45657),r=i(66169),o=i(44272),a=i(87409),c=i(16230),u=i(17332);const d={media_player:{paused:.5,idle:1},vacuum:{returning:.5}};let l=0;const h=new Map;function _(t,e,i){return function(t,e,i){var s;if(!i||t===c.nZ)return(0,u.g)("--history-unavailable-color",e);if(t===c.lz)return(0,u.g)("--history-unknown-color",e);const l=(0,a.tD)(i,t);if(!l)return;const h=(0,u.g)(l,e);if(!h)return;const _=(0,o.M)(i.entity_id),f=null===(s=d[_])||void 0===s?void 0:s[t];return f?(0,n.uO)((0,r.C)((0,n.Rw)((0,n.wK)(h)),f)):h}(t,e,i)||function(t,e){if(h.has(t))return h.get(t);const i=(0,s.hZ)(l,e);return l++,h.set(t,i),i}(t,e)}},89166:function(t,e,i){i.a(t,async function(t,s){try{i.d(e,{Nu:function(){return $},V3:function(){return x},Vk:function(){return h},YA:function(){return O},xS:function(){return f},zP:function(){return H}});i(39710),i(26847),i(2394),i(18574),i(73042),i(81738),i(94814),i(29981),i(22960),i(6989),i(72489),i(87799),i(56303),i(67886),i(65451),i(46015),i(38334),i(94880),i(75643),i(29761),i(56389),i(27530);var n=i(44272),r=i(10388),o=i(15459),a=t([r]);r=(a.then?(await a)():a)[0];const c=["climate","humidifier","water_heater"],u=["climate","humidifier","input_datetime","water_heater","person","device_tracker"],d=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],l=(t,e)=>!t.states[e]||u.includes((0,n.M)(e)),h=(t,e,i,s,n)=>{const r={type:"history/stream",entity_ids:n,start_time:i.toISOString(),end_time:s.toISOString(),minimal_response:!0,no_attributes:!n.some(e=>l(t,e))},o=new _(t);return t.connection.subscribeMessage(t=>e(o.processMessage(t)),r)};class _{processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,i={};for(const s of Object.keys(this.combinedHistory))i[s]=[];for(const s of Object.keys(t.states))i[s]=[];for(const s of Object.keys(i)){if(s in this.combinedHistory&&s in t.states){const e=this.combinedHistory[s],n=e[e.length-1];i[s]=e.concat(t.states[s]),t.states[s][0].lu<n.lu&&(i[s]=i[s].sort((t,e)=>t.lu-e.lu))}else s in this.combinedHistory?i[s]=this.combinedHistory[s]:i[s]=t.states[s];if(e&&s in this.combinedHistory){const t=i[s].filter(t=>t.lu<e);if(!t.length)continue;if(i[s]=i[s].filter(t=>t.lu>=e),i[s].length&&i[s][0].lu===e)continue;const n=t[t.length-1];n.lu=e,i[s].unshift(n)}}return this.combinedHistory=i,this.combinedHistory}constructor(t,e){this.hass=t,this.hoursToShow=e,this.combinedHistory={}}}const f=(t,e,i,s,n,r=!0,o=!0)=>{const a={type:"history/stream",entity_ids:s,start_time:new Date((new Date).getTime()-3600*i*1e3).toISOString(),minimal_response:r,significant_changes_only:o,no_attributes:null!=n?n:!s.some(e=>l(t,e))},c=new _(t,i);return t.connection.subscribeMessage(t=>e(c.processMessage(t)),a)},m=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||d.every(i=>t.attributes[i]===e.attributes[i])),y=(t,e,i,s,n,a,c)=>{const u=[],d=a[0];for(const o of a){if(u.length>0&&o.s===u[u.length-1].state)continue;const a={};null!=c&&c.attributes.device_class&&(a.device_class=null==c?void 0:c.attributes.device_class),u.push({state_localize:(0,r.c)(t,e,[],i,s[n],n,Object.assign(Object.assign({},o.a||d.a),a),o.s),state:o.s,last_changed:1e3*(o.lc?o.lc:o.lu)})}return{name:(0,o.a)(n,(null==c?void 0:c.attributes)||d.a),entity_id:n,data:u}},g=(t,e,i,s)=>{const r=[];return Object.keys(i).forEach(t=>{const e=i[t],a=e[0],u=(0,n.M)(t),l=[];for(const i of e){let t;if(c.includes(u)){t={state:i.s,last_changed:1e3*i.lu,attributes:{}};for(const e of d)e in i.a&&(t.attributes[e]=i.a[e])}else t={state:i.s,last_changed:1e3*(i.lc?i.lc:i.lu),attributes:{}};l.length>1&&m(t,l[l.length-1])&&m(t,l[l.length-2])||l.push(t)}const h=t in s?s[t].attributes:"friendly_name"in a.a?a.a:void 0;r.push({domain:u,name:(0,o.a)(t,h||{}),entity_id:t,states:l})}),{unit:t,device_class:e,identifier:Object.keys(i).join(""),data:r}},p=["counter","input_number","number"],b=t=>p.includes(t),v=t=>"unit_of_measurement"in t||"state_class"in t,w=(t,e)=>null!=t.attributes.device_class&&e.includes(t.attributes.device_class),S=" ",O=(t,e,i,s,n=!1)=>{const r={};i.forEach(t=>{t in e&&(r[t]=e[t])});const o={};Object.entries(r).forEach(([t,e])=>{const i=e.map(t=>({s:null!=t.mean?t.mean.toString():t.state.toString(),lc:t.start/1e3,a:{},lu:t.start/1e3}));o[t]=i});const a=$(t,o,[],t.localize,s,n,!0);return((null==a?void 0:a.line)||[]).forEach(t=>{t.data.forEach(t=>{t.statistics=t.states,t.states=[]})}),a},$=(t,e,i,s,r,o=!1,a=!1)=>{const c={},u=[],d={};if(new Set([...i,...Object.keys(e)]).forEach(i=>{i in e?d[i]=e[i]:t.states[i]&&(d[i]=[{s:t.states[i].state,a:t.states[i].attributes,lu:new Date(t.states[i].last_updated).getTime()/1e3}])}),!d)return{line:[],timeline:[]};Object.keys(d).forEach(e=>{var i;const l=d[e];if(0===l.length)return;const h=(0,n.M)(e),_=e in t.states?t.states[e]:void 0,f=_||b(h)?void 0:l.find(t=>t.a&&v(t.a));let m;m=H(h,_,f,r,a)?(null==_?void 0:_.attributes.unit_of_measurement)||(null==f?void 0:f.a.unit_of_measurement)||S:{zone:s("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[h];const g={climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[h]||(null===(i=(null==_?void 0:_.attributes)||(null==f?void 0:f.a))||void 0===i?void 0:i.device_class),p=j(m,g,o);m?p&&p in c&&e in c[p]?c[p][e].push(...l):p&&(p in c||(c[p]={}),c[p][e]=l):u.push(y(s,t.locale,t.config,t.entities,e,l,_))});return{line:Object.keys(c).map(e=>{const i=e.split("_"),s=i[0],n=i.slice(1).join("_")||void 0;return g(s,n,c[e],t.states)}),timeline:u}},j=(t,e,i)=>i?`${t}_${e||""}`:t,H=(t,e,i,s,n=!1)=>n||b(t)||null!=e&&v(e.attributes)||null!=e&&"sensor"===t&&w(e,s)||null!=i,x=(t,e,i=!0)=>{if(!e)return t;const s=Object.assign(Object.assign({},t),{},{line:[]}),n={};for(const c of t.line){const t=j(c.unit,c.device_class,i);t&&(n[t]={historyItem:c})}for(const c of e.line){var r,o;if(c.unit===S)c.unit=null!==(r=null===(o=t.line.find(t=>t.identifier===c.identifier))||void 0===o?void 0:o.unit)&&void 0!==r?r:S;const e=j(c.unit,c.device_class,i);e&&(e in n?n[e].ltsItem=c:n[e]={ltsItem:c})}for(const{historyItem:c,ltsItem:u}of Object.values(n)){if(!c||!u){s.line.push(c||u);continue}const t=Object.assign(Object.assign({},c),{},{data:[]}),e=new Set([...c.data.map(t=>t.entity_id),...u.data.map(t=>t.entity_id)]);for(const i of e){var a;const e=c.data.find(t=>t.entity_id===i),s=u.data.find(t=>t.entity_id===i);if(!e||!s){t.data.push(e||s);continue}const n=(null===(a=e.states[0])||void 0===a?void 0:a.last_changed)||s.statistics[s.statistics.length-1].last_changed+1,r=[];for(const t of s.statistics){if(t.last_changed>=n)break;r.push(t)}t.data.push(0===r.length?e:Object.assign(Object.assign({},e),{},{statistics:r}))}s.line.push(t)}return s};s()}catch(c){s(c)}})},7214:function(t,e,i){i.d(e,{Cj:function(){return _},F7:function(){return n},Hs:function(){return $},Kd:function(){return S},Kj:function(){return m},Nw:function(){return g},PA:function(){return r},Py:function(){return u},Qm:function(){return j},Z0:function(){return v},_Y:function(){return l},_m:function(){return a},dL:function(){return d},dO:function(){return O},hN:function(){return f},h_:function(){return h},j2:function(){return w},q6:function(){return y},uR:function(){return c},yf:function(){return o}});i(39710),i(26847),i(81738),i(72489),i(56389),i(27530);var s=i(15459),n=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const r=99387==i.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,o=["L","gal","ft³","m³","CCF"],a=t=>t.sendMessagePromise({type:"recorder/info"}),c=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),u=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),d=(t,e,i,s,n="hour",r,o)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:null==i?void 0:i.toISOString(),statistic_ids:s,period:n,units:r,types:o}),l=(t,e,i,s)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:s,fixed_period:i.fixed_period?{start_time:i.fixed_period.start instanceof Date?i.fixed_period.start.toISOString():i.fixed_period.start,end_time:i.fixed_period.end instanceof Date?i.fixed_period.end.toISOString():i.fixed_period.end}:void 0,calendar:i.calendar,rolling_window:i.rolling_window}),h=t=>t.callWS({type:"recorder/validate_statistics"}),_=(t,e,i)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:i}),f=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),m=t=>{let e=null;if(!t)return null;for(const i of t)null!==i.change&&void 0!==i.change&&(null===e?e=i.change:e+=i.change);return e},y=(t,e)=>{let i=null;for(const s of e){if(!(s in t))continue;const e=m(t[s]);null!==e&&(null===i?i=e:i+=e)}return i},g=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),p=["mean","min","max"],b=["sum","state","change"],v=(t,e)=>!(!p.includes(e)||0===t.mean_type)||!(!b.includes(e)||!t.has_sum),w=(t,e,i,s,n)=>{const r=new Date(i).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:r,adjustment:s,adjustment_unit_of_measurement:n})},S=(t,e,i)=>{const n=t.states[e];return n?(0,s.C)(n):(null==i?void 0:i.name)||e},O=(t,e,i)=>{let s;var n;e&&(s=null===(n=t.states[e])||void 0===n?void 0:n.attributes.unit_of_measurement);return void 0===s?null==i?void 0:i.statistics_unit_of_measurement:s},$=t=>t.includes(":"),j=t=>t.callWS({type:"recorder/update_statistics_issues"})},69782:function(t,e,i){i.a(t,async function(t,s){try{i.r(e),i.d(e,{DEFAULT_HOURS_TO_SHOW:function(){return O},HuiHistoryGraphCard:function(){return $}});i(40777),i(26847),i(2394),i(81738),i(22960),i(87799),i(1455),i(27530);var n=i(73742),r=i(59048),o=i(7616),a=i(31733),c=i(37528),u=i(96778),d=(i(12942),i(31138),i(5786),i(89166)),l=i(92523),h=i(93647),_=i(55577),f=i(64637),m=i(7214),y=t([u,d]);[u,d]=y.then?(await y)():y;let g,p,b,v,w,S=t=>t;const O=24;class $ extends r.oi{static async getConfigElement(){return await Promise.all([i.e("73614"),i.e("15601"),i.e("15634"),i.e("26452"),i.e("2769"),i.e("19596"),i.e("44162")]).then(i.bind(i,23374)),document.createElement("hui-history-graph-card-editor")}static getStubConfig(){return{type:"history-graph",entities:["sun.sun"]}}getCardSize(){var t,e;return null!==(t=this._config)&&void 0!==t&&t.title?2:0+2*((null===(e=this._entityIds)||void 0===e?void 0:e.length)||1)}getGridOptions(){return{columns:12,min_columns:6,min_rows:2}}setConfig(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");const e=t.entities?(0,_.A)(t.entities):[];this._entityIds=[],e.forEach(t=>{this._entityIds.push(t.entity),t.name&&(this._names[t.entity]=t.name)}),this._hoursToShow=t.hours_to_show||O,this._config=t}connectedCallback(){super.connectedCallback(),this.hasUpdated&&this._subscribeHistory()}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeHistory()}async _subscribeHistory(){if(!(0,c.p)(this.hass,"history")||this._subscribed)return;const{numeric_device_classes:t}=await(0,l.ib)(this.hass);this._subscribed=(0,d.xS)(this.hass,e=>{var i;this._subscribed&&(this._stateHistory=(0,d.Nu)(this.hass,e,this._entityIds,this.hass.localize,t,null===(i=this._config)||void 0===i?void 0:i.split_device_classes),this._mergeHistory())},this._hoursToShow,this._entityIds).catch(t=>{this._subscribed=void 0,this._error=t}),await this._fetchStatistics(t),this._setRedrawTimer()}_mergeHistory(){var t;this._stateHistory&&(this._history=(0,d.V3)(this._stateHistory,this._statisticsHistory,null===(t=this._config)||void 0===t?void 0:t.split_device_classes))}async _fetchStatistics(t){var e;const i=new Date,s=new Date;s.setHours(s.getHours()-this._hoursToShow);const n=await(0,m.dL)(this.hass,s,i,this._entityIds,"hour",void 0,["mean","state"]);this._statisticsHistory=(0,d.YA)(this.hass,n,this._entityIds,t,null===(e=this._config)||void 0===e?void 0:e.split_device_classes),this._mergeHistory()}_redrawGraph(){this._history&&(this._history=Object.assign({},this._history))}_setRedrawTimer(){clearInterval(this._interval),this._interval=window.setInterval(()=>this._redrawGraph(),6e4)}_unsubscribeHistory(){clearInterval(this._interval),this._subscribed&&(this._subscribed.then(t=>null==t?void 0:t()),this._subscribed=void 0)}shouldUpdate(t){return(0,h.Wh)(this,t)||t.size>1||!t.has("hass")}updated(t){if(super.updated(t),!(this._config&&this.hass&&this._hoursToShow&&this._entityIds.length))return;if(!t.has("_config")&&!t.has("hass"))return;const e=t.get("_config");!t.has("_config")||(null==e?void 0:e.entities)===this._config.entities&&(null==e?void 0:e.hours_to_show)===this._config.hours_to_show||(this._unsubscribeHistory(),this._subscribeHistory())}render(){var t,e,i,s;if(!this.hass||!this._config)return r.Ld;const n=new Date;n.setHours(n.getHours()-this._hoursToShow);const o=`/history?${(0,f.ou)({entity_id:this._entityIds.join(","),start_date:n.toISOString()})}`,c=null!==(t=null===(e=this._config.grid_options)||void 0===e?void 0:e.columns)&&void 0!==t?t:12,u="number"==typeof c&&c<=12,d="number"==typeof(null===(i=this._config.grid_options)||void 0===i?void 0:i.rows);return(0,r.dy)(g||(g=S` <ha-card> ${0} <div class="content ${0}"> ${0} </div> </ha-card> `),this._config.title?(0,r.dy)(p||(p=S` <h1 class="card-header"> ${0} <a href="${0}"><ha-icon-next></ha-icon-next></a> </h1> `),this._config.title,o):r.Ld,(0,a.$)({"has-header":!!this._config.title,"has-rows":!(null===(s=this._config.grid_options)||void 0===s||!s.rows),"has-height":d}),this._error?(0,r.dy)(b||(b=S` <ha-alert alert-type="error"> ${0}: ${0} </ha-alert> `),this.hass.localize("ui.components.history_charts.error"),this._error.message||this._error.code):(0,r.dy)(v||(v=S` <state-history-charts .hass="${0}" .isLoadingData="${0}" .historyData="${0}" .names="${0}" up-to-now .hoursToShow="${0}" .showNames="${0}" .logarithmicScale="${0}" .minYAxis="${0}" .maxYAxis="${0}" .fitYData="${0}" .height="${0}" .narrow="${0}" .expandLegend="${0}"></state-history-charts> `),this.hass,!this._history,this._history,this._names,this._hoursToShow,void 0===this._config.show_names||this._config.show_names,this._config.logarithmic_scale||!1,this._config.min_y_axis,this._config.max_y_axis,this._config.fit_y_data||!1,d?"100%":void 0,u,this._config.expand_legend))}constructor(...t){super(...t),this._names={},this._entityIds=[],this._hoursToShow=O}}$.styles=(0,r.iv)(w||(w=S`ha-card{display:flex;flex-direction:column;height:100%}.card-header{justify-content:space-between;display:flex;padding-bottom:0}.card-header ha-icon-next{--mdc-icon-button-size:24px;line-height:24px;color:var(--primary-text-color)}.content{padding:0 16px 8px;flex:1;overflow:hidden}.has-header{padding-top:0}state-history-charts{--timeline-top-margin:16px}.has-height state-history-charts{height:100%}.has-rows{--chart-max-height:100%}`)),(0,n.__decorate)([(0,o.Cb)({attribute:!1})],$.prototype,"hass",void 0),(0,n.__decorate)([(0,o.SB)()],$.prototype,"_history",void 0),(0,n.__decorate)([(0,o.SB)()],$.prototype,"_statisticsHistory",void 0),(0,n.__decorate)([(0,o.SB)()],$.prototype,"_config",void 0),(0,n.__decorate)([(0,o.SB)()],$.prototype,"_error",void 0),$=(0,n.__decorate)([(0,o.Mo)("hui-history-graph-card")],$),s()}catch(g){s(g)}})}}]);
//# sourceMappingURL=50709.c7d519c24a6424cd.js.map