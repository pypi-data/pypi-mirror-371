// ðŸ”¬ SCIENTIFIC RESEARCH TEMPLATE
// ================================
// Advanced scientific documentation with complex formulas and research citations

#let scientific-template(
  title: "Scientific Research Paper",
  subtitle: none,
  authors: (),
  affiliations: (),
  abstract: none,
  keywords: (),
  date: none,
  body
) = {
  
  // ===== SCIENTIFIC COLOR SCHEME =====
  let primary-color = rgb("#1a237e")       // Deep science blue
  let secondary-color = rgb("#004d40")     // Teal research green
  let accent-color = rgb("#bf360c")        // Research orange
  let text-color = rgb("#263238")          // Dark text
  let light-bg = rgb("#f8f9fa")            // Light background
  let formula-bg = rgb("#e8eaf6")          // Formula background
  let border-color = rgb("#cfd8dc")        // Borders

  // ===== PAGE SETUP =====
  set page(
    paper: "a4",
    margin: (
      top: 2.5cm,
      bottom: 2.5cm,
      left: 2.5cm,
      right: 2.5cm
    ),
    header: context {
      if counter(page).get().first() > 1 [
        #set text(size: 9pt, fill: primary-color)
        #align(right)[
          #text(style: "italic")[#title] â€¢ Page #counter(page).display()
        ]
        #line(length: 100%, stroke: 0.5pt + border-color)
      ]
    },
    footer: context {
      if counter(page).get().first() > 1 [
        #set text(size: 8pt, fill: text-color.lighten(50%))
        #line(length: 100%, stroke: 0.5pt + border-color)
        #v(-0.3em)
        #align(center)[
          Scientific Document â€¢ Generated by WOT-PDF
        ]
      ]
    }
  )

  // ===== TYPOGRAPHY =====
  set text(
    font: ("TeX Gyre Termes", "Times New Roman", "serif"),
    size: 11pt,
    fill: text-color,
    lang: "en"
  )

  set par(
    justify: true,
    leading: 0.65em,
    first-line-indent: 1.5em
  )

  // ===== RESEARCH PAPER TITLE PAGE =====
  if title != none [
    #v(3em)
    
    // Title
    #align(center)[
      #text(
        size: 18pt,
        weight: "bold",
        fill: primary-color
      )[#title]
    ]
    
    #if subtitle != none [
      #v(0.8em)
      #align(center)[
        #text(
          size: 14pt,
          style: "italic",
          fill: secondary-color
        )[#subtitle]
      ]
    ]
    
    #v(2em)
    
    // Authors and affiliations
    #if authors.len() > 0 [
      #align(center)[
        #for (i, author) in authors.enumerate() [
          #text(size: 12pt, weight: "bold")[#author]
          #if i < authors.len() - 1 [, ]
          #if i == authors.len() - 2 [ and ]
        ]
      ]
      
      #v(1em)
      
      #if affiliations.len() > 0 [
        #align(center)[
          #for (i, affiliation) in affiliations.enumerate() [
            #text(
              size: 10pt,
              style: "italic",
              fill: secondary-color
            )[#affiliation]
            #if i < affiliations.len() - 1 [ #linebreak() ]
          ]
        ]
      ]
    ]
    
    #if date != none [
      #v(2em)
      #align(center)[
        #text(size: 11pt, style: "italic")[#date]
      ]
    ]
    
    #v(3em)
    
    // Abstract
    #if abstract != none [
      #rect(
        width: 100%,
        fill: light-bg,
        stroke: 1pt + border-color,
        inset: 1.5em,
        radius: 4pt
      )[
        #align(center)[
          #text(size: 12pt, weight: "bold", fill: primary-color)[ABSTRACT]
        ]
        #v(0.8em)
        #set par(first-line-indent: 0pt)
        #text(size: 10pt)[#abstract]
      ]
      
      #v(1em)
      
      // Keywords
      #if keywords.len() > 0 [
        #rect(
          width: 100%,
          fill: secondary-color.lighten(95%),
          stroke: (left: 3pt + secondary-color),
          inset: 1em
        )[
          #text(size: 10pt, weight: "bold", fill: secondary-color)[Keywords: ]
          #text(size: 10pt, style: "italic")[
            #keywords.join(", ")
          ]
        ]
      ]
    ]
    
    #pagebreak()
  ]

  // ===== SCIENTIFIC HEADINGS =====
  show heading.where(level: 1): it => [
    #v(2.5em)
    #block[
      #rect(
        width: 100%,
        height: 2.5em,
        fill: primary-color,
        radius: (top: 8pt),
        inset: 0pt
      )[
        #align(left + horizon)[
          #h(1em)
          #text(
            size: 16pt,
            weight: "bold",
            fill: white
          )[
            #counter(heading).display("1.") #it.body
          ]
        ]
      ]
    ]
    #v(1.5em)
  ]

  show heading.where(level: 2): it => [
    #v(2em)
    #text(
      size: 14pt,
      weight: "bold",
      fill: secondary-color
    )[
      #counter(heading).display("1.1") #it.body
    ]
    #v(0.3em)
    #line(length: 60%, stroke: 1pt + secondary-color)
    #v(1em)
  ]

  show heading.where(level: 3): it => [
    #v(1.5em)
    #text(
      size: 12pt,
      weight: "bold",
      fill: accent-color
    )[
      #counter(heading).display("1.1.1") #it.body
    ]
    #v(0.8em)
  ]

  // ===== MATHEMATICAL EQUATIONS =====
  set math.equation(numbering: "(1)")
  
  show math.equation: it => {
    if it.block {
      v(1em)
      rect(
        width: 100%,
        fill: formula-bg,
        stroke: (left: 3pt + primary-color),
        inset: (x: 1.5em, y: 1em),
        radius: (right: 4pt)
      )[
        grid(
          columns: (1fr, auto),
          align: (center, right),
          it,
          if it.numbering != none {
            text(size: 10pt, fill: primary-color.lighten(20%))[
              #it.numbering
            ]
          }
        )
      ]
      v(0.5em)
    } else {
      it
    }
  }

  // ===== SCIENTIFIC CODE =====
  show raw.where(block: true): it => [
    #v(1em)
    #rect(
      width: 100%,
      fill: light-bg,
      stroke: 1pt + border-color,
      radius: 4pt,
      inset: 1.2em
    )[
      #text(size: 8pt, fill: secondary-color, weight: "bold")[
        CODE LISTING
      ]
      #v(0.5em)
      #set text(
        font: ("JetBrains Mono", "Consolas", "monospace"),
        size: 9pt,
        fill: text-color
      )
      #it
    ]
    #v(0.8em)
  ]

  // ===== INLINE CODE =====
  show raw.where(block: false): it => [
    #box(
      fill: formula-bg,
      outset: (x: 3pt, y: 2pt),
      radius: 2pt
    )[
      #text(
        font: ("JetBrains Mono", "Consolas", "monospace"),
        size: 0.9em,
        fill: primary-color.darken(20%)
      )[#it]
    ]
  ]

  // ===== SCIENTIFIC FIGURES =====
  show figure: it => [
    #v(1.5em)
    #rect(
      width: 100%,
      stroke: 1pt + border-color,
      inset: 1em,
      radius: 4pt
    )[
      #align(center)[#it.body]
      
      #if it.caption != none [
        #v(0.8em)
        #rect(
          width: 100%,
          fill: light-bg,
          inset: 0.8em,
          radius: 2pt
        )[
          #set text(size: 10pt, fill: text-color.lighten(20%))
          #text(weight: "bold")[
            Figure #counter(figure).display():
          ] #it.caption
        ]
      ]
    ]
    #v(1em)
  ]

  // ===== SCIENTIFIC TABLES =====
  set table(
    stroke: 1pt + border-color,
    fill: (x, y) => {
      if y == 0 { primary-color.lighten(90%) }
      else if calc.odd(y) { light-bg }
      else { white }
    },
    inset: 10pt
  )

  show table: it => [
    #v(1.5em)
    #align(center)[
      #rect(
        stroke: 2pt + border-color,
        radius: 6pt,
        inset: 0pt
      )[#it]
    ]
    #v(1em)
  ]

  // ===== CITATIONS & REFERENCES =====
  show cite: it => [
    #text(
      size: 0.9em,
      fill: accent-color,
      weight: "bold"
    )[#it]
  ]

  // ===== SCIENTIFIC LISTS =====
  show list: it => [
    #v(0.8em)
    #set list(marker: text(fill: secondary-color)[â€¢])
    #it
    #v(0.5em)
  ]

  show enum: it => [
    #v(0.8em)
    #set enum(numbering: n => text(
      fill: primary-color,
      weight: "bold"
    )[#n.])
    #it
    #v(0.5em)
  ]

  // ===== SCIENTIFIC QUOTES =====
  show quote: it => [
    #v(1em)
    #rect(
      width: 100%,
      fill: accent-color.lighten(95%),
      stroke: (left: 4pt + accent-color),
      inset: 1.2em,
      radius: (right: 4pt)
    )[
      #set text(style: "italic", size: 10pt)
      #it.body
    ]
    #v(0.8em)
  ]

  // ===== LINKS & EMPHASIS =====
  show link: it => text(fill: secondary-color, decoration: "underline")[#it]
  show strong: it => text(fill: primary-color, weight: "bold")[#it]
  show emph: it => text(fill: accent-color, style: "italic")[#it]

  // ===== MAIN CONTENT =====
  body
}

// Default template call
#show: scientific-template.with(
  title: [Scientific Research Document],
  subtitle: [Advanced Research Template],
  authors: ([Dr. Research Scientist]),
  affiliations: ([Institute of Advanced Studies]),
  abstract: [This template provides advanced formatting for scientific documents with mathematical equations, research citations, and professional layout suitable for academic publications.],
  keywords: ([science], [research], [academic], [mathematics]),
  date: datetime.today().display("[day]. [month repr:long] [year]")
)
