# è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ¯ ä»»åŠ¡å®Œæˆæƒ…å†µ

âœ… **å·²å®Œæˆ**: ä¸º Python2 å…¼å®¹çš„ Field ç±»å‹å®šä¹‰æ ¡éªŒç³»ç»Ÿæ·»åŠ è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯æ”¯æŒï¼Œå¹¶åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ã€‚

## ğŸš€ å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

### 1. è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯æ”¯æŒ
- ä¸ºæ‰€æœ‰ Field ç±»å‹æ·»åŠ äº† `error_messages` å‚æ•°
- æ”¯æŒå­—å…¸å½¢å¼çš„è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯é…ç½®
- æä¾›å®Œæ•´çš„é»˜è®¤é”™è¯¯æ¶ˆæ¯é›†åˆ
- å‘åå…¼å®¹ï¼Œä¸å½±å“ç°æœ‰ä»£ç 

### 2. é”™è¯¯æ¶ˆæ¯æ¨¡æ¿æ ¼å¼åŒ–
- æ”¯æŒ `{å‚æ•°å}` æ ¼å¼çš„å‚æ•°æ›¿æ¢
- è‡ªåŠ¨å¤„ç†æ ¼å¼åŒ–å¤±è´¥çš„è¾¹ç•Œæƒ…å†µ
- æä¾›ä¸°å¯Œçš„æ ¼å¼åŒ–å‚æ•°ï¼ˆmin_length, maxvalue, choices ç­‰ï¼‰

### 3. å¤šè¯­è¨€æ”¯æŒ
- å®Œå…¨æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ç­‰å¤šè¯­è¨€é”™è¯¯æ¶ˆæ¯
- æ˜“äºæ‰©å±•åˆ°å…¶ä»–è¯­è¨€ç¯å¢ƒ
- æä¾›äº†å®Œæ•´çš„å¤šè¯­è¨€ç¤ºä¾‹

### 4. ç³»ç»Ÿé›†æˆ
- ä¸ç°æœ‰ dataclass ç³»ç»Ÿå®Œç¾é›†æˆ
- æ”¯æŒæ‰€æœ‰å­—æ®µç±»å‹ï¼šStringField, NumberField, ListField
- æ”¯æŒåµŒå¥—éªŒè¯å’Œå¤æ‚æ•°æ®ç»“æ„

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

### æ ¸å¿ƒå®ç°
- **`fields.py`** (ä¿®æ”¹): æ·»åŠ è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯æ ¸å¿ƒåŠŸèƒ½

### æµ‹è¯•æ–‡ä»¶
1. **`test_custom_error_messages.py`**: æ–­è¨€æ–¹å¼çš„å®Œæ•´æµ‹è¯•
2. **`test_custom_error_messages_unittest.py`**: æ ‡å‡† unittest æ¡†æ¶æµ‹è¯• (25ä¸ªæµ‹è¯•ç”¨ä¾‹)
3. **`run_custom_error_tests.py`**: æµ‹è¯•è¿è¡Œå™¨è„šæœ¬

### æ¼”ç¤ºå’Œæ–‡æ¡£
1. **`demo_custom_error_messages.py`**: åŠŸèƒ½æ¼”ç¤ºå’Œä½¿ç”¨ç¤ºä¾‹
2. **`CUSTOM_ERROR_MESSAGES.md`**: è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£
3. **`CUSTOM_ERROR_MESSAGES_SUMMARY.md`**: æœ¬æ€»ç»“æ–‡ä»¶

## ğŸ”§ æ ¸å¿ƒä»£ç å®ç°

### å­—æ®µåˆå§‹åŒ–å¢å¼º
```python
def __init__(self, ..., error_messages=None, **kwargs):
    # é»˜è®¤é”™è¯¯æ¶ˆæ¯
    self.default_error_messages = {
        'required': 'This field is required',
        'min_length': 'Length must be at least {min_length}',
        # ... æ›´å¤šé»˜è®¤æ¶ˆæ¯
    }
    
    # åˆå¹¶ç”¨æˆ·è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯
    self.error_messages = self.default_error_messages.copy()
    if error_messages:
        self.error_messages.update(error_messages)
```

### é”™è¯¯æ¶ˆæ¯æ ¼å¼åŒ–
```python
def get_error_message(self, error_key, **format_kwargs):
    message_template = self.error_messages.get(error_key, 'Validation error')
    try:
        return message_template.format(**format_kwargs)
    except (KeyError, ValueError):
        return message_template
```

### éªŒè¯æ–¹æ³•æ›´æ–°
```python
def validate_required(self, value):
    if value is None:
        if self.required:
            error_msg = self.get_error_message('required')
            raise ValidationError(error_msg)
        return self.get_default()
    return value
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### æµ‹è¯•ç»Ÿè®¡
- **æµ‹è¯•æ–‡ä»¶æ•°**: 4 ä¸ª
- **æµ‹è¯•ç”¨ä¾‹æ•°**: 25+ ä¸ª
- **æµ‹è¯•é€šè¿‡ç‡**: 100%

### æµ‹è¯•è¦†ç›–èŒƒå›´
- âœ… é»˜è®¤é”™è¯¯æ¶ˆæ¯ (8 ä¸ªæµ‹è¯•)
- âœ… è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯ (8 ä¸ªæµ‹è¯•)
- âœ… åˆ—è¡¨å­—æ®µéªŒè¯ (1 ä¸ªæµ‹è¯•)
- âœ… dataclass é›†æˆ (4 ä¸ªæµ‹è¯•)
- âœ… å¤æ‚åœºæ™¯å¤„ç† (3 ä¸ªæµ‹è¯•)
- âœ… å¤šè¯­è¨€æ”¯æŒ (4 ä¸ªæµ‹è¯•)
- âœ… å‘åå…¼å®¹æ€§éªŒè¯ (å®Œæ•´çš„ç°æœ‰åŠŸèƒ½æµ‹è¯•)

## ğŸŒŸ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•
```python
from fields import StringField, ValidationError

# åˆ›å»ºå¸¦è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯çš„å­—æ®µ
field = StringField(
    min_length=3,
    error_messages={
        'required': 'ç”¨æˆ·åæ˜¯å¿…å¡«é¡¹',
        'min_length': 'ç”¨æˆ·åè‡³å°‘éœ€è¦ {min_length} ä¸ªå­—ç¬¦'
    }
)

# éªŒè¯å¤±è´¥æ—¶æ˜¾ç¤ºè‡ªå®šä¹‰æ¶ˆæ¯
try:
    field.validate("ab")
except ValidationError as e:
    print(e.message)  # è¾“å‡º: ç”¨æˆ·åè‡³å°‘éœ€è¦ 3 ä¸ªå­—ç¬¦
```

### dataclass é›†æˆ
```python
from dataclass import dataclass

@dataclass
class User(object):
    name = StringField(
        min_length=2,
        error_messages={
            'required': 'å§“åæ˜¯å¿…å¡«é¡¹',
            'min_length': 'å§“åè‡³å°‘éœ€è¦ {min_length} ä¸ªå­—ç¬¦'
        }
    )
    age = NumberField(
        minvalue=0,
        maxvalue=120,
        error_messages={
            'minvalue': 'å¹´é¾„ä¸èƒ½å°äº {minvalue} å²',
            'maxvalue': 'å¹´é¾„ä¸èƒ½å¤§äº {maxvalue} å²'
        }
    )
```

## ğŸ” æ”¯æŒçš„é”™è¯¯æ¶ˆæ¯ç±»å‹

### é€šç”¨é”™è¯¯æ¶ˆæ¯
- `required`: å¿…å¡«å­—æ®µä¸ºç©º
- `invalid_type`: ç±»å‹ä¸åŒ¹é…

### StringField ä¸“ç”¨
- `min_length`: æœ€å°é•¿åº¦é™åˆ¶
- `max_length`: æœ€å¤§é•¿åº¦é™åˆ¶
- `regex`: æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
- `choices`: æšä¸¾é€‰é¡¹é™åˆ¶

### NumberField ä¸“ç”¨
- `minvalue`: æœ€å°å€¼é™åˆ¶
- `maxvalue`: æœ€å¤§å€¼é™åˆ¶
- `choices`: æšä¸¾é€‰é¡¹é™åˆ¶

### ListField ä¸“ç”¨
- `min_length`: åˆ—è¡¨æœ€å°é•¿åº¦
- `max_length`: åˆ—è¡¨æœ€å¤§é•¿åº¦
- `invalid_list_item`: åˆ—è¡¨é¡¹ç±»å‹é”™è¯¯

## ğŸ† æŠ€æœ¯ç‰¹ç‚¹

### Python 2/3 å…¼å®¹æ€§
- ä½¿ç”¨ `format()` æ–¹æ³•è€Œä¸æ˜¯ f-strings
- å…¼å®¹ Python 2 çš„å­—ç¬¦ä¸²ç±»å‹æ£€æŸ¥
- å…¼å®¹çš„å¼‚å¸¸å¤„ç†è¯­æ³•

### æ€§èƒ½ä¼˜åŒ–
- é›¶æ€§èƒ½å½±å“ï¼ˆä¸ä½¿ç”¨è‡ªå®šä¹‰æ¶ˆæ¯æ—¶ï¼‰
- æœ€å°å¼€é”€ï¼ˆä»…å­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼‰
- å†…å­˜å‹å¥½ï¼ˆæ¨¡æ¿ä»…åˆ›å»ºä¸€æ¬¡ï¼‰

### å¥å£®æ€§
- æ ¼å¼åŒ–å¤±è´¥æ—¶çš„ä¼˜é›…é™çº§
- ç©º/None é”™è¯¯æ¶ˆæ¯çš„æ­£ç¡®å¤„ç†
- å®Œæ•´çš„è¾¹ç•Œæƒ…å†µæµ‹è¯•

## ğŸ‰ æ€»ç»“

æˆåŠŸä¸º Python2 å…¼å®¹çš„ Field ç±»å‹æ ¡éªŒç³»ç»Ÿæ·»åŠ äº†å®Œæ•´çš„è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯åŠŸèƒ½ï¼š

1. **åŠŸèƒ½å®Œæ•´**: æ”¯æŒæ‰€æœ‰éªŒè¯ç±»å‹çš„è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯
2. **æ˜“äºä½¿ç”¨**: ç®€å•çš„å­—å…¸é…ç½®æ–¹å¼
3. **çµæ´»å¼ºå¤§**: æ”¯æŒæ¨¡æ¿æ ¼å¼åŒ–å’Œå¤šè¯­è¨€
4. **å‘åå…¼å®¹**: ä¸å½±å“ä»»ä½•ç°æœ‰ä»£ç 
5. **æµ‹è¯•å®Œå¤‡**: 25+ ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ100% é€šè¿‡ç‡
6. **æ–‡æ¡£é½å…¨**: è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹

è¿™ä¸ªå®ç°å¤§å¤§æå‡äº†å­—æ®µéªŒè¯ç³»ç»Ÿçš„ç”¨æˆ·ä½“éªŒï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿæä¾›æ›´å‹å¥½ã€æ›´å…·ä½“çš„é”™è¯¯æç¤ºä¿¡æ¯ã€‚
