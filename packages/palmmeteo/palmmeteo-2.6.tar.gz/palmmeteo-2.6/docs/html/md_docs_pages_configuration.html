<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PALM-meteo: PALM-meteo configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PALM-meteo
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">PALM-meteo configuration </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Each case for PALM-meteo is configured using one or more <em>YAML</em> configuration files. If more than one files is used, the latter files extend and overwrite the prior files.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Configuration options</h1>
<p >The list of all options which are considered user-configurable is supplied in the file <code>template.yaml</code>. This file contains the options with their default values and documentation as comments:</p>
<div class="fragment"><div class="line"># A template with all user-selectable configuration options. Most options are</div>
<div class="line"># commented out and the values shown are the defaults.</div>
<div class="line"> </div>
<div class="line">############################## GENERIC OPTIONS ##############################</div>
<div class="line"> </div>
<div class="line">#case: #case name (required)</div>
<div class="line"># Optional scenario identification (for preparing multiple scenarios based on</div>
<div class="line"># the same case)</div>
<div class="line">#scenario:</div>
<div class="line">#dnum: 1 #1 for root domain, 2 for nested domain *_N02 etc.</div>
<div class="line"> </div>
<div class="line"># One or more tasks selected by the user will add required plugins and set</div>
<div class="line"># necessary options. Tasks typically select input meteo and/or chemistry data</div>
<div class="line"># sources.</div>
<div class="line">tasks:</div>
<div class="line">    - wrf         # WRF meteo inputs</div>
<div class="line">    #- wrf_rad    # WRF radiation inputs</div>
<div class="line">    #- icon       # ICON inputs</div>
<div class="line">    #- aladin     # Aladin inputs</div>
<div class="line">    #- aladin_rad # Aladin inputs</div>
<div class="line">    #- camx       # CAMx chemistry inputs</div>
<div class="line">    #- cams       # CAMS chemistry inputs</div>
<div class="line">    #- synthetic  # Profiles and other synthetic inputs</div>
<div class="line">    #- winddamp   # Postprocessor for wind damping near walls</div>
<div class="line"> </div>
<div class="line"># Replacement strings to be used in paths. They are valid Python expressions</div>
<div class="line"># and they may reference configuration values such as `dnum` or `scenario`.</div>
<div class="line">path_strings:</div>
<div class="line">    #case: &#39;case&#39;</div>
<div class="line">    #scenario: &#39;f&quot;_{scenario}&quot; if scenario else &quot;&quot;&#39;</div>
<div class="line">    #domain: &#39;f&quot;_N{dnum:02d}&quot; if dnum != 1 else &quot;&quot;&#39;</div>
<div class="line"> </div>
<div class="line"># All paths are either absolute or relative to paths.base. They may contain</div>
<div class="line"># references to entries in path_strings</div>
<div class="line">paths:</div>
<div class="line">    #base: &#39;../JOBS/{case}{scenario}&#39;</div>
<div class="line"> </div>
<div class="line">    palm_input:</div>
<div class="line">        #dynamic_driver: &#39;INPUT/{case}_dynamic{domain}&#39;</div>
<div class="line">        #static_driver:  &#39;INPUT/{case}_static{domain}&#39;</div>
<div class="line"> </div>
<div class="line">    intermediate:</div>
<div class="line">        #import_data: &#39;METEO/import{domain}.nc&#39;</div>
<div class="line">        #hinterp:     &#39;METEO/hinterp{domain}.nc&#39;</div>
<div class="line">        #vinterp:     &#39;METEO/vinterp{domain}.nc&#39;</div>
<div class="line"> </div>
<div class="line">    snapshot:</div>
<div class="line">        #setup_model:  &#39;METEO/setup{domain}.pickle.zst&#39;</div>
<div class="line">        #import_data:  &#39;METEO/import{domain}.pickle.zst&#39;</div>
<div class="line">        #hinterp:      &#39;METEO/hinterp{domain}.pickle.zst&#39;</div>
<div class="line">        #vinterp:      &#39;METEO/vinterp{domain}.pickle.zst&#39;</div>
<div class="line"> </div>
<div class="line">    wrf:</div>
<div class="line">        #file_mask:      &#39;WRF/wrfout_*.e000&#39;</div>
<div class="line">        #rad_file_mask:  &#39;WRF/auxhist6_*&#39;</div>
<div class="line"> </div>
<div class="line">    camx:</div>
<div class="line">        #file_mask:      &#39;CAMX/CAMx.*.nc&#39;</div>
<div class="line"> </div>
<div class="line">    icon:</div>
<div class="line">        #file_mask:      &#39;ICON/i?ff[0-9]_*.nc*&#39;</div>
<div class="line">        #static_data:    ~</div>
<div class="line"> </div>
<div class="line">    aladin:</div>
<div class="line">        #output:         &#39;ALADIN/aladin_import.nc&#39;</div>
<div class="line">        #grib_file_mask: &#39;ALADIN/ALADIN_GRIBS/**/*.grb&#39;</div>
<div class="line">        #soil_depth:     &#39;ALADIN/aladin_soil_depth.grb&#39;</div>
<div class="line"> </div>
<div class="line">    cams:</div>
<div class="line">        #file:           &#39;CAMS&#39;</div>
<div class="line"> </div>
<div class="line">output:</div>
<div class="line">    # Overwrite existing output files? Otherwise create a new file with</div>
<div class="line">    # numerical suffix</div>
<div class="line">    #overwrite: false</div>
<div class="line"> </div>
<div class="line">    #geostrophic_wind: false #not available with all plugins</div>
<div class="line"> </div>
<div class="line">    # LODs for output variables:</div>
<div class="line">    # LOD2 = 3D data (unchanged, default),</div>
<div class="line">    # LOD1 = vertical profile (via horizontal averaging).</div>
<div class="line">    lod:</div>
<div class="line">        #pt: 2</div>
<div class="line">        #qv: 2</div>
<div class="line">        #uvw: 2</div>
<div class="line"> </div>
<div class="line">    #default_precision: &#39;f4&#39;</div>
<div class="line">    #fill_value: -9999.0</div>
<div class="line"> </div>
<div class="line">    #check_mass_balance: false #re-verify final mass balance after balancing</div>
<div class="line"> </div>
<div class="line">intermediate_files:</div>
<div class="line">    #after a successful stage, delete the intermediate file from the previous stage</div>
<div class="line">    delete_after_success: false</div>
<div class="line"> </div>
<div class="line">domain:</div>
<div class="line">    #dz: #default=dx</div>
<div class="line">    nz: #required</div>
<div class="line">    #dz_stretch_level: -1.0 #in metres</div>
<div class="line">    #dz_stretch_factor: 1.0</div>
<div class="line">    #dz_max: -1.0 #in metres</div>
<div class="line"> </div>
<div class="line">    # Check minimum number of free surface canopy layers above the top of</div>
<div class="line">    # terrain, buildings and plant canopy</div>
<div class="line">    #nscl_free: 3</div>
<div class="line"> </div>
<div class="line">    # Ignore buildings in the static driver (for nscl_free and wind damping)</div>
<div class="line">    #ignore_buildings: false</div>
<div class="line"> </div>
<div class="line">simulation:</div>
<div class="line">    #origin_time: #default: read from static driver</div>
<div class="line">    #timestep: 1 h</div>
<div class="line">    #length: 1 d</div>
<div class="line"> </div>
<div class="line">    #timestep_rad: auto # default: detect from input files (if possible)</div>
<div class="line">    #timestep_rad: 10 m # explicit</div>
<div class="line"> </div>
<div class="line">#radiation: false #off by default, switched on by tasks or manually</div>
<div class="line"> </div>
<div class="line">#chem_species: [] #empty list = disabled chemistry</div>
<div class="line"> </div>
<div class="line">hinterp:</div>
<div class="line">    #validate: false</div>
<div class="line">    #max_input_grid_error: 0.01</div>
<div class="line"> </div>
<div class="line">vinterp:</div>
<div class="line">    # Smoothing of PALM terrain for WRF vertical interpolation to avoid sharp</div>
<div class="line">    # horizontal gradients. Sigma value in grid points.</div>
<div class="line">    #terrain_smoothing: off</div>
<div class="line"> </div>
<div class="line">    # Upper limit of vertical adaptation for terrain matching</div>
<div class="line">    # [metres above highest obstacles]</div>
<div class="line">    #transition_level: 300.0</div>
<div class="line"> </div>
<div class="line">    # code used for the interpolation</div>
<div class="line">    #interpolator: prepared  #pure-Python interpolator with prepared weights (default)</div>
<div class="line">    #interpolator: metpy     #legacy interpolator from the MetPy library (slow)</div>
<div class="line">    #interpolator: fortran   #Fortran-based interpolator (fastest, must be compiled using f2py)</div>
<div class="line"> </div>
<div class="line">    #wind_power_law: false #off by default</div>
<div class="line">    #wind_power_law: 0.147</div>
<div class="line"> </div>
<div class="line">postproc:</div>
<div class="line">    #nox_post_sum: false</div>
<div class="line"> </div>
<div class="line">#verbosity: 1 #can be overwritten by command-line switches -v (=2) or -s (=0)</div>
<div class="line">#log_datetime: true #prepend each log message with date+time</div>
<div class="line"> </div>
<div class="line"># Workflow: optionally select a subset of stages</div>
<div class="line">#workflow:</div>
<div class="line">#    - check_config</div>
<div class="line">#    - setup_model</div>
<div class="line">#    - import_data</div>
<div class="line">#    - hinterp</div>
<div class="line">#    - vinterp</div>
<div class="line">#    - write</div>
<div class="line"> </div>
<div class="line">######################### PLUGIN-SPECIFIC OPTIONS #########################</div>
<div class="line"> </div>
<div class="line">wrf:</div>
<div class="line">    # Compose continuous timeseries for the simululation using one or more</div>
<div class="line">    # forecast/assimilation cycles from the set of input files</div>
<div class="line">    assim_cycles:</div>
<div class="line">        # Interval between assimilation cycles to be used (a larger time</div>
<div class="line">        # interval can be specified in order to use every nth cycle).</div>
<div class="line">        #cycles_used: 3 h    # time interval</div>
<div class="line">        #cycles_used: single # use one specified cycle</div>
<div class="line">        #cycles_used: all    # default: use all files, assume they are continuous</div>
<div class="line"> </div>
<div class="line">        # Datetime for the reference cycle from which the selected cycle</div>
<div class="line">        # intervals are counted, or the selected cycle if cycles_used=single.</div>
<div class="line">        # Default: 00:00 UTC from the first day of simulation.</div>
<div class="line">        #reference_cycle:</div>
<div class="line"> </div>
<div class="line">        # Earliest horizon (time since cycle time) to be used in the</div>
<div class="line">        # simulation. If set to higher than 0, the 0th file of each cycle must</div>
<div class="line">        # still be available to load the level heights (HHL).</div>
<div class="line">        #earliest_horizon: 0 h</div>
<div class="line"> </div>
<div class="line">    # Method of stretching or squeezing of the intermediate-height levels</div>
<div class="line">    # before vertical interpolation in order to match the target</div>
<div class="line">    # (high-resolution) terrain, while limiting the propagation of</div>
<div class="line">    # surface-reltaed effects to higher levels. (Do not confuse with PALM&#39;s</div>
<div class="line">    # vertically stretched grid as in dz_stretch_level and dz_stretch_factor.)</div>
<div class="line">    # May be one of:</div>
<div class="line">    # universal:    A universal method where levels above</div>
<div class="line">    #               vinterp:transition_level are kept unmodified while the</div>
<div class="line">    #               levels below are stretched/squeezed gradually.</div>
<div class="line">    # hybrid:       Use the WRF hybrid vertical coordinate system from the</div>
<div class="line">    #               WRFOUT input files to stretch the levels. WARNING: the WRF</div>
<div class="line">    #               model must be configured to using hybrid levels, not sigma</div>
<div class="line">    #               leves, there is no check for this!</div>
<div class="line">    # sigma:        Use the WRF sigma levels system from the WRFOUT input</div>
<div class="line">    #               files to stretch the levels. WARNING: the WRF model must be</div>
<div class="line">    #               configured to using sigma levels, not hybrid leves, there</div>
<div class="line">    #               is no check for this!</div>
<div class="line">    #vertical_adaptation: universal</div>
<div class="line"> </div>
<div class="line">    #radiation_smoothing_distance: 10000.0</div>
<div class="line"> </div>
<div class="line">    rad_vars:</div>
<div class="line">        #sw_tot_h: SWDOWN #may be also SWDNB</div>
<div class="line">        #sw_dif_h: SWDDIF</div>
<div class="line">        #lw_tot_h: GLW #may be also LWDNB</div>
<div class="line"> </div>
<div class="line">camx:</div>
<div class="line">    # True: model grid is Lambert Conformal Conic from the coupled WRF model.</div>
<div class="line">    # This uses bilinear inteprolation based on WRF-specific ellipsoid. False</div>
<div class="line">    # (default): use universal triangular interpolation.</div>
<div class="line">    #uses_wrf_lambert_grid: false</div>
<div class="line"> </div>
<div class="line">    # Python-code checks on input file variables and attributes. May also be</div>
<div class="line">    # extended by individual output variables.</div>
<div class="line">    #validations: []</div>
<div class="line"> </div>
<div class="line">    # A list of variables loaded for processing. May also be extended by</div>
<div class="line">    # individual output variables.</div>
<div class="line">    #loaded_vars: []</div>
<div class="line"> </div>
<div class="line">    # An optional preprocessing Python code on loaded variables, as triggered</div>
<div class="line">    # by individual output variables.</div>
<div class="line">    #preprocessors:</div>
<div class="line">    #    PM25: &#39;PM25 = PSO4+PNO3+PNH4+POA+PEC+FPRM+SOA1+SOA2+SOA3+SOA4+SOPA+SOPB&#39;</div>
<div class="line"> </div>
<div class="line">synthetic:</div>
<div class="line">    #prof_vars:</div>
<div class="line">    #    u: {profiles: ~, heights: ~, timeseries: ~, times: ~}</div>
<div class="line">    #    v: {profiles: ~, heights: ~, timeseries: ~, times: ~}</div>
<div class="line">    #    w: {profiles: ~, heights: ~, timeseries: ~, times: ~}</div>
<div class="line">    #    pt: {profiles: ~, heights: ~, timeseries: ~, times: ~}</div>
<div class="line">    #    qv: {profiles: ~, heights: ~, timeseries: ~, times: ~}</div>
<div class="line">    #    soil_t: {profiles: ~, heights: ~, timeseries: ~, times: ~}</div>
<div class="line">    #    soil_m: {profiles: ~, heights: ~, timeseries: ~, times: ~}</div>
<div class="line"> </div>
<div class="line">    #p_surf: ~</div>
<div class="line">    #p_sl: 100000.</div>
<div class="line"> </div>
<div class="line">aladin:</div>
<div class="line">    #load_gribs: true</div>
<div class="line">    #vertical_adaptation: universal</div>
<div class="line"> </div>
<div class="line">    #radiation_smoothing_distance: 10000.0</div>
<div class="line"> </div>
<div class="line">    #soil_depth_default: 0.40</div>
<div class="line">    #soil_avg_point: [ 14.418540, 50.073658 ]</div>
<div class="line"> </div>
<div class="line">icon:</div>
<div class="line">    # Compose continuous timeseries for the simululation using one or more</div>
<div class="line">    # forecast/assimilation cycles from the set of input files</div>
<div class="line">    assim_cycles:</div>
<div class="line">        # Interval between assimilation cycles to be used (a larger time</div>
<div class="line">        # interval can be specified in order to use every nth cycle).</div>
<div class="line">        #cycles_used: 3 h    # default: time interval</div>
<div class="line">        #cycles_used: single # use one specified cycle</div>
<div class="line"> </div>
<div class="line">        # Datetime for the reference cycle from which the selected cycle</div>
<div class="line">        # intervals are counted, or the selected cycle if cycles_used=single.</div>
<div class="line">        # Default: 00:00 UTC from the first day of simulation.</div>
<div class="line">        #reference_cycle:</div>
<div class="line"> </div>
<div class="line">        # Earliest horizon (time since cycle time) to be used in the</div>
<div class="line">        # simulation. If set to higher than 0, the 0th file of each cycle must</div>
<div class="line">        # still be available to load the level heights (HHL).</div>
<div class="line">        #earliest_horizon: 0 h</div>
<div class="line"> </div>
<div class="line">    # The disaggregated values (radiation) represent centres of intervals</div>
<div class="line">    # between timesteps, therefore to cover the full duration of the</div>
<div class="line">    # simulation, one more time interval before and after the simulation are</div>
<div class="line">    # required. Enable this to allow skipping them using extrapolation.</div>
<div class="line">    #allow_skip_first_disaggr: true</div>
<div class="line">    #allow_skip_last_disaggr: true</div>
<div class="line"> </div>
<div class="line">    # Distance [km] for selecting nearby grid points usable for interpolation.</div>
<div class="line">    # Recommended value: original grid resolution × 3</div>
<div class="line">    #point_selection_buffer: 20.0</div>
<div class="line"> </div>
<div class="line">    #radiation_smoothing_distance: 30.0 #km</div>
<div class="line"> </div>
<div class="line">cams:</div>
<div class="line"> </div>
<div class="line">winddamp:</div>
<div class="line">    # Distance in number of grid cells from the wall which have some wind</div>
<div class="line">    # damping. Cells further from the wall will have no damping.</div>
<div class="line">    #damping_dist: 2</div>
<div class="line"> </div>
<div class="line">    # Distance in number of grid cells from the wall which are damped to zero.</div>
<div class="line">    # The next cells further from the wall have a damping factor which</div>
<div class="line">    # increases linearly to 1.</div>
<div class="line">    #num_zeroed: 1</div>
<div class="line"> </div>
<div class="line">    # Method of staggering the damping factor for the U, V and W wind</div>
<div class="line">    # components by taking adjacent cells in the respective dimension.</div>
<div class="line">    #stagger_method: average #default</div>
<div class="line">    #stagger_method: minimum</div>
<div class="line"> </div>
</div><!-- fragment --><p >This file may be used as a template for a new PALM-meteo configuration by uncommenting the values that the user wants to change.</p>
<p >Any valid options not listed in the file <code>template.yaml</code> are intended for developers only.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Specifying paths</h2>
<p >The option <code>paths.base</code> specifies the base path for all other paths. It may be either an absolute path or a path relative to the current directory (the directory from which PALM-meteo was started). All other paths are either absolute or relative to <code>paths.base</code>.</p>
<p >Any path option may contain <b>replacement strings</b> in curly braces. These are used to simplify the specification of typical paths. For example, the string <code>{domain}</code> is (by default) replaced either with <code>_N02</code>, <code>_N03</code> etc. or with an empty string for domain number 1, so that it represents a typical file suffix for PALM input and output files (such as the dynamic or static driver).</p>
<p >Even the replacement strings may be customized using the configuration section <code>path_strings:</code>; each item specifies a Python expression which gets evaluated as a replacement string and it may reference other configuration options.</p>
<p >The default configuration of paths expects a typical PALM setup: the <code>JOBS</code> directory placed next to the PALM-meteo instalation directory, within which there are input and output files for individual jobs. Apart from PALM's standard per-job subdirectories such as <code>INPUT</code>, PALM-meteo adds the subdirectory <code>METEO</code> with its intermediate files. In addition to that, some standard plugins expect other directories with their inputs (such as the <code>WRF</code> directory with WRFOUT files, unless configured otherwise).</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Specifying time durations</h2>
<p >The configuration options which expect duration (not absolute time), such as <code>simulation.length</code> and <code>simulation.timestep</code>, are specified as a number and unit, which is one of: <code>d</code> (days), <code>h</code> (hours), <code>m</code> (minutes) or <code>s</code> (seconds).</p>
<p >The number and unit are separated by space(s). You may also use decimal numbers or combine multiple units, so the string <code>1 d 3.5 h</code> translates to 27.5 hours. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
