<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PALM-meteo: PALM-meteo: processor of meteorological input data for the PALM model system</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PALM-meteo
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">PALM-meteo: processor of meteorological input data for the PALM model system </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="mainpage"></a> PALM-meteo is an advanced and modular tool to create PALM's <em>dynamic driver</em> with initial and boundary conditions (IBC) and other time-varying data, typically using (but not limited to) outputs from mesoscale models. It is a successor to multiple older projects for PALM dynamic drivers, most importantly the deprecated <a href="https://gitlab.palm-model.org/dynamic_driver/wrf_interface">WRF-interface</a> project.</p>
<p >The documentation for PALM-meteo is available at <a href="https://palm-tools.github.io/palmmeteo/">https://palm-tools.github.io/palmmeteo/</a>.</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Functionality</h1>
<p >The PALM-meteo workflow consists of six <em>stages</em>. Normally, they are all executed sequentially, but it is possible to stop the execution after any stage and restart it later (see also <a class="el" href="md_docs_pages_running.html">Running PALM-meteo</a>).</p>
<ol type="1">
<li><b>Configuration</b> (<code>check_config</code>): Loads and validates user configuration.</li>
<li><b>Domain and model set-up</b> (<code>setup_model</code>): setting up basic items such as the geometry of the PALM model domain. Currently this requires providing the already prepared PALM <em>static driver</em>.</li>
<li><b>Input data loading</b> (<code>import_data</code>): selection of requested variables, area selection, transformation and/or unit conversion where required. Certain input variables are also temporally disagregated.</li>
<li><b>Horizontal interpolation</b> (<code>hinterp</code>) from the input model grid to PALM grid. Includes geographic projection conversion where required. Models with traditional rectangular grid are regridded using bilinear interpolation, the ICON model with the icosahedral grid uses Delaunay triangulation and barycentric interpolation.</li>
<li><b>Vertical interpolation</b> (<code>vinterp</code>) from input model levels (which may be terrain-following, isobaric, eta, hybrid etc.) to PALM model levels (altitude-based). Part of this process is terrain matching, as the high-resolution PALM terrain may differ, even significantly, from the input model terrain. This process includes configurable vertical adaptation, where the lowest input layer is shifted to match the PALM terrain while in the higher layers, the vertical shifts are progressively smaller until they reach the <em>transition level</em>, above which they are not shifted at all.</li>
<li><b>Output generation</b> (<code>write</code>) creates the final PALM dynamic driver. Final adjustments are performed here, notably the mass balancing which is performed on all boundaries (respecting terrain on lateral boundaries), so that the PALM's internal mass balancing (which is performed only on the top boundary as a last resort) is not overused.</li>
</ol>
<p >Currently PALM-meteo supports these meteorological inputs:</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Meteorological IBC</h2>
<ul>
<li>WRF</li>
<li>ICON</li>
<li>Aladin</li>
<li>Synthetic inputs (detailed profile specification etc.)</li>
</ul>
<h2><a class="anchor" id="autotoc_md2"></a>
Radiation inputs (optional)</h2>
<ul>
<li>WRF</li>
<li>ICON</li>
<li>Aladin</li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Chemical IBC (optional)</h2>
<ul>
<li>CAMx</li>
<li>CAMS</li>
</ul>
<p >PALM-meteo is higly modular and more input sources will be likely added in the future. A detailed technical description will be made available in the upcoming scientific paper.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Installation</h1>
<p >There are three basic ways to install PALM-meteo.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Method 1: Simple minimal installation using PIP</h2>
<p >PALM-meteo is available in PyPI and it can be installed with the simple command: </p><pre class="fragment">pip3 install palmmeteo
</pre><p> This will also install the <code>pmeteo</code> command for running PALM-meteo. Depending on your operating system and environment, you may want to create a virtual environment first, or use the <code>--user</code> option, or use <a href="https://pipx.pypa.io/">pipx</a> instead of pip.</p>
<p >However, this method will install only the bare minimum to run PALM-meteo, without documentation and tests, so it is only recommended for experienced users who want a quick installation.</p>
<h2><a class="anchor" id="method2"></a>
Method 2: Full in-place installation with a virtual environment</h2>
<p >This is the recommended method for most users.</p>
<ol type="1">
<li>Make sure that you have python3, pip, and python-venv installed and available. This is operating system dependent.</li>
<li>Download and extract PALM-meteo into a directory of your choice. If you have already installed the PALM model system, then PALM-meteo is already extracted under <code>packages/dynamic_driver/palm_meteo</code>, albeit probably not in the newest version. Or you can download PALM-meteo from the <a href="https://gitlab.palm-model.org/dynamic_driver/palm_meteo">PALM gitlab server</a> or from <a href="https://github.com/PALM-tools/palmmeteo/releases">GitHub</a>.</li>
<li>From within the PALM-meteo install directory, run <code>./setup</code>. This will create a new virtual environment, install PALM-meteo with all dependencies and create a symlink to the <code>pmeteo</code> command (which enables the virtual environment automatically).</li>
</ol>
<h2><a class="anchor" id="autotoc_md6"></a>
Method 3: Advanced installation for developers</h2>
<ol type="1">
<li>Clone the PALM-meteo git repository.</li>
<li>Create and enable your own virtual environment if you prefer.</li>
<li>From within the PALM-meteo install directory, run <code>./setup_novenv</code>. This will install PALM-meteo dependencies and create a simple <code>pmeteo</code> running script.</li>
</ol>
<h2><a class="anchor" id="autotoc_md7"></a>
Testing</h2>
<p >PALM-meteo comes with integration tests supplied. When installed using <a class="el" href="index.html#method2">Method 2</a>, the install script performs the tests at the end of a successful instalation. You may also exectute them at any time from the PALM-meteo install directory using the command </p><pre class="fragment">tests/integration_tests/all_tests.sh
</pre><p> or for indivudal tests: </p><pre class="fragment">tests/integration_tests/test_XX_NAMEOFTEST.sh
</pre><p> You may also examine the directory <code>tests/integration_tests/simple_wrf</code> as a reference WRF case for PALM-meteo.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Optional dependencies</h2>
<p >Some plugins or extra functionalities have optional dependencies which are not part of the main installation as they are often not used. In the Method 1, you may enable them by using <code>pip3 install palmmeteo[extra_functionality]</code> for these extra functionalities: <code>vinterp_metpy</code> for the legacy MetPy vertical interpolation, <code>geostrophic_wind</code> or <code>aladin</code>. With the other install methods you need to manually install the Python packages listed in <code>pyproject.toml</code>.</p>
<p >It is also possible to use the fastest method for vertical interpolation (see <a class="el" href="md_docs_pages_configuration.html">configuration</a>) which uses natively compiled Fortran code. To do this, you must first compile it by running this command within the <code>palmmeteo</code> directory: </p><pre class="fragment">f2py -c -m vinterp_native vinterp_native.f90
</pre> <h1><a class="anchor" id="autotoc_md9"></a>
Usage</h1>
<p >For each dynamic driver, a <em>YAML</em> configuration file needs to be prepared (typically one per case, although it is possible to combine more files). This file uses sensible defaults for most options, so it does not need to be very long, as is demonstrated by the supplied file <code>example.yaml</code>. However for the beginners it is best to start by making a copy of the file <code>template.yaml</code>, which contains all user-selectable options with their defaults and documentation, and modifying it accordingly. See <a class="el" href="md_docs_pages_configuration.html">PALM-meteo configuration</a>.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Basic model configuration</h2>
<p >The main part of configuration is selecting a single or multiple <em>tasks</em> by adding a list item in the <code>tasks:</code> configuration section. Selecting a task means just telling what PALM-meteo what it has to do, which typically involves creating IBC and/or other PALM inputs using the selected method, such as using a specific input model.</p>
<p >These are the currently supported tasks (obviously many of them are mutually exclusive):</p>
<ul>
<li><code>wrf</code>: Create IBC from WRF model outputs.</li>
<li><code>wrf_rad</code>: Create PALM radiation inputs from WRF model outputs (typically <em>AUXHIST</em> outputs with potentially different time step from standard <em>WRFOUT</em>).</li>
<li><code>icon</code>: Create IBC from ICON outputs in the <em>NetCDF</em> format.</li>
<li><code>aladin</code>: Create IBC from Aladin outputs in the <em>grib</em> format.</li>
<li><code>camx</code>: Create chemistry IBC from CAMx model outputs.</li>
<li><code>cams</code>: Create chemistry IBC from CAMS model outputs.</li>
</ul>
<p >When the specified task(s) are selected, the task configuration mechanism enables the required plugins and pulls in the respective task-specific configuration defauls, which may be overwritten within the configuration file.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Running the model</h2>
<p >With a prepared configuration file such as <code>myconfig.yaml</code>, simply run </p><pre class="fragment">./pmeteo -c myconfig.yaml
</pre><p> in the project directory. See <a class="el" href="md_docs_pages_running.html">Running PALM-meteo</a> for more information.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Extending PALM-meteo</h1>
<p >In order to add new input types or processing methods, PALM-meteo can be easily extended with user plugins. For documentation, see the <a class="el" href="md_docs_pages_extending.html">Developer guide</a>.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
License and authors</h1>
<p >PALM-meteo is distributed under the GNU GPL v3+ license (see the <code>LICENSE</code> file). It was created by the Institute of Computer Science of the Czech Academy of Sciences (ICS CAS) with contributions by the Charles University in Prague (MFF UK), the Czech Hydrometeorological Institute (CHMI) and the Deutsche Wetterdienst (DWD).</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Acknowledgenments</h2>
<p >PALM-meteo was created with the support of these projects:</p>
<ul>
<li><a href="https://project-turban.eu/">TURBAN: Turbulent-resolving urban modeling of air quality and thermal comfort</a> (Technology Agency of the Czech Republic <a href="https://starfos.tacr.cz/en/projekty/TO01000219">project TO01000219</a>)</li>
<li><a href="https://carmine-project.eu/">CARMINE – Climate-Resilient Development Pathways in Metropolitan Regions of Europe</a> (European Commission <a href="https://cordis.europa.eu/projects/101137851">project 101137851</a>) </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
