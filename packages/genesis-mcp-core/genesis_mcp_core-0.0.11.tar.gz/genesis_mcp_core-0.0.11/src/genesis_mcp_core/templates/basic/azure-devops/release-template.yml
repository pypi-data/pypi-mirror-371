jobs:
- job: UpdateImageTag
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - checkout: none
  - task: AzureCLI@2
    inputs:
      azureSubscription: '{{ HELM_SERVICE_CONNECTION_NAME }}'
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        echo "Updating image tag for {{ SERVICE_NAME }}"
        echo "New version: $(Build.BuildNumber)"
        echo "Branch: $(Build.SourceBranchName)"
        
        # Here you would typically update your GitOps repo or trigger deployment
        # This is a placeholder for your specific deployment process
        
        # Example: Update values file in GitOps repo
        # git clone https://github.com/your-org/gitops-repo.git
        # cd gitops-repo
        # sed -i "s/tag: .*/tag: $(Build.BuildNumber)/" environments/$(Build.SourceBranchName)/{{ SERVICE_NAME }}/values.yaml
        # git add .
        # git commit -m "Update {{ SERVICE_NAME }} to $(Build.BuildNumber)"
        # git push
    displayName: 'Update Image Tag in GitOps'
