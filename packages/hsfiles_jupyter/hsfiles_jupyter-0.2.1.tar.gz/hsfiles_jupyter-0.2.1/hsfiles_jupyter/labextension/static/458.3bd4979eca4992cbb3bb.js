(self.webpackChunkhsfiles_jupyter=self.webpackChunkhsfiles_jupyter||[]).push([[458],{458:function(e,t,o){var n,i,l=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,l){function a(e){try{s(n.next(e))}catch(e){l(e)}}function r(e){try{s(n.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}s((n=n.apply(e,t||[])).next())}))};n=[o,t,o(830),o(209),o(421),o(310),o(256),o(655)],i=function(e,t,o,n,i,a,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class d extends r.Widget{constructor(){super(),this.addClass("jp-SpinnerWidget");const e=new n.Spinner;this.node.appendChild(e.node)}}function c(e,t){return l(this,void 0,void 0,(function*(){const o=i.ServerConnection.makeSettings(),n=a.URLExt.join(o.baseUrl,"hydroshare",e),l=yield i.ServerConnection.makeRequest(n,t,o),r=yield l.json();if(r.response.error)throw new Error(r.response.error);return r.response}))}let u=null;function h(e){e.node.style.pointerEvents="none",e.node.style.opacity="0.5",console.log("File browser disabled")}function y(e){e.node.style.pointerEvents="auto",e.node.style.opacity="1",console.log("File browser enabled")}function f(e){return"string"==typeof e&&/^[0-9a-f]{32}$/.test(e)}function p(e){const t=e.currentWidget;if(!t)return!1;const o=t.selectedItems().next();return!(!o||!o.value)&&function(e){if(!u||!u.download_dir)return!1;const t=u.download_dir;if(!t||"string"!=typeof t)return!1;if(!e.startsWith(t+"/"))return!1;const o=e.split(t+"/")[1];if(!o)return!1;const n=o.split("/");if(n.length<4)return!1;const i=n[0],l=n[1],a=n[2];return f(i)&&"data"===l&&"contents"===a}(o.value.path)}function b(e,t,o,i,a,r,s={}){return l(this,void 0,void 0,(function*(){const l=t.currentWidget;if(l){const u=l.selectedItems().next();if(u&&u.value){const l=u.value.path,f=t.currentWidget;h(f);const p=new d,b=new n.MainAreaWidget({content:p});b.id=`spinner-${o.replace(/\s+/g,"-")}`,b.title.label="Processing...",e.shell.add(b,"main"),e.shell.currentChanged,p.node.style.display="block";try{const e=yield c(i,{method:"POST",body:JSON.stringify(Object.assign({path:l},s))});p.node.style.display="none";const t="function"==typeof a?a(e):a;console.log(t,l),yield(0,n.showDialog)({title:t,body:r(e),buttons:[n.Dialog.okButton({label:"OK"})]})}catch(e){const t=`${o} Failed:`;e instanceof Error?(console.error(t,e.message),yield(0,n.showDialog)({title:`${o} Failed`,body:`Error: ${e.message}.`,buttons:[n.Dialog.okButton({label:"OK"})]})):console.error(t,e)}finally{p.isAttached&&(p.parent=null),b.dispose(),y(f)}}}}))}const g={id:"hsfiles_jupyter:plugin",autoStart:!0,requires:[o.IFileBrowserFactory],activate:(e,t)=>{const{commands:o}=e,{tracker:i}=t;console.log("JupyterLab extension hsfiles_jupyter is activated!"),function(){return l(this,void 0,void 0,(function*(){if(u)return u;const e=yield c("config",{method:"GET"});return u=e,e}))}().catch((e=>{console.error("Failed to load configuration from backend. HydroShare file operations will be disabled:",e),u=null})),o.addCommand("upload-to-hydroshare",{label:"Upload File to HydroShare",icon:s.addIcon,isEnabled:()=>p(i),execute:()=>l(void 0,void 0,void 0,(function*(){const t=i.currentWidget;if(t){const o=t.selectedItems().next();if(o&&o.value){const t=o.value.path,a=i.currentWidget;h(a);const r=new d,s=new n.MainAreaWidget({content:r});s.id="spinner-upload-to-hydroshare",s.title.label="Processing...",e.shell.add(s,"main"),e.shell.currentChanged,r.node.style.display="block",yield function(e,t,o,i,a,r){return l(this,void 0,void 0,(function*(){try{const e=yield c("status",{method:"POST",body:JSON.stringify({path:o})});if("Exists in HydroShare"===e.status||"Exists in HydroShare but they are different"===e.status||"Exists in HydroShare and they are identical"===e.status){if("Replace"===(yield(0,n.showDialog)({title:"File Already Exists",body:"This file already exists in HydroShare. Would you like to replace it?",buttons:[n.Dialog.cancelButton({label:"Cancel"}),n.Dialog.okButton({label:"Replace"})],defaultButton:0})).button.label){yield c("delete",{method:"POST",body:JSON.stringify({path:o})});const e=yield c("upload",{method:"POST",body:JSON.stringify({path:o})});yield(0,n.showDialog)({title:"File upload to HydroShare was successful",body:e.success,buttons:[n.Dialog.okButton({label:"OK"})]})}}else{const e=yield c("upload",{method:"POST",body:JSON.stringify({path:o})});yield(0,n.showDialog)({title:"File upload to HydroShare was successful",body:e.success,buttons:[n.Dialog.okButton({label:"OK"})]})}}catch(e){const t="Upload file to HydroShare Failed:";e instanceof Error?(console.error(t,e.message),yield(0,n.showDialog)({title:"Upload Failed",body:`Error: ${e.message}.`,buttons:[n.Dialog.okButton({label:"OK"})]})):console.error(t,e)}finally{a.isAttached&&(a.parent=null),r.dispose(),y(i)}}))}(0,0,t,a,r,s)}}}))}),o.addCommand("refresh-from-hydroshare",{label:"Replace with File from HydroShare",icon:s.refreshIcon,isEnabled:()=>p(i),execute:()=>l(void 0,void 0,void 0,(function*(){"OK"===(yield(0,n.showDialog)({title:"Replace File",body:"Replace will overwrite the local copy of the file. Are you sure you want replace this file from HydroShare?",buttons:[n.Dialog.cancelButton({label:"Cancel"}),n.Dialog.okButton({label:"OK"})],defaultButton:0})).button.label&&(yield b(e,i,"Replace with file from HydroShare","refresh","File replace from HydroShare was successful",(e=>`${e.success}`)))}))}),o.addCommand("delete-file-from-hydroshare",{label:"Delete File in HydroShare",icon:s.closeIcon,isEnabled:()=>p(i),execute:()=>l(void 0,void 0,void 0,(function*(){"OK"===(yield(0,n.showDialog)({title:"Delete File",body:"Are you sure you want to permanently delete this file in HydroShare?",buttons:[n.Dialog.cancelButton({label:"Cancel"}),n.Dialog.okButton({label:"OK"})],defaultButton:0})).button.label&&(yield b(e,i,"Delete file in HydroShare","delete","File delete in HydroShare was successful",(e=>`${e.success}`)))}))}),o.addCommand("check-file-status-with-hydroshare",{label:"Check Status of File in HydroShare",icon:s.infoIcon,isEnabled:()=>p(i),execute:()=>b(e,i,"Check status of file in HydroShare","status",(e=>`File Status: ${e.status}`),(e=>`${e.success}`))}),o.addCommand("download-from-hydroshare",{label:"Download from HydroShare",icon:s.downloadIcon,isEnabled:()=>function(e){const t=e.currentWidget;if(!t)return!1;if(!u||!u.download_dir)return!1;const o=t.model.path,n=u.download_dir;if(!n||"string"!=typeof n)return!1;if(!o.startsWith(n+"/"))return!1;const i=o.split(n+"/")[1];if(!i)return!1;const l=i.split("/");return 0!==l.length&&!!f(l[0])&&(1===l.length||2===l.length&&"data"===l[1]||l.length>=3&&"data"===l[1]&&"contents"===l[2])}(i),execute:()=>function(e,t){return l(this,void 0,void 0,(function*(){const o=t.currentWidget;if(!o)return;const i=o.model.path;if(!u||!u.download_dir)return void(yield(0,n.showDialog)({title:"Configuration Error",body:"Invalid HydroShare download directory configuration. Please check your server configuration.",buttons:[n.Dialog.okButton({label:"OK"})]}));const l=u.download_dir;if(!l||"string"!=typeof l)return void(yield(0,n.showDialog)({title:"Configuration Error",body:"Invalid HydroShare download directory configuration. Please check your server configuration.",buttons:[n.Dialog.okButton({label:"OK"})]}));let a="";const s=i.split(l+"/")[1];if(s){const e=s.split("/")[0];f(e)&&(a=e)}if(!a)return void(yield(0,n.showDialog)({title:"Error",body:"Could not find resource ID in the current path in file browser.",buttons:[n.Dialog.okButton({label:"OK"})]}));const p=i.split(a)[0],b=t.currentWidget;h(b);const g=new d,m=new n.MainAreaWidget({content:g});m.id="spinner-download-from-hydroshare",m.title.label="Processing...",e.shell.add(m,"main"),e.shell.currentChanged,g.node.style.display="block";try{const e=yield c("list_files",{method:"POST",body:JSON.stringify({resource_id:a,base_path:p})});if(!e.available_files||0===e.available_files.length)return void(yield(0,n.showDialog)({title:"No Files Available",body:"All files from this resource have already been downloaded.",buttons:[n.Dialog.okButton({label:"OK"})]}));const t=e.available_files.map((e=>({label:e,value:e}))),o=document.createElement("select");o.className="jp-mod-styled",o.style.width="100%",o.style.marginBottom="15px",t.forEach((e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,o.appendChild(t)}));const i=document.createElement("div");i.className="jp-select-wrapper",i.style.minHeight="100px",i.style.minWidth="300px",i.style.padding="10px",i.appendChild(document.createTextNode("Select a file to download:")),i.appendChild(document.createElement("br")),i.appendChild(document.createElement("br")),i.appendChild(o);const l=new r.Widget({node:i});if(l.node.style.minHeight="150px",l.node.style.minWidth="350px","Download"===(yield(0,n.showDialog)({title:"Download from HydroShare",body:l,buttons:[n.Dialog.cancelButton({label:"Cancel"}),n.Dialog.okButton({label:"Download"})],defaultButton:1})).button.label){const e=o.value,t=yield c("download",{method:"POST",body:JSON.stringify({resource_id:a,file_path:e,base_path:p})});yield(0,n.showDialog)({title:"Download Successful",body:t.success,buttons:[n.Dialog.okButton({label:"OK"})]}),b.model.refresh()}}catch(e){const t="Download from HydroShare Failed:";e instanceof Error?(console.error(t,e.message),yield(0,n.showDialog)({title:"Download Failed",body:`Error: ${e.message}.`,buttons:[n.Dialog.okButton({label:"OK"})]})):console.error(t,e)}finally{g.isAttached&&(g.parent=null),m.dispose(),y(b)}}))}(e,i)}),e.contextMenu.addItem({type:"separator",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10}),e.contextMenu.addItem({command:"upload-to-hydroshare",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.1}),e.contextMenu.addItem({command:"refresh-from-hydroshare",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.2}),e.contextMenu.addItem({command:"delete-file-from-hydroshare",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.3}),e.contextMenu.addItem({command:"check-file-status-with-hydroshare",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.4}),e.contextMenu.addItem({type:"separator",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.5}),e.contextMenu.addItem({command:"download-from-hydroshare",selector:".jp-FileBrowser",rank:11})}};t.default=g}.apply(t,n),void 0===i||(e.exports=i)}}]);