"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2737],{23364:function(e,n,t){var r=t(35453),a=t(80189),o=t(63297),s=t(93556),i=t(50959),l=t(82187),c=t.n(l),u=t(12602),d=t(8544),p=t(69887),f=["className","component","viewBox","spin","rotate","tabIndex","onClick","children"],m=i.forwardRef((function(e,n){var t=e.className,l=e.component,m=e.viewBox,v=e.spin,x=e.rotate,h=e.tabIndex,g=e.onClick,y=e.children,j=(0,s.Z)(e,f),b=i.useRef(),k=(0,u.x1)(b,n);(0,p.Kp)(Boolean(l||y),"Should have `component` prop or `children`."),(0,p.C3)(b);var C=i.useContext(d.Z),Z=C.prefixCls,w=void 0===Z?"anticon":Z,N=C.rootClassName,_=c()(N,w,(0,o.Z)({},"".concat(w,"-spin"),!!v&&!!l),t),M=c()((0,o.Z)({},"".concat(w,"-spin"),!!v)),R=x?{msTransform:"rotate(".concat(x,"deg)"),transform:"rotate(".concat(x,"deg)")}:void 0,S=(0,a.Z)((0,a.Z)({},p.vD),{},{className:M,style:R,viewBox:m});m||delete S.viewBox;var P=h;return void 0===P&&g&&(P=-1),i.createElement("span",(0,r.Z)({role:"img"},j,{ref:k,tabIndex:P,onClick:g,className:_}),l?i.createElement(l,S,y):y?((0,p.Kp)(Boolean(m)||1===i.Children.count(y)&&i.isValidElement(y)&&"use"===i.Children.only(y).type,"Make sure that you provide correct `viewBox` prop (default `0 0 1024 1024`) to the icon."),i.createElement("svg",(0,r.Z)({},S,{viewBox:m}),y)):null)}));m.displayName="AntdIcon",n.Z=m},2917:function(e,n,t){t.d(n,{Z:function(){return d}});var r=t(35453),a=t(93556),o=t(50959),s=t(23364),i=["type","children"],l=new Set;function c(e){return Boolean("string"==typeof e&&e.length&&!l.has(e))}function u(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=e[n];if(c(t)){var r=document.createElement("script");r.setAttribute("src",t),r.setAttribute("data-namespace",t),e.length>n+1&&(r.onload=function(){u(e,n+1)},r.onerror=function(){u(e,n+1)}),l.add(t),document.body.appendChild(r)}}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.scriptUrl,t=e.extraCommonProps,l=void 0===t?{}:t;n&&"undefined"!=typeof document&&"undefined"!=typeof window&&"function"==typeof document.createElement&&(Array.isArray(n)?u(n.reverse()):u([n]));var c=o.forwardRef((function(e,n){var t=e.type,c=e.children,u=(0,a.Z)(e,i),d=null;return e.type&&(d=o.createElement("use",{xlinkHref:"#".concat(t)})),c&&(d=c),o.createElement(s.Z,(0,r.Z)({},l,u,{ref:n}),d)}));return c.displayName="Iconfont",c}},78093:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(35453),a=t(50959),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"},s=t(52273),i=function(e,n){return a.createElement(s.Z,(0,r.Z)({},e,{ref:n,icon:o}))};var l=a.forwardRef(i)},75853:function(e,n,t){t.r(n),t.d(n,{default:function(){return ue}});var r,a,o=t(90228),s=t.n(o),i=t(87999),l=t.n(i),c=t(48305),u=t.n(c),d=t(49280),p=t(82344),f=t(57989),m=t(67581),v=t(38551),x=t(90468),h=t(85885),g=t(82187),y=t.n(g),j=t(32699),b=t.n(j),k=t(50959),C=t(94299),Z=t(91082),w=t(15558),N=t.n(w),_=t(26068),M=t.n(_),R=t(53649),S=t.n(R),P=t(58573),z=t(90343),E=t(38780),I=t(59995),A=t(77353),B=t(34155),T=t(19019),q=t(51076),K=t(87497),L=t(76808),U=t(68476),Y=t(8267),H=t(23333),V=t(83603),O=t(54876),D=(t(99951),t(97884)),G=t(1731),F=t(2284),J=t(26174),$=t(24662),X=(t(29031),t(32314),t(76223),t(39616)),Q=t(80912),W=t(63057),ee=t(8450),ne=t(91860),te=t(11527),re=K.Z.Text,ae=D.ZP.div(r||(r=S()(["\n  margin: 16px 32px 10px;\n  position: relative;\n"]))),oe=(0,D.ZP)(re)(a||(a=S()(["\n  position: absolute;\n  bottom: -20px;\n  left: 0;\n"]))),se=[{type:"InputNumber",name:"top_n",label:{text:"Top N",isLocalized:!1},attrs:{min:1},rules:[{required:!0,message:"Top N is required"}]}],ie=(0,k.forwardRef)((function(e,n){var t=e.modelList,r=(0,v.useIntl)(),a=(0,I.ZP)(),o=(0,k.useState)(!1),i=u()(o,2),c=i[0],d=i[1],p=(0,k.useState)(!1),f=u()(p,2),m=f[0],x=f[1],g=(0,k.useState)(null),j=u()(g,2),C=j[0],w=j[1],_=(0,k.useState)(!1),R=u()(_,2),S=R[0],K=R[1],D=(0,k.useRef)(null),re=(0,k.useRef)(null),ie=(0,k.useRef)(0),le=(0,k.useRef)(null),ce=(0,k.useRef)(!0),ue=(0,k.useState)(!1),de=u()(ue,2),pe=de[0],fe=de[1],me=(0,k.useState)([]),ve=u()(me,2),xe=ve[0],he=ve[1],ge=(0,k.useState)(!1),ye=u()(ge,2),je=ye[0],be=ye[1],ke=(0,k.useState)([{text:"",uid:-1,name:""},{text:"",uid:-2,name:""}]),Ce=u()(ke,2),Ze=Ce[0],we=Ce[1],Ne=(0,k.useState)(""),_e=u()(Ne,2),Me=_e[0],Re=_e[1],Se=(0,k.useRef)(null),Pe=(0,E.Z)(),ze=Pe.initialize,Ee=Pe.updateScrollerPosition,Ie=(0,$.X)({modelList:t,isChat:!0},{defaultValues:{top_n:3},defaultParamsConfig:se,metaKeys:J.m4}),Ae=Ie.handleOnValuesChange,Be=Ie.formRef,Te=Ie.paramsConfig,qe=Ie.initialValues,Ke=Ie.parameters,Le=Ie.paramsRef,Ue=Ie.modelMeta,Ye=Ie.formFields;(0,k.useImperativeHandle)(n,(function(){return{viewCode:function(){d(!0)},setCollapse:function(){K(!S)},collapse:S}}));var He=function(){var e;return null===(e=re.current)||void 0===e?void 0:e.setMessageId()};(0,k.useEffect)((function(){r.locale;var e=F.H[r.locale];e&&(we(e.documents.map((function(e,n){return{text:e,uid:He(),name:"Document ".concat(n+1),percent:void 0,score:void 0,rank:void 0}}))),Re(e.query))}),[]);var Ve=(0,k.useMemo)((function(){return function(e){var n=e.api,t=e.parameters,r=window.location.origin;return{curlCode:"\ncurl ".concat(r).concat(n,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n').concat((0,X.Yy)(t,!1)).trim(),pythonCode:'\nimport requests\n\nurl="'.concat(r).concat(n,'"\nheaders = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n}\ndata = ').concat(JSON.stringify(t,null,2),"\n\nresponse = requests.post(url, headers=headers, json=data)\nprint(response.json())").trim(),nodeJsCode:"\nconst axios = require('axios');\n\nconst url = \"".concat(r).concat(n,'";\nconst headers = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n};\nconst data = ').concat(JSON.stringify(t,null,2),";\n\naxios.post(url, data, { headers }).then((response) => {\n  console.log(response.data);\n});").trim()}}({api:"/v1/rerank",parameters:M()(M()({},b().pick(Ke,["model"].concat(N()(b().split(Ye,","))))),{},{query:Me,documents:[].concat(N()(Ze),N()(xe)).map((function(e){return e.text})).filter((function(e){return e}))})})}),[Ke,Ye,Me,Ze,xe]),Oe=function(){var e=l()(s()().mark((function e(n){var t,r,o,i,l,c,u,d,p,f,m;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,be(!Me),w(null),e.next=5,null===(t=Be.current)||void 0===t?void 0:t.form.validateFields();case 5:if(Ke.model&&Me){e.next=7;break}return e.abrupt("return");case 7:if(l=[].concat(N()(Ze),N()(xe)),l.filter((function(e){return e.text})).length){e.next=12;break}return fe(!0),e.abrupt("return");case 12:return fe(!1),x(!0),He(),null===(r=le.current)||void 0===r||null===(o=r.cancel)||void 0===o||o.call(r),le.current=a(),c=Ze.filter((function(e){return e.text})),we(c),e.next=21,(0,Z.AA)({model:Ke.model,top_n:Ke.top_n,query:n,documents:c.map((function(e){return e.text}))},{token:le.current.token});case 21:u=e.sent,He(),w(u.usage),d=b().sortBy(u.results||[],(function(e){return e.relevance_score})),p=d[d.length-1].relevance_score,f=d[0].relevance_score,m=c.map((function(e){return e.percent=void 0,e.score=void 0,e.rank=void 0,e})),null===(i=u.results)||void 0===i||i.forEach((function(e,n){var t,r,a,o,s,i,l;m[e.index]=M()(M()({},m[e.index]),{},{uid:He(),rank:n+1,score:e.relevance_score,showExtra:!0,percent:(t={min:f,max:p,value:e.relevance_score},r=[.5,1],a=r[0],o=r[1],s=t.min,i=t.max,l=t.value,isNaN(l)||isNaN(s)||isNaN(i)||s>i?0:s===i?100:100*(a+(l-s)*(o-a)/(i-s)))})})),m=b().sortBy(m,"rank"),we(m),e.next=36;break;case 33:e.prev=33,e.t0=e.catch(0),w({error:!0,errorMessage:(0,G.Yo)(e.t0.response)});case 36:return e.prev=36,x(!1),e.finish(36);case 39:case"end":return e.stop()}}),e,null,[[0,33,36,39]])})));return function(n){return e.apply(this,arguments)}}(),De=(0,k.useMemo)((function(){return null!=Ue&&Ue.n_ctx&&null!=Ue&&Ue.n_slot?(0,te.jsx)(U.Z.Item,{children:(0,te.jsx)(z.Z,{disabled:!0,label:"Max Tokens",value:b().divide(null==Ue?void 0:Ue.n_ctx,null==Ue?void 0:Ue.n_slot)})}):null}),[Ue]),Ge=(0,k.useCallback)((function(e,n){e.model&&w(null),Ae(e,n)}),[]);return(0,k.useEffect)((function(){D.current&&ze(D.current)}),[ze]),(0,k.useEffect)((function(){Ze.length+xe.length>ie.current&&Ee(),ie.current=Ze.length+xe.length}),[Ze.length,xe.length]),(0,te.jsxs)("div",{className:"ground-left-wrapper rerank",children:[(0,te.jsxs)("div",{className:"ground-left",children:[(0,te.jsxs)("div",{className:"ground-left-footer",children:[(0,te.jsx)("h3",{className:"m-l-10 flex-between flex-center font-size-14 line-24 m-b-0",style:{padding:"0 32px",marginTop:16},children:(0,te.jsx)("span",{children:r.formatMessage({id:"playground.rerank.query"})})}),(0,te.jsxs)(ae,{children:[(0,te.jsx)(Y.Z.Search,{allowClear:!0,value:Me,onSearch:function(e,n,t){"clear"!==t.source&&Oe(e)},onChange:function(e){Re(e.target.value),be(!e.target.value)},enterButton:(0,te.jsx)(H.Z,{title:(0,te.jsx)("span",{children:r.formatMessage({id:"common.button.submit"})}),children:(0,te.jsx)("span",{className:"full-wrap",children:(0,te.jsx)(A.Z,{rotate:0,className:"font-size-14"})})}),placeholder:r.formatMessage({id:"playground.rerank.query.holder"})}),je&&(0,te.jsx)(oe,{type:"danger",children:r.formatMessage({id:"playground.rerank.query.validate"})})]})]}),(0,te.jsxs)("div",{className:"center",ref:D,children:[(0,te.jsxs)("div",{className:"documents",children:[(0,te.jsxs)("div",{className:"flex-between m-b-8 doc-header",children:[(0,te.jsx)("h3",{className:"m-l-10 flex-between flex-center font-size-14 line-24 m-b-0",children:(0,te.jsx)("span",{children:r.formatMessage({id:"playground.embedding.documents"})})}),(0,te.jsxs)("div",{className:"flex-center gap-10",children:[(0,te.jsx)(H.Z,{title:r.formatMessage({id:"playground.input.multiplePaste.tips"}),children:(0,te.jsxs)(V.Z,{defaultChecked:ce.current,onChange:function(e){ce.current=e.target.checked},children:[r.formatMessage({id:"playground.input.multiplePaste"}),(0,te.jsx)(B.Z,{className:"m-l-4"})]})}),(0,te.jsxs)(h.ZP,{size:"middle",onClick:function(){var e;null===(e=re.current)||void 0===e||e.handleAdd()},children:[(0,te.jsx)(T.Z,{}),r.formatMessage({id:"playground.embedding.addtext"})]}),(0,te.jsx)(h.ZP,{icon:(0,te.jsx)(q.Z,{}),size:"middle",disabled:m,onClick:function(){we([{text:"",uid:He(),name:""},{text:"",uid:He(),name:""}]),he([]),w(null),fe(!1)},children:r.formatMessage({id:"common.button.clear"})})]})]}),(0,te.jsxs)("div",{className:"docs-wrapper",children:[(0,te.jsx)(W.Z,{ref:re,textList:Ze,showLabel:!1,height:46,onChange:function(e){var n=null==e?void 0:e.map((function(e){return e.percent=void 0,e.score=void 0,e.rank=void 0,e}));we(n)},extra:function(e){if(!e.showExtra||!e.percent)return null;var n=e.percent;return(0,te.jsxs)("div",{className:"rank-wrapper",children:[(0,te.jsx)("div",{className:"percent-wrapper",children:(0,te.jsx)("div",{className:"pregress-bar",style:{backgroundImage:"linear-gradient(90deg, var(--ant-blue-5) 0%, var(--ant-blue-2) 100%)",width:"".concat(n,"%"),height:"4px",borderRadius:"2px"}})}),(0,te.jsxs)("span",{className:"flex-center hover-hidden rank-tag",children:[(0,te.jsxs)(L.Z,{color:"geekblue",bordered:!1,children:[r.formatMessage({id:"playground.rerank.rank"}),": ",e.rank]}),(0,te.jsxs)(L.Z,{color:"gold",bordered:!1,children:[r.formatMessage({id:"playground.rerank.score"}),":"," ",b().round(e.score,2)]})]})]})},onSelect:function(e){Se.current=e},onPaste:function(e,n){if(ce.current){var t=e.clipboardData.getData("text");if(t){var r,a,o=t.split("\n").map((function(e){return{text:null==e?void 0:e.trim(),name:"",uid:He(),percent:void 0,score:void 0,rank:void 0}}));o[0].text="".concat((null===(r=Se.current)||void 0===r?void 0:r.beforeText)||"").concat(o[0].text).concat((null===(a=Se.current)||void 0===a?void 0:a.afterText)||"");var s=[].concat(N()(Ze.slice(0,n)),N()(o),N()(Ze.slice(n+1))).filter((function(e){return e.text}));we(s)}}}}),pe&&(0,te.jsx)("div",{className:"m-t-16",children:(0,te.jsx)(P.Z,{type:"danger",message:r.formatMessage({id:"playground.documents.verify.rerank"})})}),(0,te.jsx)(ee.Z,{tokenResult:C,className:"m-t-16"})]})]}),(0,te.jsx)("div",{}),(0,te.jsx)("div",{className:"message-list-wrap",style:{paddingInline:0,paddingTop:0},children:(0,te.jsx)(te.Fragment,{children:(0,te.jsx)("div",{className:"content",children:m&&(0,te.jsx)(O.Z,{size:"small",children:(0,te.jsx)("div",{style:{height:"46px"}})})})})})]})]}),(0,te.jsx)("div",{className:y()("params-wrapper",{collapsed:S}),ref:Le,children:(0,te.jsx)("div",{className:"box",children:(0,te.jsx)(Q.Z,{ref:Be,onValuesChange:Ge,paramsConfig:Te,initialValues:qe,modelList:t,extra:De})})}),(0,te.jsx)(ne.Z,{open:c,viewCodeContent:Ve,onCancel:function(){d(!1)},title:r.formatMessage({id:"playground.viewcode"})})]})})),le=ie,ce=t(83458),ue=(t(64232),function(){var e=(0,v.useIntl)(),n=((0,k.useRef)(null),(0,k.useRef)(null)),t=(0,k.useState)([]),r=u()(t,2),a=r[0],o=r[1],i=(0,k.useState)(!1),c=u()(i,2),g=c[0],j=c[1];(0,ce.Z)({handler:function(){var e,t;null===(e=n.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e)},triggeredRef:n.current});var w=(0,k.useCallback)((function(){var e,t;null===(e=n.current)||void 0===e||null===(t=e.viewCode)||void 0===t||t.call(e)}),[n]),N=(0,k.useCallback)((function(){var e,t;null===(e=n.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e)}),[n]);(0,k.useEffect)((function(){var e=function(){var e=l()(s()().mark((function e(){var n,t,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={categories:f.Us.reranker,with_meta:!0},e.next=4,(0,Z.nb)(n);case 4:return t=e.sent,r=b().map(t.data||[],(function(e){return{value:e.id,label:e.id,meta:e.meta}})),e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),n=function(){var n=l()(s()().mark((function n(){var t,r,a;return s()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Promise.all([e()]);case 3:t=n.sent,r=u()(t,1),a=r[0],o(a),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),j(!0);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})));return function(){return n.apply(this,arguments)}}();n()}),[]);return(0,C.y1)(p.ZP.RIGHT.join(","),(function(){var e,t;null===(e=n.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e)}),{preventDefault:!0}),(0,te.jsx)(m._z,{ghost:!0,header:{title:e.formatMessage({id:"menu.playground.rerank"}),style:{paddingInline:"var(--layout-content-header-inlinepadding)"},breadcrumb:{}},extra:(0,te.jsxs)(x.Z,{children:[(0,te.jsx)(h.ZP,{size:"middle",onClick:w,icon:(0,te.jsx)(d.Z,{type:"icon-code",className:"font-size-16"}),children:e.formatMessage({id:"playground.viewcode"})}),(0,te.jsx)(h.ZP,{size:"middle",onClick:N,icon:(0,te.jsx)(d.Z,{type:"icon-a-layout6-line",className:"font-size-16"})})]},"buttons"),className:y()("playground-container chat"),children:(0,te.jsx)("div",{className:"play-ground",children:(0,te.jsx)("div",{className:"chat",children:(0,te.jsx)(le,{ref:n,modelList:a,loaded:g})})})})})},99951:function(){},76223:function(){}}]);