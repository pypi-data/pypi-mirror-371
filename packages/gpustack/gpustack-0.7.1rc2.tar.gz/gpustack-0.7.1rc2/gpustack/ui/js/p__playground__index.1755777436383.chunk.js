"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8268],{2179:function(e,n,t){t.r(n),t.d(n,{default:function(){return bn}});var s=t(90228),a=t.n(s),l=t(87999),i=t.n(l),r=t(48305),o=t.n(r),c=t(49280),u=t(37963),d=t(82344),m=t(69997),h=t(57989),f=t(92067),p=t(63830),g=t(67581),v=t(38551),x=t(90468),y=t(85885),j=t(96938),b=t(47946),k=t(82187),C=t.n(k),w=t(32699),M=t.n(w),Z=t(50959),S=t(94299),N=t(91082),R=t(15558),I=t.n(R),P=t(26068),A=t.n(P),T=t(54876),E=(t(99951),t(1731)),L=t(39121),_=t(26174),z=t(38780),O=t(69510);function G(e){var n=(0,z.Z)(),t=n.initialize,s=n.updateScrollerPosition,l=(0,Z.useState)(!1),r=o()(l,2),c=r[0],u=r[1],d=(0,Z.useState)(null),m=o()(d,2),h=m[0],f=m[1],p=(0,Z.useState)([]),g=o()(p,2),v=g[0],x=g[1],y=(0,Z.useRef)(null),j=(0,Z.useRef)(0),b=(0,Z.useRef)(""),k=(0,Z.useRef)(null),C=(0,Z.useRef)(0),w=(0,Z.useRef)(""),S=function(){return j.current=j.current+1,j.current},R=function(e){var n;if(f(A()({},null!==(n=null==e?void 0:e.usage)&&void 0!==n?n:{})),e&&M().get(e,"choices",[]).length){w.current=w.current+M().get(e,"choices.0.delta.reasoning_content",""),b.current=b.current+M().get(e,"choices.0.delta.content","");var t,s=(t={content:b.current,reasoningContent:w.current}).reasoningContent&&!t.content?"<think>".concat(t.reasoningContent):t.reasoningContent&&t.content?"<think>".concat(t.reasoningContent,"</think>").concat(t.content):t.content;x([].concat(I()(v),I()(k.current),[{role:E.G7.Assistant,content:s,uid:j.current}]))}},P=function(){var e,n;null===(e=y.current)||void 0===e||null===(n=e.abort)||void 0===n||n.call(e,"stop"),u(!1),f(null)},T=function(){var e=i()(a()().mark((function e(n){var t,s,l,i,r,o,c,d,m,h,p,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u(!0),S(),f(null),l=n.current,i=n.parameters,r=n.system,null===(t=y.current)||void 0===t||null===(s=t.abort)||void 0===s||s.call(t,"cancel"),y.current=new AbortController,o=y.current.signal,k.current=l?[A()(A()({},l),{},{uid:j.current})]:[],b.current="",w.current="",x((function(e){return[].concat(I()(e),I()(k.current))})),c=[].concat(I()(r?[r]:[]),I()(v),I()(k.current)),d=(0,E.qK)(c),m=A()(A()({messages:d},i),{},{stream:!0,stream_options:{include_usage:!0}}),e.next=16,(0,O.U3)({data:m,url:N.qt,signal:o});case 16:if(null==(h=e.sent)||!h.error){e.next=20;break}return f({error:!0,errorMessage:(0,E.Yo)(h)}),e.abrupt("return");case 20:return S(),p=h.reader,g=h.decoder,e.next=24,(0,O.LN)(p,g,(function(e){null!=e&&e.error?f({error:!0,errorMessage:(0,E.Yo)(e.error)}):R(e)}));case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(0);case 29:return e.prev=29,u(!1),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[0,26,29,32]])})));return function(n){return e.apply(this,arguments)}}();return(0,Z.useEffect)((function(){e.current&&t(e.current)}),[e.current,t]),(0,Z.useEffect)((function(){c&&s()}),[v,c]),(0,Z.useEffect)((function(){v.length>C.current&&s(),C.current=v.length}),[v.length]),(0,Z.useEffect)((function(){return function(){P()}}),[]),{loading:c,tokenResult:h,messageList:v,setMessageId:S,setMessageList:x,handleClear:function(){x([]),f(null)},handleAddNewMessage:function(e){var n,t=e||{role:(null===(n=M().last(v))||void 0===n?void 0:n.role)===E.G7.User?E.G7.Assistant:E.G7.User,content:""};x((function(e){return[].concat(I()(e),[A()(A()({},t),{},{uid:S()})])}))},handleStopConversation:P,updateScrollerPosition:s,submitMessage:T}}var D=t(24662),F=(t(29031),t(76223),t(39616)),U=function(e){var n=e.api,t=e.parameters,s=window.location.origin,a=n.replace(N.Mo,N.ZG),l="\ncurl ".concat(s).concat(a,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n').concat((0,F.Yy)(t,!1)).trim(),i='\nfrom openai import OpenAI\n\nclient = OpenAI(\n  base_url="'.concat(s,"/").concat(N.ZG,'", \n  api_key="YOUR_GPUSTACK_API_KEY"\n)\n\nresponse = client.chat.completions.create((\n').concat((0,F.G4)(A()({},t)),")\n\nprint(response.choices[0].message.content)").trim(),r=(0,F.GT)(A()({},t));return{curlCode:l,pythonCode:i,nodeJsCode:'\nconst OpenAI = require("openai");\n\nconst openai = new OpenAI({\n  "apiKey": "YOUR_GPUSTACK_API_KEY",\n  "baseURL": "'.concat(s,"/").concat(N.ZG,'"\n});\n\nasync function main() {\n  const params = ').concat(r,"; \n  const response = await openai.chat.completions.create(params);\n  console.log(response.choices[0].message.content);\n}\nmain();").trim()}},K=t(80912),$=t(88479),V=(t(64818),t(61033)),Y=t(63417),B=t(78734),H=t(10232),q=t(44896),W=t(48660),X=t(81e3),J=t(23333),Q=t(76574),ee=t(11527),ne=function(e){var n=e.actions,t=e.data,s=e.loading,l=e.updateMessage,r=e.onDelete,o=e.onEdit,c=(0,v.useIntl)(),u=function(){var e=i()(a()().mark((function e(n){var s,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,H.lH)(n.file);case 2:return s=e.sent,e.next=5,(0,H.a5)(n.file);case 5:i=e.sent,null==l||l({role:t.role,content:t.content,uid:t.uid,imgs:t.imgs||[],audio:[{uid:n.file.uid||n.fileList[0].uid,format:H.jH[n.file.type],base64:s.split(",")[1],data:M().pick(i,["url","name","duration"])}]});case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,ee.jsx)(ee.Fragment,{children:n.length>1&&!s?(0,ee.jsx)("div",{className:"actions",children:(0,ee.jsxs)("div",{className:"actions-wrap gap-5",children:[n.includes("upload")&&t.role===E.G7.User&&(0,ee.jsx)(Q.Z,{handleUpdateImgList:function(e){null==l||l({role:t.role,content:t.content,uid:t.uid,audio:t.audio||[],imgs:[].concat(I()(t.imgs||[]),I()(e))})}}),n.includes("upload")&&t.role===E.G7.User&&(0,ee.jsx)(B.Z,{type:"text",maxFileSize:1048576,accept:".mp3,.wav",size:"small",shape:"default",icon:(0,ee.jsx)(q.Z,{}),onChange:u}),n.includes("edit")&&t.role===E.G7.Assistant&&(0,ee.jsx)(J.Z,{title:c.formatMessage({id:"common.button.edit"}),children:(0,ee.jsx)(y.ZP,{size:"small",type:"text",icon:(0,ee.jsx)(W.Z,{}),onClick:o})}),t.content&&n.includes("copy")&&(0,ee.jsx)(Y.Z,{text:t.content,size:"small",shape:"default",type:"text",fontSize:"12px"}),n.includes("delete")&&(0,ee.jsx)(J.Z,{title:c.formatMessage({id:"common.button.delete"}),children:(0,ee.jsx)(y.ZP,{size:"small",type:"text",onClick:r,icon:(0,ee.jsx)(X.Z,{})})})]})}):null})},te=t(53649),se=t.n(te),ae=t(31079),le=t(67825),ie=t.n(le),re=t(80357),oe=(t(64720),t(56703)),ce=t(10314),ue=t(57434),de=t(77974),me=t(6229),he=t(97884),fe=t(43585),pe=(t(76848),/&(?:amp|lt|gt|quot|#(?:0+)?39);/g);RegExp(pe.source);var ge,ve,xe,ye=["children","className","node","theme"],je=["href","children"],be=he.ZP.div.attrs((function(){return{className:"markdown-viewer"}}))(ge||(ge=se()([""]))),ke=function(e){var n=e.children,t=e.className,s=(e.node,e.theme),a=ie()(e,ye),l=/language-(\w+)/.exec(t||"");return l?(0,ee.jsx)(fe.Z,{code:n,lang:l[1],theme:s}):(0,ee.jsx)("code",A()(A()({},a),{},{className:t,children:n}))},Ce=function(e){var n=e.content,t=e.theme,s=(0,Z.useMemo)((function(){return function(e){return e.replaceAll("$\\ce{","$\\\\ce{").replaceAll("$\\pu{","$\\\\pu{")}(function(e){for(var n="",t=0;t<e.length;t+=1){var s=e[t],a=e[t+1]||" ";"$"===s&&a>="0"&&a<="9"&&(s="\\$"),n+=s}return n}(n).replaceAll(/(```[\S\s]*?```|`.*?`)|\\\[([\S\s]*?[^\\])\\]|\\\((.*?)\\\)/g,(function(e,n,t,s){return n||(t?"$$".concat(t,"$$"):s?"$".concat(s,"$"):e)})))}),[n]);return(0,ee.jsx)(be,{children:(0,ee.jsx)(oe.U,{remarkPlugins:[[me.Z],de.Z,ue.Z],rehypePlugins:[ce.Z],components:{code:function(e){return(0,ee.jsx)(ke,A()(A()({},e),{},{theme:t}))},a:function(e){var n=e.href,t=e.children,s=ie()(e,je);return(0,ee.jsx)("a",A()(A()({href:(0,re.N)(n)},s),{},{target:"_blank",rel:"noopener noreferrer",children:t}))}},children:s})})},we=t(8267),Me=t(42326),Ze=function(e){var n=e.content,t=e.collapsed;return(0,ee.jsx)(ee.Fragment,{children:n?(0,ee.jsx)("div",{className:"think-wrapper",children:!t&&(0,ee.jsx)("div",{className:"think-content",children:(0,ee.jsx)(Ce,{content:n})})}):null})},Se=he.ZP.div(ve||(ve=se()(["\n  padding-top: 10px;\n  height: max-content;\n  width: max-content;\n  margin-inline: 10px;\n"]))),Ne=he.ZP.div.attrs({className:"custom-scrollbar-horizontal"})(xe||(xe=se()(["\n  display: flex;\n  justify-content: flex-start;\n  overflow-x: auto;\n  flex-direction: column;\n"]))),Re=(0,Z.forwardRef)((function(e,n){var t,s,l,r,c,u,d,m,h,f=e.editable,p=e.data,g=e.loading,v=e.reasoningContent,x=e.showMarkdown,y=e.collapsed,j=e.updateMessage,b=(0,Z.useRef)(null),k=(0,Z.useRef)(0),w=Z.useState(p.content),S=o()(w,2),N=S[0],R=S[1],P=(0,Z.useCallback)(function(){var e=i()(a()().mark((function e(n){var t,s,l,i,r,o,c;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.clipboardData||window.clipboardData,s=t.items,l=[],i=a()().mark((function e(){var n,t,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"file"===(n=s[r]).kind&&-1!==n.type.indexOf("image")?(t=n.getAsFile(),i=new Promise((function(e,n){var s=new FileReader;s.onload=function(t){var s,a=null===(s=t.target)||void 0===s?void 0:s.result;a?e(a):n("Failed to convert image to base64")},s.readAsDataURL(t)})),l.push(i)):n.kind;case 2:case"end":return e.stop()}}),e)})),r=0;case 5:if(!(r<s.length)){e.next=10;break}return e.delegateYield(i(),"t0",7);case 7:r++,e.next=5;break;case 10:return e.prev=10,e.next=13,Promise.all(l);case 13:(o=e.sent).length&&(c=M().map(o,(function(e){return k.current+=1,{uid:k.current,dataUrl:e}})),null==j||j({role:p.role,content:p.content,uid:p.uid,audio:p.audio||[],imgs:[].concat(I()(p.imgs||[]),I()(c))})),e.next=20;break;case 17:e.prev=17,e.t1=e.catch(10);case 20:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(n){return e.apply(this,arguments)}}(),[p,j]),A=function(e){e.clipboardData.getData("text")||(e.preventDefault(),P(e))},T=function(e){var n=M().filter(p.imgs,(function(n){return n.uid!==e}));null==j||j({role:p.role,content:p.content,uid:p.uid,audio:p.audio||[],imgs:n})},L=function(){null==j||j({role:p.role,content:p.content,uid:p.uid,audio:[],imgs:p.imgs||[]})},_=function(e){null==j||j({imgs:p.imgs||[],audio:p.audio||[],role:p.role,content:e.target.value,uid:p.uid})},z=function(e){R(e.target.value)},O=function(){R(p.content)},G=function(){null==j||j({role:p.role,content:N,uid:p.uid,audio:p.audio||[],imgs:p.imgs})},D=(0,Z.useCallback)((function(){var e;if(p.imgs&&(null===(e=p.imgs)||void 0===e?void 0:e.length)>0){var n=I()(p.imgs||[]).pop();n&&T(n.uid)}}),[p.imgs,T]),F=((0,Z.useCallback)((function(e){var n;"Backspace"===e.key&&""===p.content&&p.imgs&&(null===(n=p.imgs)||void 0===n?void 0:n.length)>0&&(e.preventDefault(),D())}),[p,D]),function(e){var n;e.stopPropagation(),e.preventDefault(),null===(n=b.current)||void 0===n||n.focus()});return(0,Z.useImperativeHandle)(n,(function(){return{handleSaveEdit:G,handleCancelEdit:O,setEditContent:R}})),(0,ee.jsx)(ee.Fragment,{children:f?(0,ee.jsxs)("div",{className:C()("message-content-input",{"has-img":(null===(c=p.imgs)||void 0===c?void 0:c.length)||p.audio&&(null===(u=p.audio)||void 0===u?void 0:u.length)>0}),onClick:F,children:[(0,ee.jsxs)(Ne,{children:[(0,ee.jsx)(Me.Z,{style:{paddingBlockEnd:0},editable:f,dataList:p.imgs||[],onDelete:T}),p.audio&&p.audio.length>0&&(0,ee.jsx)(Se,{className:null!==(d=p.imgs)&&void 0!==d&&d.length?"":"m-l-10",children:(0,ee.jsx)(ae.Z,{url:null===(m=p.audio)||void 0===m||null===(m=m[0])||void 0===m?void 0:m.data.url,name:null===(h=p.audio)||void 0===h||null===(h=h[0])||void 0===h?void 0:h.data.name,onDelete:L,height:50})})]}),(0,ee.jsx)(ee.Fragment,{children:p.role===E.G7.User?(0,ee.jsx)(we.Z.TextArea,{ref:b,value:p.content,variant:"filled",autoSize:{minRows:1},style:{borderRadius:"var(--border-radius-mini)"},readOnly:g,onChange:_,onPaste:A}):(0,ee.jsx)(ee.Fragment,{children:x?(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(Ze,{collapsed:y,content:v.thought,isThinking:g&&v.isThinking}),(0,ee.jsx)("div",{style:{paddingInline:4},children:(0,ee.jsx)(Ce,{content:"".concat(v.result||"")})})]}):(0,ee.jsx)(we.Z.TextArea,{ref:b,value:N,defaultValue:p.content,variant:"filled",autoSize:{minRows:1},style:{borderRadius:"var(--border-radius-mini)"},onChange:z,onPaste:A})})})]}):(0,ee.jsxs)("div",{className:C()("content-item-content",{"has-img":(null===(t=p.imgs)||void 0===t?void 0:t.length)||p.audio&&(null===(s=p.audio)||void 0===s?void 0:s.length)>0}),children:[(0,ee.jsxs)("div",{className:"justify-start ",children:[(0,ee.jsx)(Me.Z,{editable:f,dataList:p.imgs||[],onDelete:T}),p.audio&&p.audio.length>0&&(0,ee.jsx)(Se,{children:(0,ee.jsx)(ae.Z,{url:null===(l=p.audio)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.data.url,name:null===(r=p.audio)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.data.name,actions:[],height:50})})]}),p.content&&(0,ee.jsx)("div",{className:"text",children:p.content})]})})})),Ie=Re,Pe=t(25298),Ae=t.n(Pe),Te=t(17069),Ee=t.n(Te),Le=t(82092),_e=t.n(Le),ze=function(){function e(){Ae()(this,e),_e()(this,"lastCheckedIndex",void 0),_e()(this,"collecting",void 0),_e()(this,"thought",void 0),_e()(this,"result",void 0),this.thought="",this.result="",this.collecting=!1,this.lastCheckedIndex=0}return Ee()(e,[{key:"parse",value:function(e){for(;this.lastCheckedIndex<e.length;){var n=e.indexOf("<think>",this.lastCheckedIndex),t=e.indexOf("</think>",this.lastCheckedIndex);this.collecting?-1!==t?(this.thought+=e.substring(this.lastCheckedIndex,t),this.collecting=!1,this.lastCheckedIndex=t+8):(this.thought+=e.substring(this.lastCheckedIndex),this.lastCheckedIndex=e.length):-1!==t&&(-1===n||t<n)?(this.thought=this.result+e.substring(this.lastCheckedIndex,t),this.result="",this.lastCheckedIndex=t+8):-1!==n?(this.result+=e.substring(this.lastCheckedIndex,n),this.collecting=!0,this.lastCheckedIndex=n+7):(this.result+=e.substring(this.lastCheckedIndex),this.lastCheckedIndex=e.length)}return{thought:this.thought.trim(),result:this.result,isThinking:this.collecting}}},{key:"reset",value:function(){this.thought="",this.result="",this.collecting=!1,this.lastCheckedIndex=0}}]),e}(),Oe=function(e){var n=e.handleSave,t=e.handleCancel,s=(0,v.useIntl)();return(0,ee.jsx)("div",{className:"save-actions",children:(0,ee.jsxs)("div",{className:"actions-wrap gap-8",children:[(0,ee.jsx)(y.ZP,{size:"small",icon:(0,ee.jsx)(V.Z,{}),onClick:t,style:{borderRadius:"var(--border-radius-base)"},children:s.formatMessage({id:"common.button.cancel"})}),(0,ee.jsx)(y.ZP,{size:"small",type:"primary",icon:(0,ee.jsx)(c.Z,{type:"icon-save3"}),onClick:n,style:{borderRadius:"var(--border-radius-base)"},children:s.formatMessage({id:"common.button.save"})})]})})},Ge=function(e){var n=e.collapsed,t=e.setCollapsed,s=e.isThinking,a=(0,v.useIntl)();return(0,ee.jsx)("div",{className:"flex-center",style:{marginLeft:10,borderRadius:"var(--border-radius-base)",width:"max-content",overflow:"hidden"},children:(0,ee.jsxs)(y.ZP,{size:"small",type:"text",className:"flex-center",variant:"filled",color:"default",onClick:function(){return t(!n)},children:[(0,ee.jsx)("span",{children:s?a.formatMessage({id:"playground.chat.thinking"}):a.formatMessage({id:"playground.chat.aithought"})}),(0,ee.jsx)(c.Z,{type:"icon-down",rotate:n?0:180})]})})},De=function(e){var n=e.updateMessage,t=e.onDelete,s=e.loading,a=e.data,l=e.editable,i=e.showTitle,r=void 0===i||i,u=e.actions,d=void 0===u?["upload","delete","copy","edit"]:u,m=(0,v.useIntl)(),h=Z.useState(!0),f=o()(h,2),p=f[0],g=f[1],x=Z.useRef(null),y=Z.useRef(null),j=Z.useState(!1),b=o()(j,2),k=b[0],C=b[1],w=(0,Z.useMemo)((function(){return a.role===E.G7.User?{thought:"",isThinking:!1,result:""}:(!y.current&&p&&(y.current=new ze),p?y.current.parse(a.content):{thought:"",isThinking:!1,result:a.content})}),[a.content,p,a.role]),M=(0,Z.useMemo)((function(){if(!r)return null;var e=m.formatMessage({id:"playground.".concat(a.role)}),n=(0,ee.jsx)(c.Z,{type:"icon-user-filled",className:"font-size-16 m-r-5 text-tertiary"});return a.role===E.G7.Assistant&&(n=(0,ee.jsx)(c.Z,{type:"icon-assistant-filled",className:"font-size-16 m-r-5",style:{color:"var(--ant-blue-6)"}})),a.title&&(e=a.title),(0,ee.jsxs)("div",{className:"role flex-center",children:[n,e,a.role===E.G7.Assistant&&w.thought&&(0,ee.jsx)(Ge,{isThinking:s&&w.isThinking,collapsed:k,setCollapsed:C})]})}),[a.role,a.title,m,r,s,w.thought,w.isThinking,k]);return(0,ee.jsxs)("div",{className:"content-item",children:[(0,ee.jsx)("div",{className:"content-item-title",children:r&&M}),(0,ee.jsx)("div",{className:"content-item-role",style:{display:d.length?"flex":"none"},children:p?(0,ee.jsx)(ne,{data:a,actions:d,loading:s,onDelete:t,onEdit:function(){var e;g(!1),null===(e=x.current)||void 0===e||e.setEditContent(a.content)},updateMessage:n}):(0,ee.jsx)(Oe,{handleSave:function(){var e;null===(e=x.current)||void 0===e||e.handleSaveEdit(),g(!0)},handleCancel:function(){var e;null===(e=x.current)||void 0===e||e.handleCancelEdit(),g(!0)}})}),(0,ee.jsx)(Ie,{ref:x,editable:l,showMarkdown:p,data:a,loading:s,actions:d,collapsed:k,reasoningContent:w,updateMessage:function(e){var t;(null==n||n(e),a.role===E.G7.Assistant)&&(null===(t=y.current)||void 0===t||t.reset())}})]})},Fe=Z.memo(De),Ue=function(e){var n=e.setMessageList,t=e.messageList,s=e.editable,a=e.showTitle,l=void 0===a||a,i=e.loading,r=e.actions,o=void 0===r?["upload","delete","copy"]:r;return(0,ee.jsx)(ee.Fragment,{children:!!t.length&&(0,ee.jsx)("div",{className:"message-content-list",children:t.map((function(e,a){return(0,ee.jsx)(Fe,{loading:i,data:e,editable:s,actions:o,showTitle:l,onDelete:function(){return function(e){var s=I()(t);s.splice(e,1),null==n||n(s)}(a)},updateMessage:function(e){return function(e,s){var a=I()(t);a[e]=s,null==n||n(a)}(a,e)}},e.uid)}))})})},Ke=Z.memo(Ue),$e=t(43943),Ve=t(83603),Ye=t(76571),Be=function(e){var n=e.systemMessage,t=e.showApplyToAll,s=e.setSystemMessage,a=e.style,l=e.applyToAll,i=(0,v.useIntl)(),r=(0,Z.useState)(!1),c=o()(r,2),u=c[0],d=c[1],m=Z.useRef(null),h=(0,Z.useState)({minRows:1,maxRows:1,focus:!1}),f=o()(h,2),p=f[0],g=f[1],x=function(){g({minRows:4,maxRows:4,focus:!0}),setTimeout((function(){var e,n;null===(e=m.current)||void 0===e||null===(n=e.focus)||void 0===n||n.call(e,{cursor:"end"})}),100)};return(0,Z.useEffect)((function(){u&&(null==l||l(n))}),[u]),(0,ee.jsxs)("div",{className:C()("sys-message",{focus:p.focus}),style:A()({},a),children:[(0,ee.jsxs)("div",{style:{display:p.focus?"block":"none"},className:"textarea-wrapper",children:[(0,ee.jsx)("span",{className:"system-label",children:i.formatMessage({id:"playground.systemMessage"})}),(0,ee.jsx)(we.Z.TextArea,{className:"custome-scrollbar",ref:m,variant:"filled",placeholder:i.formatMessage({id:"playground.system.tips"}),style:{borderRadius:"0",border:"none"},value:n,autoSize:{minRows:p.minRows,maxRows:p.maxRows},onFocus:x,onBlur:function(e){g({minRows:1,maxRows:1,focus:!1})},allowClear:!1,onChange:function(e){s(e.target.value),u&&(null==l||l(e.target.value))}}),t&&(0,ee.jsxs)("span",{className:"apply-check",onMouseDown:function(e){e.preventDefault(),d(!u)},children:[(0,ee.jsx)("span",{className:"m-r-5",children:i.formatMessage({id:"playground.compare.applytoall"})}),(0,ee.jsx)(Ve.Z,{checked:u})]}),(0,ee.jsx)(Ye.Z,{style:{margin:"0"}})]}),!p.focus&&(0,ee.jsxs)("div",{className:"sys-content-wrap",onClick:x,children:[(0,ee.jsxs)("div",{className:"sys-content",children:[(0,ee.jsx)("span",{className:"title",children:i.formatMessage({id:"playground.systemMessage"})}),n||(0,ee.jsx)("span",{style:{color:"var(--ant-color-text-tertiary)"},children:i.formatMessage({id:"playground.system.tips"})})]}),n&&(0,ee.jsx)(J.Z,{title:i.formatMessage({id:"common.button.clear"}),children:(0,ee.jsx)(y.ZP,{className:"clear-btn",type:"text",icon:(0,ee.jsx)($e.Z,{}),size:"small",onClick:function(){s("")}})})]})]})},He=Z.memo(Be),qe=t(78093),We=t(87497),Xe=function(e){var n=(0,v.useIntl)(),t=e.usage,s=e.showOutput,a=void 0===s||s,l=e.scaleable,i=e.fields,r=void 0===i?["completion_tokens","prompt_tokens"]:i;return!t||M().isEmpty(t)?null:t.error?(0,ee.jsxs)(We.Z.Paragraph,{type:"danger",ellipsis:{rows:2,tooltip:null==t?void 0:t.errorMessage},style:{textAlign:"center",paddingBlock:0,margin:0,paddingInline:4,borderRadius:2,backgroundColor:"var(--ant-color-error-bg)"},children:[(0,ee.jsx)(qe.Z,{className:"m-r-8"}),null==t?void 0:t.errorMessage]}):(0,ee.jsxs)("div",{className:C()("reference-params",{scaleable:l}),children:[(0,ee.jsx)("span",{className:C()("usage",{scaleable:l}),children:(0,ee.jsx)(J.Z,{title:(0,ee.jsxs)(x.Z,{children:[r.includes("completion_tokens")&&(0,ee.jsxs)("span",{children:[n.formatMessage({id:"playground.completion"}),":"," ",t.completion_tokens]}),r.includes("prompt_tokens")&&(0,ee.jsxs)("span",{children:[n.formatMessage({id:"playground.prompt"}),":"," ",t.prompt_tokens]})]}),children:(0,ee.jsxs)("span",{children:[n.formatMessage({id:"playground.tokenusage"}),":"," ",t.total_tokens]})})}),a&&(0,ee.jsx)("span",{className:C()("usage",{scaleable:l}),children:(0,ee.jsx)(J.Z,{title:(0,ee.jsxs)(x.Z,{children:[(0,ee.jsxs)("span",{children:["TPOT: ",M().round(t.time_per_output_token_ms,2)||0," ms"]}),(0,ee.jsxs)("span",{children:["TTFT: ",M().round(t.time_to_first_token_ms,2)||0," ms"]})]}),children:(0,ee.jsxs)("span",{children:[n.formatMessage({id:"playground.tokenoutput"}),":"," ",M().round(t.tokens_per_second,2)||0," Tokens/s"]})})})]})},Je=t(91860),Qe=(0,Z.forwardRef)((function(e,n){var t,s=e.modelList,a=((0,v.useIntl)(),(0,Z.useState)("")),l=o()(a,2),i=l[0],r=l[1],c=(0,Z.useState)(!1),u=o()(c,2),d=u[0],m=u[1],h=(0,Z.useState)(!1),f=o()(h,2),p=f[0],g=f[1],x=(0,Z.useRef)(null),y=(0,Z.useState)(["upload","delete","copy","edit"]),j=o()(y,2),b=j[0],k=(j[1],G(x)),w=k.submitMessage,M=k.handleStopConversation,S=k.handleAddNewMessage,R=k.handleClear,P=k.setMessageList,z=k.tokenResult,O=k.messageList,F=k.loading,V=(0,D.X)({modelList:s,isChat:!0},{defaultValues:A()(A()({},_.Bx),{},{model:null===(t=s[0])||void 0===t?void 0:t.value}),defaultParamsConfig:L.Lw,metaKeys:_.m4}),Y=V.handleOnValuesChange,B=V.formRef,H=V.paramsRef,q=V.paramsConfig,W=V.initialValues,X=V.parameters;(0,Z.useImperativeHandle)(n,(function(){return{viewCode:function(){m(!0)},setCollapse:function(){g(!p)},collapse:p}}));var J=(0,Z.useMemo)((function(){var e=i?[{role:E.G7.System,content:i}]:[],n=(0,E.qK)(I()(O));return U({api:N.qt,parameters:A()(A()({},X),{},{messages:[].concat(e,I()(n))})})}),[O,i,X]);return(0,ee.jsxs)("div",{className:"ground-left-wrapper",children:[(0,ee.jsxs)("div",{className:"ground-left",children:[(0,ee.jsx)("div",{className:"message-list-wrap",ref:x,children:(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)("div",{style:{marginBottom:20},children:(0,ee.jsx)(He,{style:{borderRadius:"var(--border-radius-mini)",overflow:"hidden"},systemMessage:i,setSystemMessage:r})}),(0,ee.jsxs)("div",{className:"content",children:[(0,ee.jsx)(Ke,{messageList:O,setMessageList:P,editable:!0,loading:F,actions:b}),F&&(0,ee.jsx)(T.Z,{size:"small",children:(0,ee.jsx)("div",{style:{height:"46px"}})})]})]})}),z&&!F&&(0,ee.jsx)("div",{style:{height:40},children:(0,ee.jsx)(Xe,{usage:z})}),(0,ee.jsx)("div",{className:"ground-left-footer",children:(0,ee.jsx)($.Z,{defaultSize:{minRows:5,maxRows:5},actions:["clear","layout","role","upload","add","paste"],defaultChecked:!1,loading:F,disabled:!X.model,isEmpty:!O.length,handleSubmit:function(e){var n=function(e){var n,t;if(e.content||null!==(n=e.imgs)&&void 0!==n&&n.length||null!==(t=e.audio)&&void 0!==t&&t.length)return e}(e);w({system:i?{role:E.G7.System,content:i}:void 0,current:n,parameters:X})},addMessage:S,handleAbortFetch:M,clearAll:R})})]}),(0,ee.jsx)("div",{className:C()("params-wrapper",{collapsed:p}),ref:H,children:(0,ee.jsx)("div",{className:"box",children:(0,ee.jsx)(K.Z,{ref:B,onValuesChange:Y,paramsConfig:q,initialValues:W,modelList:s,showModelSelector:!0})})}),(0,ee.jsx)(Je.Z,{open:d,viewCodeContent:J,onCancel:function(){m(!1)}})]})})),en=Z.createContext({}),nn=t(23010),tn=function(e){var n=e.style,t=(0,v.useIntl)();(0,v.useNavigate)();return(0,ee.jsx)("div",{className:"flex-center  justify-center",style:A()({},n),children:(0,ee.jsx)(nn.Z,{image:nn.Z.PRESENTED_IMAGE_SIMPLE,description:(0,ee.jsx)("div",{className:"flex-column",children:(0,ee.jsx)(We.Z.Text,{type:"secondary",children:t.formatMessage({id:"playground.model.noavailable"})})})})})},sn=t(81745),an=t(7922),ln=t(8445),rn=t(62605),on=t(51076),cn=t(69070),un=t(1404),dn=t(43211),mn=t(84682),hn=t(94899),fn=t(40918),pn=(0,Z.forwardRef)((function(e,n){var t=e.modelList,s=e.model,a=e.instanceId,l=(0,Z.useContext)(en),i=l.globalParams,r=l.setGlobalParams,u=l.setLoadingStatus,d=l.handleDeleteModel,m=l.handleApplySystemChangeToAll,h=l.modelFullList,f=l.actions,p=(0,D.X)(e,{defaultValues:A()(A()({},_.Bx),{},{model:s}),defaultParamsConfig:L.Lw,metaKeys:_.m4}),g=p.handleOnValuesChange,x=p.handleOnModelChange,j=p.setParams,b=p.setInitialValues,k=p.formRef,C=p.paramsConfig,w=p.initialValues,S=p.parameters,R=(0,v.useIntl)(),P=(0,Z.useRef)(!1),z=(0,Z.useState)(""),O=o()(z,2),F=O[0],$=O[1],V=(0,Z.useState)(!1),Y=o()(V,2),B=Y[0],H=Y[1],q=(0,Z.useRef)(null),W=G(q),X=W.submitMessage,J=W.handleAddNewMessage,Q=W.handleClear,ne=W.setMessageList,te=W.handleStopConversation,se=W.tokenResult,ae=W.messageList,le=W.loading,ie=(0,Z.useMemo)((function(){var e=F?[{role:E.G7.System,content:F}]:[],n=(0,E.qK)(I()(ae));return U({api:N.qt,parameters:A()(A()({},S),{},{messages:[].concat(e,I()(n))})})}),[ae,F,S]),re=function(){te(),u(a,!1)},oe=function(e){var n=function(e){var n,t;if(e.content||null!==(n=e.imgs)&&void 0!==n&&n.length||null!==(t=e.audio)&&void 0!==t&&t.length)return e}(e);X({system:F?{role:E.G7.System,content:F}:void 0,current:n,parameters:S})},ce=(0,Z.useCallback)((function(e,n){g(e,A()(A()({},n),{},{model:S.model})),P.current&&r(A()({},n))}),[S,P.current]),ue=(0,Z.useMemo)((function(){var e=[{label:R.formatMessage({id:"common.button.clear"}),key:"clear",icon:(0,ee.jsx)(on.Z,{}),danger:!1,onClick:function(){ne([]),$("")}},{label:R.formatMessage({id:"playground.viewcode"}),key:"viewcode",icon:(0,ee.jsx)(c.Z,{type:"icon-code"}),onClick:function(){H(!0)}}];return t.length>2&&e.push({label:R.formatMessage({id:"common.button.delete"}),key:"delete",icon:(0,ee.jsx)(cn.Z,{}),danger:!0,onClick:function(){d(a)}}),e}),[t,R]);return(0,Z.useEffect)((function(){j((function(e){return A()(A()({},e),i)})),b((function(e){return A()(A()({},e),i)}))}),[i]),(0,Z.useEffect)((function(){return u(a,le),function(){u(a,!1)}}),[le]),(0,Z.useImperativeHandle)(n,(function(){return{submit:oe,abortFetch:re,addNewMessage:J,clear:Q,setSystemMessage:$,loading:le}})),(0,ee.jsxs)("div",{className:"model-item",children:[(0,ee.jsxs)("div",{className:"header",children:[(0,ee.jsx)("span",{className:"title",children:(0,ee.jsx)(mn.default,{style:{width:"100%"},variant:"borderless",options:h,onChange:function(e){x(e),Q()},value:S.model,labelRender:function(e){return(0,ee.jsx)(ln.Z,{ghost:!0,tooltipProps:{placement:"right"},minWidth:60,maxWidth:180,children:e.label})},optionRender:function(e){return(0,ee.jsx)(ln.Z,{ghost:!0,tooltipProps:{placement:"right"},minWidth:60,maxWidth:180,children:e.label})}})}),se&&!le&&(0,ee.jsx)(Xe,{usage:se,scaleable:!0}),(0,ee.jsxs)("span",{className:"action",children:[(0,ee.jsx)(hn.Z,{menu:{items:ue},placement:"bottomRight",children:(0,ee.jsx)(y.ZP,{type:"text",icon:(0,ee.jsx)(un.Z,{style:{fontSize:"14px"}}),size:"small"})}),(0,ee.jsx)(fn.Z,{autoAdjustOverflow:!0,overlayInnerStyle:{width:375,paddingInline:0},content:(0,ee.jsx)(rn.ZP,{maxHeight:500,style:{paddingInline:"24px"},oppositeTheme:!0,children:(0,ee.jsx)(K.Z,{ref:k,onValuesChange:ce,paramsConfig:C,initialValues:w,showModelSelector:!1,parametersTitle:(0,ee.jsxs)("div",{className:"flex-center flex-between",children:[(0,ee.jsx)("span",{children:R.formatMessage({id:"playground.parameters"})}),(0,ee.jsx)(Ve.Z,{onChange:function(e){P.current=e.target.checked,e.target.checked&&r(A()({},M().omit(S,"model")))},children:R.formatMessage({id:"playground.compare.applytoall"})})]})})}),trigger:["click"],arrow:!1,fresh:!0,title:!1,children:(0,ee.jsx)(y.ZP,{type:"text",icon:(0,ee.jsx)(dn.Z,{}),size:"small"})})]})]}),(0,ee.jsx)(He,{showApplyToAll:!0,systemMessage:F,applyToAll:m,setSystemMessage:$}),(0,ee.jsx)("div",{className:"content",ref:q,children:(0,ee.jsxs)("div",{children:[(0,ee.jsx)(Ke,{messageList:ae,setMessageList:ne,actions:f,editable:!0}),(0,ee.jsx)(T.Z,{spinning:le,size:"small",style:{width:"100%"}})]})}),(0,ee.jsx)(Je.Z,{open:B,viewCodeContent:ie,onCancel:function(){H(!1)}})]})})),gn=Z.memo(pn),vn=function(e){var n=e.spans,t=e.modelSelections,s=e.setModelRefs;return(0,ee.jsx)(sn.Z,{gutter:[16,0],style:{height:"100%"},children:t.map((function(e,a){return(0,ee.jsx)(an.Z,{span:n.span,style:{height:n.count<4?"calc(100% - 16px)":"calc(50% - 16px)"},children:(0,ee.jsx)(gn,{ref:function(n){return s(e.instanceId,n)},instanceId:e.instanceId,modelList:t,model:e.value},"".concat(e.value||"empty","-").concat(e.uid))},"".concat(e.value||"empty","-").concat(e.uid))}))})},xn=Z.memo(vn),yn=function(e){var n=e.modelList,t=e.loaded,s=(0,z.Z)().initialize,a=(0,Z.useState)({}),l=o()(a,2),i=l[0],r=l[1],c=(0,Z.useState)([]),u=o()(c,2),d=u[0],m=u[1],h=(0,Z.useState)({}),f=o()(h,2),p=f[0],g=f[1],v=(0,Z.useState)({span:12,count:2}),x=o()(v,2),y=x[0],j=x[1],b=(0,Z.useRef)({}),k=(0,Z.useRef)({}),C=(0,Z.useRef)(null),w=(0,Z.useState)(["upload","delete","copy","edit"]),S=o()(w,2),N=S[0],R=(S[1],(0,Z.useMemo)((function(){return Object.getOwnPropertySymbols(i).some((function(e){return i[e]}))}),[i])),I=function(e){return b.current[e]=M().add(b.current[e],1),b.current[e]},P=(0,Z.useCallback)((function(e,n){k.current[e]=n}),[]);return(0,Z.useEffect)((function(){k.current={};var e=M().take(n,y.count);if(e.length<y.count&&e.length>0){var t=y.count-e.length,s=Array.from({length:t},(function(e,n){return{label:"",value:"",type:"empty"}}));e=M().concat(e,s)}var a=e.map((function(e){return A()(A()({},e),{},{uid:I(e.value||"empty"),instanceId:"empty"===e.type?Symbol("empty"):Symbol(e.value)})}));m(a)}),[n]),(0,Z.useEffect)((function(){C.current&&s(C.current)}),[C.current,s]),(0,ee.jsxs)("div",{className:"multiple-chat",style:{height:"calc(100vh - 72px)"},children:[(0,ee.jsx)("div",{className:"chat-list",ref:C,children:n.length>0?(0,ee.jsx)(en.Provider,{value:{spans:y,globalParams:p,loadingStatus:i,modelFullList:n,actions:N,handleApplySystemChangeToAll:function(e){Object.getOwnPropertySymbols(k.current).forEach((function(n){var t=k.current[n];null==t||t.setSystemMessage(e)}))},setGlobalParams:g,setLoadingStatus:function(e,n){r((function(t){var s=A()({},t);return s[e]=n,s}))},handleDeleteModel:function(e){var n,t=d.filter((function(n){return n.instanceId!==e}));!function(e){k.current[e]=null,i[e]=!1}(e),n=y.count-1,6===y.count?j({span:8,count:n}):5===y.count?j({span:12,count:n}):4===y.count?j({span:8,count:n}):3===y.count&&j({span:12,count:n}),m(t)}},children:(0,ee.jsx)(xn,{spans:y,modelSelections:d,setModelRefs:P})}):t&&(0,ee.jsx)(tn,{style:{height:"100%",paddingBottom:60}})}),(0,ee.jsx)("div",{children:(0,ee.jsx)($.Z,{loading:R,disabled:R||!d.length||!n.length,handleSubmit:function(e){Object.getOwnPropertySymbols(k.current).forEach((function(n){var t=k.current[n];null==t||t.submit(e)}))},addMessage:function(e){Object.getOwnPropertySymbols(k.current).forEach((function(n){var t=k.current[n];null==t||t.addNewMessage(e)}))},handleAbortFetch:function(){Object.getOwnPropertySymbols(k.current).forEach((function(e){var n=k.current[e];null==n||n.abortFetch()}))},clearAll:function(){Object.getOwnPropertySymbols(k.current).forEach((function(e){var n=k.current[e];null==n||n.clear()}))},updateLayout:function(e){j(e),function(e){var t=d;if(t.length<e.count){var s=e.count-t.length,a=M().slice(n,t.length,t.length+s),l=Array.from({length:s-a.length},(function(e,n){return{label:"",value:"",type:"empty"}})),i=M().concat(a,l).map((function(e){return A()(A()({},e),{},{uid:I(e.value||"empty"),instanceId:"empty"===e.type?Symbol("empty"):Symbol(e.value)})}));m(M().concat(t,i))}else if(t.length>e.count){var r=t.slice(0,e.count);m(r)}}(e)},setModelSelections:function(e){var n=e.map((function(e){return A()(A()({},e),{},{uid:I(e.value),instanceId:Symbol(e.value)})})),t=M().concat(d,n),s=Math.floor(24/t.length);j({span:s<8?8:s,count:y.count}),m(t)},actions:["clear","layout","role","upload","add","paste"],defaultChecked:!1,defaultSize:{minRows:5,maxRows:5}})})]})},jn=(0,Z.memo)(yn),bn=(t(64232),function(){var e=(0,v.useIntl)(),n=(0,m.Z)().size,t=(0,Z.useState)("chat"),s=o()(t,2),l=s[0],r=s[1],k=(0,Z.useRef)(null),w=(0,Z.useRef)(null),R=(0,Z.useState)([]),I=o()(R,2),P=I[0],A=I[1],T=(0,Z.useState)(!1),E=o()(T,2),L=E[0],_=E[1],z=(0,Z.useMemo)((function(){return[{label:e.formatMessage({id:"menu.playground.chat"}),value:"chat",icon:(0,ee.jsx)(f.Z,{})},{label:e.formatMessage({id:"menu.compare"}),value:"compare",icon:(0,ee.jsx)(p.Z,{})}]}),[e]),O=(0,Z.useCallback)((function(){var e,n;if("reranker"===l)null===(e=w.current)||void 0===e||null===(n=e.viewCode)||void 0===n||n.call(e);else if("chat"===l){var t,s;null===(t=k.current)||void 0===t||null===(s=t.viewCode)||void 0===s||s.call(t)}}),[l]),G=(0,Z.useCallback)((function(){var e,n,t,s;"reranker"!==l?null===(e=k.current)||void 0===e||null===(n=e.setCollapse)||void 0===n||n.call(e):null===(t=w.current)||void 0===t||null===(s=t.setCollapse)||void 0===s||s.call(t)}),[l]),D=(0,Z.useMemo)((function(){return[{key:"chat",label:"Chat",children:(0,ee.jsx)(Qe,{ref:k,modelList:P})},{key:"compare",label:"Compare",children:(0,ee.jsx)(jn,{modelList:P,loaded:L})}]}),[P,L]);(0,Z.useEffect)((function(){var e,t,s;n.width<u.Z.lg&&(null===(e=k.current)||void 0===e||!e.collapse)&&(null===(t=k.current)||void 0===t||null===(s=t.setCollapse)||void 0===s||s.call(t))}),[n.width]),(0,Z.useEffect)((function(){var e=function(){var e=i()(a()().mark((function e(){var n,t,s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={categories:h.Us.llm,with_meta:!0},e.next=4,(0,N.nb)(n);case 4:t=e.sent,s=M().map(t.data||[],(function(e){return{value:e.id,label:e.id,meta:e.meta}})),A(s),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0);case 12:return e.prev=12,_(!0),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])})));return function(){return e.apply(this,arguments)}}();e()}),[]);var F=(0,Z.useMemo)((function(){return"compare"!==l&&(0,ee.jsxs)(x.Z,{children:[(0,ee.jsx)(y.ZP,{size:"middle",onClick:O,icon:(0,ee.jsx)(c.Z,{type:"icon-code",className:"font-size-16"}),children:e.formatMessage({id:"playground.viewcode"})}),(0,ee.jsx)(y.ZP,{size:"middle",onClick:G,icon:(0,ee.jsx)(c.Z,{type:"icon-a-layout6-line",className:"font-size-16"})})]},"buttons")}),[l,e,O,G]),U=(0,Z.useMemo)((function(){return{title:(0,ee.jsxs)("div",{className:"flex items-center",children:[(0,ee.jsx)("span",{className:"font-600",children:e.formatMessage({id:"menu.playground.chat"})}),(0,ee.jsx)(j.Z,{options:z,size:"middle",className:"m-l-40 font-600",onChange:function(e){return r(e)}})]}),style:{paddingInline:"var(--layout-content-header-inlinepadding)"},breadcrumb:{}}}),[z]);return(0,S.y1)(d.ZP.RIGHT.join(","),(function(){var e,n;"chat"===l&&(null===(e=k.current)||void 0===e||null===(n=e.setCollapse)||void 0===n||n.call(e))}),{preventDefault:!0}),(0,ee.jsx)(g._z,{ghost:!0,header:U,extra:F,className:C()("playground-container",{compare:"compare"===l,chat:"compare"!==l}),children:(0,ee.jsx)("div",{className:"play-ground",children:(0,ee.jsx)("div",{className:"chat",children:(0,ee.jsx)(b.Z,{items:D,activeKey:l})})})})})},76848:function(){}}]);