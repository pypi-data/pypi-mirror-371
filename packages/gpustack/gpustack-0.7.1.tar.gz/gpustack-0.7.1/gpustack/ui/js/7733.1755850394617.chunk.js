"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7733],{26174:function(e,t,n){n.d(t,{Bx:function(){return i},Cb:function(){return l},Ho:function(){return o},Um:function(){return a},m3:function(){return s},m4:function(){return r},zv:function(){return u}});var r={seed:"seed",stop:"stop",temperature:"temperature",top_p:"top_p",n_ctx:"n_ctx",n_slot:"n_slot",max_model_len:"max_model_len",frequency_penalty:"frequency_penalty",presence_penalty:"presence_penalty",max_total_tokens:"max_total_tokens"},a=["temperature","top_p","frequency_penalty","presence_penalty"],u=["sample_method","sampling_steps","schedule_method","cfg_scale","guidance","negative_prompt","seed","strength"],i={seed:null,stop:null,temperature:1,top_p:1,max_tokens:null,frequency_penalty:null,presence_penalty:null},o={seed:null,sample_method:"euler_a",cfg_scale:4.5,guidance:3.5,sampling_steps:10,negative_prompt:null,strength:null,schedule_method:"discrete",preview:"preview_faster"},s={style:null},l={n:1,size:"512x512",width:512,height:512}},24662:function(e,t,n){n.d(t,{M:function(){return b},X:function(){return g}});var r=n(15558),a=n.n(r),u=n(26068),i=n.n(u),o=n(48305),s=n.n(o),l=n(38780),c=n(39121),f=n(38551),d=n(68476),m=n(32699),h=n.n(m),p=n(50959),v=n(26174),g=function(e,t){var n=e.modelList,r=e.model,a=e.isChat,u=t.metaKeys,o=void 0===u?{}:u,c=t.defaultValues,d=void 0===c?{}:c,m=t.defaultParamsConfig,g=void 0===m?[]:m,b=(0,p.useRef)(null),_=(0,f.useSearchParams)(),x=s()(_,1)[0],k=(0,p.useState)({}),y=s()(k,2),C=y[0],w=y[1],S=(0,p.useState)(i()(i()({},d),{},{model:""})),O=s()(S,2),z=O[0],F=O[1],P=(0,p.useState)({model:""}),M=s()(P,2),V=M[0],I=M[1],U=(0,p.useState)(g),L=s()(U,2),D=L[0],H=L[1],T=(0,p.useRef)(null),E=(0,l.Z)().initialize,N=(0,p.useMemo)((function(){var e;return a?x.get("model")||r||(null==n||null===(e=n[0])||void 0===e?void 0:e.value):r}),[r,n,a]),R=function(e){var t=new Set(v.Um),n=e||{},r=h().pick(n,h().keys(o)),a=Object.entries(o).reduce((function(e,n){var a=s()(n,2),u=a[0],i=a[1],o=r[u];return h().hasIn(r,u)&&(e[i]=t.has(u)?h().round(o,2):o),e}),{}),u=function(e){var t=e||{},n=t.max_model_len,r=t.n_ctx,a=t.n_slot,u=t.max_total_tokens,i=0;return r&&a?i=h().divide(r,a):n?i=n:u&&(i=u),{max_tokens:i||16384,defaultFormValue:i?h().divide(i,2):1024}}(a);return{form:h().merge({},d,i()(i()({},h().omit(a,["n_ctx","n_slot","max_model_len","max_total_tokens"])),{},{seed:-1===a.seed?null:a.seed,max_tokens:u.defaultFormValue})),meta:i()(i()({},a),{},{max_tokens:u.max_tokens})}},j=(0,p.useMemo)((function(){var e=null==D?void 0:D.map((function(e){return e.name}));return null==e?void 0:e.join(",")}),[D]),J=(0,p.useCallback)((function(e){if(e){var t=n.find((function(t){return t.value===e})),r=R(null==t?void 0:t.meta),a=r.form,u=r.meta;w(u),F(i()(i()({},a),{},{model:e})),I(i()(i()({},a),{},{model:e}));var o=g.map((function(e){return i()(i()({},e),{},{attrs:"max_tokens"===e.name?i()(i()({},e.attrs),{},{max:u.max_tokens}):i()({},e.attrs)})}));H(o)}}),[n,g]),Q=(0,p.useCallback)((function(e,t){e.model?J(e.model):(I(t),F(t))}),[J]);return(0,p.useEffect)((function(){N&&n.length&&J(N)}),[N,n.length]),(0,p.useEffect)((function(){T.current&&E(T.current)}),[E]),{extractLLMMeta:R,handleOnModelChange:J,handleOnValuesChange:Q,setModelMeta:w,setInitialValues:F,setParams:I,setParamsConfig:H,formRef:b,paramsConfig:D,initialValues:z,parameters:V,modelMeta:C,paramsRef:T,formFields:j}},b=function(e,t){var n,r=e.modelList,u="edit"===t.type?c.GF:c.GF.filter((function(e){return"strength"!==e.name})),o=(0,p.useRef)(null),l=(0,f.useSearchParams)(),m=s()(l,1)[0],g=(0,p.useState)({}),b=s()(g,2),_=b[0],x=b[1],k=(0,p.useState)(!1),y=s()(k,2),C=y[0],w=y[1],S=p.useState([]),O=s()(S,2),z=O[0],F=O[1],P=p.useState([].concat(a()(c.pL),a()(c.yU))),M=s()(P,2),V=M[0],I=M[1],U=(0,p.useState)(i()(i()(i()({},v.Cb),v.Ho),{},{model:""})),L=s()(U,2),D=L[0],H=L[1],T=(0,p.useState)([].concat(a()(c.pL),a()(c.yU),a()(u))),E=s()(T,2),N=E[0],R=E[1],j=(0,p.useState)(i()(i()(i()({},v.Cb),v.Ho),{},{model:""})),J=s()(j,2),Q=J[0],q=J[1],B=(0,p.useMemo)((function(){var e;return m.get("model")||(null==r||null===(e=r[0])||void 0===e?void 0:e.value)||""}),[r]),W=p.useRef(i()(i()(i()({},v.Cb),v.m3),v.Ho)),G=d.Z.useWatch("random_seed",null===(n=o.current)||void 0===n?void 0:n.form),Z=(0,p.useMemo)((function(){return["random_seed"]}),[G]),A=function(e,t){if(t.length){var n=c.yU.map((function(e){return i()(i()({},e),{},{options:t})}));return[].concat(a()(c.pL),a()(n))}var r=e.meta||{},u=r.max_height,o=r.max_width,s=h().cloneDeep(c.Ci).map((function(e){var t="height"===e.name?u:o;return i()(i()({},e),{},{attrs:i()(i()({},e.attrs),{},{max:t||e.attrs.max})})}));return[].concat(a()(c.pL),a()(s))},K=function(e){var t=function(e){var t=e||{},n=t.max_height,r=t.max_width;if(!n||!r)return c.od;var a=c.od.filter((function(e){return e.width<=r&&e.height<=n||"custom"===e.value}));return a.find((function(e){return e.width===r&&e.height===n}))||a.push({width:r,height:n,label:"".concat(r,"x").concat(n),value:"".concat(r,"x").concat(n)}),a}(e);return{form:h().merge({},i()(i()({},v.Cb),v.Ho),i()(i()({},h().pick(e,v.zv)),{},{seed:-1===(null==e?void 0:e.seed)?null:null==e?void 0:e.seed,size:t.length?"".concat((null==e?void 0:e.default_width)||512,"x").concat((null==e?void 0:e.default_height)||512):"custom",width:(null==e?void 0:e.default_width)||512,height:(null==e?void 0:e.default_height)||512})),meta:e,sizeOptions:t}},X=function(e){return"custom"===e.size?[].concat(a()(V),a()(c.Ci),a()(e.isOpenaiCompatible?c.QU:u)):[].concat(a()(V),a()(e.isOpenaiCompatible?c.QU:u))},Y=function(e){h().merge(W.current,e)},$=(0,p.useMemo)((function(){var e=null==N?void 0:N.map((function(e){return e.name}));return null==e?void 0:e.join(",")}),[N]),ee=(0,p.useCallback)((function(e){if(e){var t=r.find((function(t){return t.value===e})),n=K(null==t?void 0:t.meta),o=n.form,s=n.sizeOptions,l=A(t,s);R(C?l:[].concat(a()(l),a()(u))),I(l),F(s),x((null==t?void 0:t.meta)||{}),H(i()(i()({},o),{},{model:e})),q(i()(i()({},o),{},{model:e})),Y(o)}}),[r,C]),te=(0,p.useCallback)((function(e,t){var n;e.model?ee(e.model):e.size&&"custom"===e.size?(R([].concat(a()(V),a()(c.Ci),a()(C?c.QU:u))),q(i()(i()({},t),{},{width:_.default_width||512,height:_.default_height||512})),null===(n=o.current)||void 0===n||null===(n=n.form)||void 0===n||n.setFieldsValue({width:_.default_width||512,height:_.default_height||512}),Y(e)):e.size&&"custom"===Q.size?(R([].concat(a()(V),a()(C?c.QU:u))),q(t),Y(e)):(q(t),Y(e))}),[ee,Q.size,V,C]);return(0,p.useEffect)((function(){B&&r.length&&ee(B)}),[B,r.length]),{extractIMGMeta:K,generateImageParamsConfig:A,setImageSizeOptions:F,setBasicParamsConfig:I,updateCacheFormData:Y,handleOnValuesChange:te,handleToggleParamsStyle:function(){var e,t={};t=C?h().pick(W.current,h().keys(i()(i()({},v.Cb),v.Ho))):h().pick(W.current,h().keys(i()(i()({},v.Cb),v.m3)));var n=X({size:t.size,isOpenaiCompatible:!C});null===(e=o.current)||void 0===e||null===(e=e.form)||void 0===e||e.setFieldsValue(i()(i()({},t),{},{model:Q.model})),R(n),q(i()(i()({},t),{},{model:Q.model})),w(!C),Y(i()(i()({},t),{},{model:Q}))},setParams:q,setInitialValues:H,updateParamsConfig:X,setParamsConfig:R,form:o,modelMeta:_,formFields:$,watchFields:Z,paramsConfig:N,initialValues:D,parameters:Q,isOpenaiCompatible:C,cacheFormData:W,basicParamsConfig:V,imageSizeOptions:z,openaiCompatibleFieldsDefaultValus:v.m3,advancedFieldsDefaultValus:v.Ho,ImageAdvancedParamsConfig:u,imgInitialValues:v.Cb,ImageCountConfig:c.pL,ImageSizeConfig:c.yU,ImageCustomSizeConfig:c.Ci,ImageconstExtraConfig:c.QU}}},69510:function(e,t,n){n.d(t,{HH:function(){return F},LN:function(){return P},U3:function(){return O},YT:function(){return V}});var r=n(335),a=n.n(r),u=n(15558),i=n.n(u),o=n(25298),s=n.n(o),l=n(17069),c=n.n(l),f=n(82092),d=n.n(f),m=n(31759),h=n.n(m),p=n(26068),v=n.n(p),g=n(90228),b=n.n(g),_=n(87999),x=n.n(_),k=n(32699),y=n(28694),C=/(data|error):\s*({.*?})(?=\n|$)/g,w=function(e){var t,n=[];if(!e)return n;for(;null!==(t=C.exec(e));)try{var r=t[1],a=JSON.parse(t[2]);"error"===r?n.push({error:a}):n.push(a)}catch(e){continue}return n},S=function(){var e=x()(b()().mark((function e(t){var n;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.json();case 3:return n=e.sent,e.abrupt("return",{error:!0,data:n});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{error:!0,message:t.statusText});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=x()(b()().mark((function e(t){var n,r,a,u,i,o;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.method||"POST",a=t.url,t.params&&(a="".concat(a,"?").concat(y.Z.stringify(t.params))),e.next=5,fetch(a,{method:r,body:"POST"===r?JSON.stringify(t.data):null,signal:t.signal,headers:v()({"Content-Type":"application/json"},t.headers)});case 5:if((u=e.sent).ok){e.next=10;break}return e.next=9,S(u);case 9:return e.abrupt("return",e.sent);case 10:return i=null==u||null===(n=u.body)||void 0===n?void 0:n.getReader(),o=new TextDecoder("utf-8",{fatal:!0}),e.abrupt("return",{reader:i,decoder:o});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(e){var t=new FormData,n=function(e,n){n instanceof File?t.append(e,n):"object"===h()(n)&&null!==n?t.append(e,JSON.stringify(n)):null!=n&&t.append(e,n)};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n(r,e[r]);return t},F=function(){var e=x()(b()().mark((function e(t){var n,r,a,u,i;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,e.next=3,fetch(r,{method:"POST",body:z(t.data),signal:t.signal});case 3:if((a=e.sent).ok){e.next=8;break}return e.next=7,S(a);case 7:return e.abrupt("return",e.sent);case 8:return u=null==a||null===(n=a.body)||void 0===n?void 0:n.getReader(),i=new TextDecoder("utf-8",{fatal:!0}),e.abrupt("return",{reader:u,decoder:i});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=x()(b()().mark((function e(t,n,r){var a,u,o,l,f,m,h,p,v,g,_=arguments;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=_.length>3&&void 0!==_[3]?_[3]:200,u=new(function(){function e(){s()(this,e),d()(this,"buffer",[])}return c()(e,[{key:"add",value:function(e){this.buffer.push(e)}},{key:"flush",value:function(){if(this.buffer.length>0){var e=i()(this.buffer);this.buffer=[],e.forEach((function(e){return r(e)}))}}},{key:"getBuffer",value:function(){return this.buffer}}]),e}()),o=(0,k.throttle)((function(){u.flush()}),a),l=!0,f="";case 6:if(!l){e.next=21;break}return e.next=9,t.read();case 9:m=e.sent,h=m.done,p=m.value;try{(f+=n.decode(p,{stream:!0})).startsWith("error:")?(v=f.slice(7).trim(),g=JSON.parse(v),u.add({error:g}),f=""):(w(f).forEach((function(e){u.add(e)})),f=""),o()}catch(e){u.add({error:e})}if(!h){e.next=19;break}return(f+=n.decode())&&w(f).forEach((function(e){return u.add(e)})),l=!1,u.flush(),e.abrupt("break",21);case 19:e.next=6;break;case 21:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),M=function(){var e=x()(b()().mark((function e(t,n,r){var u,i,o,s,l,c,f,d,m;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:u=t.split("\n"),i=a()(u);try{for(i.s();!(o=i.n()).done;)if(s=o.value,(l=s.trim()).startsWith("data: ")){c=l.slice(6).trim();try{"[DONE]"!==c&&(f=JSON.parse(c),n(f,r))}catch(e){}}else if(l.startsWith("error:")){d=l.slice(7).trim();try{m=JSON.parse(d),n({error:m,done:r})}catch(e){}}}catch(e){i.e(e)}finally{i.f()}case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),V=function(){var e=x()(b()().mark((function e(t,n,r){var u,i,o,l,f,m,h,p,v,g,_,y,C,w=arguments;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=w.length>3&&void 0!==w[3]?w[3]:200,i="",o=function(){function e(t){s()(this,e),d()(this,"buffer",[]),d()(this,"failed",!1),d()(this,"isFlushing",!1),d()(this,"callback",void 0),this.callback=t}var t;return c()(e,[{key:"add",value:function(e){this.buffer.push(e)}},{key:"flush",value:(t=x()(b()().mark((function e(t){var n;return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.buffer.length||!t){e.next=3;break}return this.callback({},t),e.abrupt("return");case 3:if(0!==this.buffer.length&&!this.isFlushing){e.next=5;break}return e.abrupt("return");case 5:this.failed=!1,this.isFlushing=!0;case 7:if(!(this.buffer.length>0)){e.next=21;break}n=this.buffer.shift(),e.prev=9,M(n,this.callback,t),e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(9),this.failed=!0,this.buffer.unshift(n),e.abrupt("break",21);case 19:e.next=7;break;case 21:t&&this.callback({},t),this.isFlushing=!1;case 23:case"end":return e.stop()}}),e,this,[[9,13]])}))),function(e){return t.apply(this,arguments)})},{key:"getBuffer",value:function(){return this.buffer}}]),e}(),l=new o(r),f=(0,k.throttle)(x()(b()().mark((function e(){return b()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.flush();case 1:case"end":return e.stop()}}),e)}))),u),!0;case 6:return e.next=9,null==t||null===(m=t.read)||void 0===m?void 0:m.call(t);case 9:if(h=e.sent,p=h.done,v=h.value,!p){e.next=18;break}return!1,i&&l.add(i),l.flush(p),e.abrupt("break",21);case 18:try{i+=n.decode(v,{stream:!0}),g=i.split("\n"),i=g.pop()||"",_=a()(g);try{for(_.s();!(y=_.n()).done;)C=y.value,l.add(C)}catch(e){_.e(e)}finally{_.f()}f()}catch(e){}e.next=6;break;case 21:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}}]);