"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3856],{2944:function(e,n,t){t.r(n),t.d(n,{default:function(){return fe}});var a=t(90228),r=t.n(a),i=t(87999),l=t.n(i),s=t(48305),o=t.n(s),c=t(49280),u=t(82344),d=t(57989),m=t(67581),f=t(38551),p=t(90468),x=t(85885),h=t(82187),v=t.n(h),g=t(32699),b=t.n(g),j=t(50959),y=t(94299),C=t(91082),w=t(15558),Z=t.n(w),k=t(26068),N=t.n(k),M=t(58573),R=t(13636),S=t(29220),z=t(30396),P=t(11527),L=function(e){var n=(0,S.Z)(),t=n.grid,a=n.title,r=n.isDark,i=n.chartColorMap,l=e.seriesData,s=e.xAxisData,c=e.height,u=e.width,d=e.showEmpty,m=e.title,f=(0,j.useRef)(null),p=(0,j.useMemo)((function(){var e=r?{split:i.splitLineColor,axis:i.axislabelColor,label:i.axislabelColor}:{split:"#F2F2F2",axis:"#dcdcdc",label:"#dcdcdc"};return{animation:!1,grid:N()(N()({},t),{},{right:10,top:10,bottom:2,left:2,containLabel:!0,borderRadius:4}),xAxis:{min:-1,max:1,scale:!1,slient:!0,splitNumber:15,splitLine:{lineStyle:{color:e.split}},axisLine:{show:!0,lineStyle:{color:e.axis}},axisTick:{show:!1},axisLabel:{show:!0,color:e.label},boundaryGap:[.05,.05]},yAxis:{min:-1,max:1,scale:!1,slient:!0,splitNumber:10,boundaryGap:[.05,.05],splitLine:{lineStyle:{color:e.split}},axisLine:{show:!0,lineStyle:{color:e.axis}},axisTick:{show:!1},axisLabel:{show:!0,color:e.label}},symbol:"roundRect",label:{show:!0,shadowColor:"none",textBorderColor:"none",formatter:function(e){return e.name}},series:[]}}),[r]),x=(0,j.useCallback)((function(e,n){for(var t,a=[],r=null===(t=f.current.chart)||void 0===t?void 0:t.convertToPixel("grid",n.value),i=o()(r,2),l=i[0],s=i[1],c=e.map((function(e){var n;return N()(N()({},e),{},{value:null===(n=f.current.chart)||void 0===n?void 0:n.convertToPixel("grid",e.value)})})),u=0;u<c.length;u++)if(n.name!==c[u].name){var d=o()(c[u].value,2),m=d[0],p=d[1];Math.sqrt(Math.pow(b().round(m-l,2),2)+Math.pow(b().round(p-s,2),2))<=16&&a.push(N()({},c[u]))}else a.push(N()({},c[u]));return a}),[]),h=(0,j.useCallback)((function(e){if(!e.length||e.length<2)return null;return function(e){var n;return'<span class="tooltip-item-name">\n               <span style="display:flex;justify-content:center;align-items: center;color:#fff;\n               margin-right:0;border-radius:4px;width:14px;\n               height:14px;background-color:'.concat(null==e||null===(n=e.itemStyle)||void 0===n?void 0:n.color,';"\n               >').concat(e.name,"</span>\n             </span>")}}),[]),v=(0,j.useMemo)((function(){var e=l.map((function(e,n){return N()(N()({},e),{},{itemStyle:{color:"#5470c6"},symbolSize:16})}));return N()(N()({},p),{},{tooltip:{trigger:"item",borderWidth:0,backgroundColor:i.colorBgContainerHover,borderColor:"transparent",formatter:function(n,t){var a=x(e,n.data),r="",i=h(a);return a.forEach((function(e){r+='\n            <span class="tooltip-item" style="justify-content: flex-start;">\n             '.concat(i?i(e):"",'\n             <span class="tooltip-value">').concat(e.text,"</span>\n            </span>")})),'<div class="tooltip-wrapper scatter">'.concat(r,"</div>")}},title:N()(N()({},a),{},{text:m}),series:{type:"scatter",labelLayout:{hideOverlap:!0},data:e}})}),[l,s,m,p,x]);return(0,P.jsx)(P.Fragment,{children:!l.length&&d?(0,P.jsx)(z.Z,{height:c,title:m}):(0,P.jsx)(R.Z,{ref:f,height:c,options:v,width:u||"100%"})})},I=(0,j.memo)(L),_=t(43585),A=t(90343),T=t(38780),D=t(59995),O=t(34155),G=t(19019),E=t(51076),F=t(77353),K=t(66668),U=t(68476),V=t(23333),B=t(83603),H=t(96938),Y=t(54876),W=t(47946),J=(t(99951),t(2139)),q=t(1731),X=t(2284),$=t(26174);var Q=t(24662),ee=(t(29031),t(32314),t(39616)),ne=t(80912),te=t(8445),ae=t(25906),re=t(69070),ie=function(e){var n=e.textListCount,t=e.fileList,a=e.ghost,r=e.showIcon,i=void 0===r||r,l=e.onDelete,s=(0,f.useIntl)();return(0,P.jsx)("div",{className:"file-list",children:t.map((function(e,t){return(0,P.jsxs)("div",{className:v()("file-item",{ghost:a}),children:[(0,P.jsxs)("span",{className:"title",children:[(0,P.jsxs)("span",{className:"m-r-5",children:[t+1+n,"."]}),i&&(0,P.jsx)(ae.Z,{className:"m-r-5"}),(0,P.jsxs)(te.Z,{ghost:!0,children:[" ",e.name]})]}),l&&(0,P.jsx)(V.Z,{title:s.formatMessage({id:"common.button.delete"}),children:(0,P.jsx)(x.ZP,{danger:!0,size:"small",type:"text",className:"delete-btn",icon:(0,P.jsx)(re.Z,{}),onClick:function(){return l(e.uid)}})})]},e.uid)}))})},le=j.memo(ie),se=t(63057),oe=t(8450),ce=t(91860),ue=(0,j.forwardRef)((function(e,n){var a=e.modelList,i=(0,f.useIntl)(),s=function(){var e=(0,j.useRef)(null),n=function(){e.current&&(e.current.terminate(),e.current=null)};return(0,j.useEffect)((function(){return function(){n()}}),[]),{workerRef:e,createWorker:function(){e.current&&e.current.terminate(),e.current=new Worker(new URL(t.p+t.u(5859),t.b),{type:void 0})},postMessage:function(n){e.current&&e.current.postMessage(n)},terminateWorker:n}}(),u=s.workerRef,d=s.createWorker,m=s.postMessage,p=(s.terminateWorker,(0,D.ZP)()),h=(0,j.useState)(!1),g=o()(h,2),y=g[0],w=g[1],k=(0,j.useState)(!1),R=o()(k,2),S=R[0],z=R[1],L=(0,j.useState)(null),te=o()(L,2),ae=te[0],re=te[1],ie=(0,j.useState)(!1),ue=o()(ie,2),de=ue[0],me=ue[1],fe=(0,j.useRef)(""),pe=(0,j.useRef)(null),xe=(0,j.useRef)(null),he=(0,j.useRef)(0),ve=(0,j.useRef)(null),ge=(0,j.useState)([]),be=o()(ge,2),je=be[0],ye=be[1],Ce=(0,j.useState)("chart"),we=o()(Ce,2),Ze=we[0],ke=we[1],Ne=(0,j.useState)(180),Me=o()(Ne,2),Re=Me[0],Se=Me[1],ze=(0,j.useState)({code:"",copyValue:""}),Pe=o()(ze,2),Le=Pe[0],Ie=Pe[1],_e=(0,j.useState)(!1),Ae=o()(_e,2),Te=Ae[0],De=Ae[1],Oe=(0,j.useRef)(!0),Ge=(0,j.useRef)(null),Ee=(0,j.useState)([{text:"",uid:-1,name:""},{text:"",uid:-2,name:""}]),Fe=o()(Ee,2),Ke=Fe[0],Ue=Fe[1],Ve=(0,j.useState)([]),Be=o()(Ve,2),He=Be[0],Ye=Be[1],We=(0,j.useRef)(null),Je=(0,T.Z)(),qe=Je.initialize,Xe=Je.updateScrollerPosition,$e=(0,Q.X)({modelList:a,isChat:!0},{defaultValues:{},defaultParamsConfig:[],metaKeys:$.m4}),Qe=$e.handleOnValuesChange,en=$e.formRef,nn=$e.paramsConfig,tn=$e.initialValues,an=$e.parameters,rn=$e.paramsRef,ln=$e.modelMeta,sn=$e.formFields;(0,j.useImperativeHandle)(n,(function(){return{viewCode:function(){w(!0)},setCollapse:function(){me(!de)},calculateNewMaxFromBoundary:function(e,n){var t;null===(t=We.current)||void 0===t||t.calculateNewMaxFromBoundary()},collapse:de}}));var on=(0,j.useMemo)((function(){return function(e){var n=e.api,t=e.parameters,a=window.location.origin,r=n.replace(C.Mo,C.ZG),i="\ncurl ".concat(a).concat(r,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n').concat((0,ee.Yy)(t,!1)).trim(),l='\nfrom openai import OpenAI\n\nclient = OpenAI(\n  base_url="'.concat(a,"/").concat(C.ZG,'", \n  api_key="YOUR_GPUSTACK_API_KEY"\n)\n\nresponse = client.embeddings.create(\n').concat((0,ee.G4)(N()({},t)),")\n\nprint(response.data[0].embedding)").trim(),s=(0,ee.GT)(N()({},t));return{curlCode:i,pythonCode:l,nodeJsCode:'\nconst OpenAI = require("openai");\n\nconst openai = new OpenAI({\n  "apiKey": "YOUR_GPUSTACK_API_KEY",\n  "baseURL": "'.concat(a,"/").concat(C.ZG,'"\n});\n\nasync function main() {\n  const params = ').concat(s,"; \n  const response = await openai.embeddings.create(params);\n  console.log(response.data[0].embedding);\n}\nmain();").trim()}}({api:C.d8,parameters:N()(N()({},b().pick(an,["model"].concat(Z()(b().split(sn,","))))),{},{input:[].concat(Z()(Ke.map((function(e){return e.text})).filter((function(e){return e}))),Z()(je.map((function(e){return e.text})).filter((function(e){return e}))))})})}),[an,sn,Ke,je]),cn=(0,j.useMemo)((function(){return[].concat(Z()(Ke),Z()(je)).length<2}),[Ke,je]),un=function(){var e,n;return null===(e=xe.current)||void 0===e||null===(n=e.setMessageId)||void 0===n?void 0:n.call(e)},dn=function(){var e=l()(r()().mark((function e(n){var t,a,i,l,s,o,c,f;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=en.current)||void 0===t?void 0:t.form.validateFields();case 3:if(an.model){e.next=5;break}return e.abrupt("return");case 5:if(l=Ke.filter((function(e){return e.text})),s=je.filter((function(e){return e.text})),!((o=[].concat(Z()(l.map((function(e){return e.text}))),Z()(s.map((function(e){return e.text}))))).length<2)){e.next=11;break}return De(!0),e.abrupt("return");case 11:return Ue(l),ye(s),De(!1),z(!0),un(),re(null),null===(a=ve.current)||void 0===a||null===(i=a.cancel)||void 0===i||i.call(a),ve.current=p(),fe.current=(null==n?void 0:n.content)||"",e.next=22,(0,C.xO)({model:an.model,encoding_format:"float",input:o},{token:ve.current.token});case 22:c=e.sent,re(c.usage),f=c.data||[],d(),u.current.onmessage=function(e){var n=e.data,t=n.scatterData,a=n.embeddingData;Ye(t),Ie(a),z(!1)},m({embeddings:f,textList:Ke,fileList:je}),e.next=34;break;case 30:e.prev=30,e.t0=e.catch(0),re({error:!0,errorMessage:(0,q.Yo)(e.t0.response)}),z(!1);case 34:case"end":return e.stop()}}),e,null,[[0,30]])})));return function(n){return e.apply(this,arguments)}}(),mn=(0,j.useCallback)((function(e){Ge.current=e}),[]),fn=(0,j.useCallback)((function(e,n){if(Oe.current){var t=e.clipboardData.getData("text");if(t){var a,r,i=t.split("\n").map((function(e){return{text:null==e?void 0:e.trim(),name:"",uid:un()}}));i[0].text="".concat((null===(a=Ge.current)||void 0===a?void 0:a.beforeText)||"").concat(i[0].text).concat((null===(r=Ge.current)||void 0===r?void 0:r.afterText)||"");var l=[].concat(Z()(Ke.slice(0,n)),Z()(i),Z()(Ke.slice(n+1))).filter((function(e){return e.text}));Ue(l)}}}),[Ke]),pn=(0,j.useMemo)((function(){return null!=ln&&ln.n_ctx&&null!=ln&&ln.n_slot?(0,P.jsx)(U.Z.Item,{children:(0,P.jsx)(A.Z,{disabled:!0,label:"Max Tokens",value:b().divide(null==ln?void 0:ln.n_ctx,null==ln?void 0:ln.n_slot)})}):[]}),[ln]),xn=(0,j.useMemo)((function(){return[{key:"chart",label:"Chart",children:(0,P.jsx)(I,{seriesData:He,height:Re,width:"100%",xAxisData:[]},de?"collapse":"expand")},{key:"json",label:"JSON",children:(0,P.jsx)("div",{style:{backgroundColor:"var(--ant-color-bg-container)",borderRadius:"var(--border-radius-base)",overflow:"hidden"},children:(0,P.jsx)(_.Z,{height:Re-32,code:Le.code,copyValue:Le.copyValue,lang:"json",copyable:!0,style:{marginBottom:0}})})}]}),[Re,de,He,Le]),hn=(0,j.useCallback)((function(e,n){e.model&&(Ye([]),re(null)),Qe(e,n)}),[]);return(0,j.useEffect)((function(){pe.current&&qe(pe.current)}),[qe]),(0,j.useEffect)((function(){Ke.length+je.length>he.current&&Xe(),he.current=Ke.length+je.length}),[Ke.length,je.length]),(0,j.useEffect)((function(){i.locale;var e=X.N[i.locale];e&&Ue(e.map((function(e,n){return{text:e,uid:un(),name:"Document ".concat(n+1)}})))}),[]),(0,P.jsxs)("div",{className:"ground-left-wrapper rerank",children:[(0,P.jsxs)("div",{className:"ground-left",children:[(0,P.jsx)("div",{className:"center",ref:pe,style:{height:"auto",maxHeight:"100%"},children:(0,P.jsxs)("div",{className:"documents",children:[(0,P.jsxs)("div",{className:"flex-between m-b-8 doc-header",children:[(0,P.jsx)("h3",{className:"m-l-10 flex-between flex-center font-size-14 line-24 m-b-0",children:(0,P.jsx)("div",{className:"flex gap-20",children:(0,P.jsx)("span",{children:i.formatMessage({id:"playground.embedding.documents"})})})}),(0,P.jsxs)("div",{className:"flex-center gap-10",children:[(0,P.jsx)(V.Z,{title:i.formatMessage({id:"playground.input.multiplePaste.tips"}),children:(0,P.jsxs)(B.Z,{defaultChecked:Oe.current,onChange:function(e){Oe.current=e.target.checked},children:[i.formatMessage({id:"playground.input.multiplePaste"}),(0,P.jsx)(O.Z,{className:"m-l-4"})]})}),(0,P.jsxs)(x.ZP,{size:"middle",onClick:function(){var e;null===(e=xe.current)||void 0===e||e.handleAdd()},disabled:S,children:[(0,P.jsx)(G.Z,{}),i.formatMessage({id:"playground.embedding.addtext"})]}),(0,P.jsx)(x.ZP,{icon:(0,P.jsx)(E.Z,{}),size:"middle",disabled:S,onClick:function(){Ue([{text:"",uid:-1,name:""},{text:"",uid:-2,name:""}]),ye([]),Ye([]),re(null),De(!1),Ie({code:"",copyValue:""})},children:i.formatMessage({id:"common.button.clear"})}),S?(0,P.jsx)(V.Z,{title:i.formatMessage({id:"common.button.stop"}),children:(0,P.jsx)(x.ZP,{style:{width:60},size:"middle",type:"primary",onClick:function(){var e,n;null===(e=ve.current)||void 0===e||null===(n=e.cancel)||void 0===n||n.call(e),z(!1)},icon:(0,P.jsx)(c.Z,{type:"icon-stop1",className:"font-size-12"})})}):(0,P.jsx)(V.Z,{title:(0,P.jsx)("span",{children:i.formatMessage({id:"common.button.submit"})}),children:(0,P.jsx)(x.ZP,{size:"middle",type:"primary",disabled:cn,onClick:function(){dn()},icon:(0,P.jsx)(F.Z,{rotate:0,className:"font-size-14"}),style:{width:60}})})]})]}),(0,P.jsxs)("div",{className:"docs-wrapper",children:[(0,P.jsx)(se.Z,{ref:xe,textList:Ke,onChange:function(e){Ue(e)},onSelect:mn,onPaste:fn}),je.length>0&&(0,P.jsx)("div",{style:{marginTop:8},children:(0,P.jsx)(le,{fileList:je,textListCount:Ke.length||0,onDelete:function(e){ye((function(n){return n.filter((function(n){return n.uid!==e}))}))}})}),Te&&(0,P.jsx)("div",{className:"m-t-16",children:(0,P.jsx)(M.Z,{type:"danger",message:i.formatMessage({id:"playground.documents.verify.embedding"})})}),(0,P.jsx)(oe.Z,{tokenResult:ae,className:"m-t-16"})]})]})}),(0,P.jsxs)("div",{className:"ground-left-footer",style:{width:"100%",padding:"0 32px 16px"},children:[(0,P.jsxs)("h3",{className:"m-l-10 flex-between flex-center font-size-14 line-24 m-b-16",children:[(0,P.jsxs)("div",{className:"flex gap-20",children:[(0,P.jsxs)("span",{className:"flex-center",children:[i.formatMessage({id:"playground.embedding.output"}),(0,P.jsx)(V.Z,{title:(0,P.jsxs)("span",{className:"flex-column",children:[(0,P.jsxs)("span",{children:["1.",i.formatMessage({id:"playground.embedding.pcatips1"})]}),(0,P.jsxs)("span",{children:["2."," ",i.formatMessage({id:"playground.embedding.pcatips2"})]})]}),children:(0,P.jsx)(O.Z,{className:"m-l-4"})})]}),(0,P.jsx)(M.Z,{type:"danger",message:null==ae?void 0:ae.errorMessage})]}),(0,P.jsx)(H.Z,{onChange:function(e){ke(e)},value:Ze,options:[{label:i.formatMessage({id:"playground.embedding.chart"}),value:"chart"},{label:"JSON",value:"json"}]})]}),(0,P.jsxs)("div",{className:"embed-chart",children:[S&&(0,P.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,P.jsx)(Y.Z,{spinning:!0})}),(0,P.jsx)(J.e,{ref:We,enable:{top:!0},defaultSize:{height:180},handleComponent:{top:(0,P.jsx)(V.Z,{title:i.formatMessage({id:"playground.embedding.handler.tips"}),children:(0,P.jsx)(x.ZP,{size:"small",className:"drag-handler",color:"default",variant:"filled",icon:(0,P.jsx)(K.Z,{rotate:90,style:{fontSize:"var(--font-size-14)"}})})})},maxHeight:400,minHeight:180,onResize:function(){var e,n=null===(e=We.current)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.height;n&&Se(n)},onResizeStop:function(e,n,t,a){a.height+Re<=400&&a.height+Re>=180&&Se(a.height+Re)},children:(0,P.jsx)("div",{style:{border:"1px solid var(--ant-color-border)",borderRadius:"var(--border-radius-base)",width:"100%"},className:"scatter",children:(0,P.jsx)(W.Z,{defaultActiveKey:Ze,activeKey:Ze,centered:!0,renderTabBar:function(){return(0,P.jsx)(P.Fragment,{})},items:xn})})})]})]})]}),(0,P.jsx)("div",{className:v()("params-wrapper",{collapsed:de}),ref:rn,children:(0,P.jsx)("div",{className:"box",children:(0,P.jsx)(ne.Z,{ref:en,onValuesChange:hn,paramsConfig:nn,initialValues:tn,modelList:a,extra:pn})})}),(0,P.jsx)(ce.Z,{open:y,viewCodeContent:on,onCancel:function(){w(!1)},title:i.formatMessage({id:"playground.viewcode"})})]})})),de=ue,me=t(83458),fe=(t(64232),function(){var e=(0,f.useIntl)(),n=(0,j.useRef)(null),t=(0,j.useState)([]),a=o()(t,2),i=a[0],s=a[1],h=(0,j.useState)(!1),g=o()(h,2),w=g[0],Z=g[1];(0,me.Z)({handler:function(){var e,t,a,r;null===(e=n.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e),null===(a=n.current)||void 0===a||null===(r=a.calculateNewMaxFromBoundary)||void 0===r||r.call(a,500,300)},triggeredRef:n.current});var k=(0,j.useCallback)((function(){var e,t;null===(e=n.current)||void 0===e||null===(t=e.viewCode)||void 0===t||t.call(e)}),[n.current]),N=(0,j.useCallback)((function(){var e,t;null===(e=n.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e)}),[n.current]);(0,j.useEffect)((function(){var e=function(){var e=l()(r()().mark((function e(){var n,t,a;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={categories:d.Us.embedding,with_meta:!0},e.next=4,(0,C.nb)(n);case 4:return t=e.sent,a=b().map(t.data||[],(function(e){return{value:e.id,label:e.id,meta:e.meta}})),e.abrupt("return",a);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),n=function(){var n=l()(r()().mark((function n(){var t,a,i;return r()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Promise.all([e()]);case 3:t=n.sent,a=o()(t,1),i=a[0],s(i),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),Z(!0);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})));return function(){return n.apply(this,arguments)}}();n()}),[]);return(0,y.y1)(u.ZP.RIGHT.join(","),(function(){var e,t;null===(e=n.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e)}),{preventDefault:!0}),(0,P.jsx)(m._z,{ghost:!0,header:{title:e.formatMessage({id:"menu.playground.embedding"}),style:{paddingInline:"var(--layout-content-header-inlinepadding)"},breadcrumb:{}},extra:(0,P.jsxs)(p.Z,{children:[(0,P.jsx)(x.ZP,{size:"middle",onClick:k,icon:(0,P.jsx)(c.Z,{type:"icon-code",className:"font-size-16"}),children:e.formatMessage({id:"playground.viewcode"})}),(0,P.jsx)(x.ZP,{size:"middle",onClick:N,icon:(0,P.jsx)(c.Z,{type:"icon-a-layout6-line",className:"font-size-16"})})]},"buttons"),className:v()("playground-container chat"),children:(0,P.jsx)("div",{className:"play-ground",children:(0,P.jsx)("div",{className:"chat",children:(0,P.jsx)(de,{ref:n,modelList:i,loaded:w})})})})})}}]);