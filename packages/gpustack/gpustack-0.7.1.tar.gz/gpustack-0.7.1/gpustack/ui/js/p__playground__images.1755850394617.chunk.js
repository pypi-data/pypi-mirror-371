"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3560,7348],{56581:function(e,t,n){n.d(t,{Yo:function(){return a},gn:function(){return i}});var r=n(9389),a=(0,r.cn)(new Map),i=function(e,t){var n=(0,r.K7)(),i=n.get(a);i.set(e,t),n.set(a,i)}},58573:function(e,t,n){var r=n(26068),a=n.n(r),i=n(78093),s=n(87497),o=n(50959),c=n(11527),l=function(e){var t=e.message,n=e.type,r=e.rows,o=void 0===r?1:r,l=e.ellipsis,u=e.style;return(0,c.jsx)(c.Fragment,{children:t?(0,c.jsxs)(s.Z.Paragraph,{type:n,ellipsis:void 0!==l?l:{rows:o,tooltip:t},style:a()({textAlign:"center",padding:"2px 5px",borderRadius:"var(--border-radius-base)",margin:0,backgroundColor:"var(--ant-color-error-bg)"},u),children:[(0,c.jsx)(i.Z,{className:"m-r-8"}),t]}):null})};t.Z=o.memo(l)},77470:function(e,t){t.Z={"/playground/text-to-image":"/playground/text-to-image","/playground/speech":"/playground/speech"}},77964:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ee}});var r=n(90228),a=n.n(r),i=n(87999),s=n.n(i),o=n(48305),c=n.n(o),l=n(49280),u=n(37963),d=n(82344),f=n(69997),m=n(57989),h=n(46824),p=n(84869),g=n(67581),v=n(38551),x=n(90468),y=n(85885),w=n(96938),k=n(47946),C=n(82187),b=n.n(C),j=n(32699),M=n.n(j),R=n(50959),S=n(94299),Z=n(91082),_=n(26068),I=n.n(_),U=n(56581),z=n(58573),N=n(77470),P=n(42326),L=n(58258),O=n(17485),T=n(67201),E=n(23333),A=(n(99951),n(24662)),Y=n(15558),D=n.n(Y),F=n(38780),W=n(1731),H=n(69510),K="AAAABJRU5ErkJgg===";function B(e){var t=(0,v.useIntl)(),n=e.scroller,r=e.paramsRef,i=e.chunkFields,o=e.API,l=(0,R.useState)(!1),u=c()(l,2),d=u[0],f=u[1],m=(0,R.useState)(null),h=c()(m,2),p=h[0],g=h[1],x=(0,R.useState)([]),y=c()(x,2),w=y[0],k=y[1],C=(0,R.useState)(""),b=c()(C,2),j=b[0],S=b[1],_=(0,R.useRef)(0),U=(0,R.useRef)(null),z=(0,F.Z)().initialize,N=(0,F.Z)().initialize,P=(0,R.useRef)(null),L=(0,R.useRef)(0);(0,R.useEffect)((function(){n.current&&z(n.current)}),[z]),(0,R.useEffect)((function(){r.current&&N(r.current)}),[N]);var O=function(){return L.current=L.current+1,L.current},T=function(e,t){return e.endsWith(t)?e.slice(0,-t.length):e},E=function(e){var t={span:12};return 1===e.n&&(t.span=24),2===e.n&&(t.span=12),3===e.n&&(t.span=12),4===e.n&&(t.span=12),t},A=function(){return _.current=_.current+1,_.current},Y=M().debounce((function(){k([]),f(!1)}),200),B=function(){var e=s()(a()().mark((function e(n){var r,s,c,l,u,d,m,h,p,v,x,y;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n.model){e.next=3;break}return e.abrupt("return");case 3:if(null===(r=U.current)||void 0===r||null===(s=r.abort)||void 0===s||s.call(r,"cancel"),U.current=new AbortController,c=O(),l=E(n),f(!0),A(),g(null),u=M().split(n.size,"x").map((function(e){return M().toNumber(e)})),d=Array(n.n).fill({}).map((function(e,t){return I()(I()({dataUrl:"data:image/png;base64,"},l),{},{progress:0,height:u[1],width:u[0],loading:!0,progressType:"dashboard",preview:!1,uid:A()})})),k(d),m={},o!==Z.U$){e.next=18;break}return e.next=17,(0,H.U3)({data:n,url:"".concat(o,"?t=").concat(Date.now()),signal:U.current.signal});case 17:m=e.sent;case 18:if(o!==Z.d9){e.next=22;break}return e.next=21,(0,H.HH)({data:n,url:"".concat(o,"?t=").concat(Date.now()),signal:U.current.signal});case 21:m=e.sent;case 22:if(!m.error){e.next=26;break}return g({error:!0,errorMessage:(0,W.Yo)(m)}),k([]),e.abrupt("return");case 26:return p=(h=m).reader,v=h.decoder,P.current=p,e.next=31,(0,H.YT)(p,v,(function(e,r){var a;L.current===c&&(null!=e&&e.error?g({error:!0,errorMessage:(0,W.Yo)(e)}):(null==e||null===(a=e.data)||void 0===a||a.forEach((function(e){var t=d[e.index];e.b64_json&&M().get(n,i)?t.dataUrl+=T(e.b64_json,K):e.b64_json&&(t.dataUrl="data:image/png;base64,".concat(T(e.b64_json,K)));var r=e.progress;d[e.index]={dataUrl:t.dataUrl,height:u[1],width:u[0],maxHeight:"".concat(u[1],"px"),maxWidth:"".concat(u[0],"px"),uid:t.uid,span:t.span,loading:!!M().get(n,i)&&r<100,preview:o===Z.U$&&r>=100,progress:r}})),!r||null!=e&&e.error||!d.some((function(e){return e.progress<100}))||g({error:!0,errorMessage:t.formatMessage({id:"playground.image.generate.error"})}),k(D()(d))))}));case 31:e.next=39;break;case 33:e.prev=33,e.t0=e.catch(0),O(),Y(),null===(x=U.current)||void 0===x||null===(y=x.abort)||void 0===y||y.call(x,"cancel");case 39:return e.prev=39,f(!1),e.finish(39);case 42:case"end":return e.stop()}}),e,null,[[0,33,39,42]])})));return function(t){return e.apply(this,arguments)}}();return(0,R.useEffect)((function(){return function(){var e,t;null===(e=U.current)||void 0===e||null===(t=e.abort)||void 0===t||t.call(e,"cancel")}}),[]),{loading:d,tokenResult:p,imageList:w,promptList:W.ce,currentPrompt:j,setImageList:k,setTokenResult:g,setCurrentPrompt:S,handleStopConversation:function(){var e,t;null===(e=U.current)||void 0===e||null===(t=e.abort)||void 0===t||t.call(e,"stop")},generateNumber:function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},handleClear:function(){k([]),g(null),S("")},submitMessage:B}}n(29031),n(76223);var G=n(39616),V=function(e){var t=e.api,n=e.parameters,r=e.isFormdata,a=void 0!==r&&r,i=e.edit,s=void 0!==i&&i,o=window.location.origin,c=t.replace(Z.Mo,Z.ZG),l="\ncurl ".concat(o).concat(c,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n').concat((0,G.Yy)(n,a)).trim();return s&&(l="\ncurl ".concat(o).concat(c,' \\\n-H "Content-Type: multipart/form-data" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n-F image="@image.png" \\\n-F mask="@mask.png" \\\n').concat((0,G.Yy)(M().omit(n,["mask","image"]),a)).trim().replace(/\\$/,"")),{curlCode:l,pythonCode:'\nimport requests\n\nurl="'.concat(o).concat(c,'"\nheaders = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n}\ndata = ').concat(JSON.stringify(n,null,2).replace(/null/g,"None"),"\n\nresponse = requests.post(url, headers=headers, json=data)\nprint(response.json()['data'][0]['b64_json'])").trim(),nodeJsCode:"\nconst axios = require('axios');\n\nconst url = \"".concat(o,"/").concat(Z.ZG,'/images/generations";\nconst headers = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n};\nconst data = ').concat((0,G.GT)(n),";\n\naxios.post(url, data, { headers }).then((response) => {\n  console.log(response.data.data[0].b64_json);\n});").trim()}},$=function(e){var t=e.api,n=e.parameters,r=e.isFormdata,a=void 0!==r&&r,i=e.edit,s=void 0!==i&&i,o=window.location.origin,c=t.replace(Z.Mo,Z.ZG),l="\ncurl ".concat(o).concat(c,' \\\n-H "Content-Type: multipart/form-data" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n').concat((0,G.Yy)(n,a)).trim();s&&(l="\ncurl ".concat(o).concat(c,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n-F image="@image.png" \\\n-F mask="@mask.png" \\\n').concat((0,G.Yy)(M().omit(n,["mask","image"]),a)).trim().replace(/\\$/,""));var u='\nfrom openai import OpenAI\n\nclient = OpenAI(\n  base_url="'.concat(o,"/").concat(Z.ZG,'", \n  api_key="YOUR_GPUSTACK_API_KEY"\n)\n\nresponse = client.images.generate(\n').concat((0,G.G4)(I()({},n)),")\n\nprint(response.data[0].b64_json)").trim(),d=(0,G.GT)(I()({},n));return{curlCode:l,pythonCode:u,nodeJsCode:'\nconst OpenAI = require("openai");\n\nconst openai = new OpenAI({\n  "apiKey": "YOUR_GPUSTACK_API_KEY",\n  "baseURL": "'.concat(o,"/").concat(Z.ZG,'"\n});\n\nasync function main() {\n  const params = ').concat(d,"; \n  const response = await openai.images.generate(params);\n  console.log(response.data[0].b64_json);\n}\nmain();").trim()}},J=n(80912),X=n(88479),q=n(91860),Q=n(11527),ee=(0,R.forwardRef)((function(e,t){var n=e.modelList,r=(0,v.useIntl)(),i=(0,R.useState)(!1),o=c()(i,2),u=o[0],d=o[1],f=(0,R.useState)(!1),m=c()(f,2),h=m[0],p=m[1],g=(0,R.useRef)(null),x=(0,R.useRef)(null),w=(0,R.useRef)(null),k=(0,A.M)(e,{type:"create"}),C=k.handleOnValuesChange,j=k.handleToggleParamsStyle,S=k.setParams,_=k.form,Y=k.watchFields,D=k.formFields,F=k.paramsConfig,W=k.initialValues,H=k.parameters,K=k.isOpenaiCompatible,G=B({scroller:g,paramsRef:x,chunkFields:["stream_options","chunk_results"],API:Z.U$}),ee=G.loading,te=G.tokenResult,ne=G.imageList,re=G.promptList,ae=G.currentPrompt,ie=G.setCurrentPrompt,se=G.handleClear,oe=G.handleStopConversation,ce=G.submitMessage;(0,R.useImperativeHandle)(t,(function(){return{viewCode:function(){d(!0)},setCollapse:function(){p(!h)},collapse:h}}));var le=(0,R.useCallback)((function(){var e,t,n,r=(t=0,n=re.length-1,Math.floor(Math.random()*(n-t+1)+t)),a=re[r];null===(e=w.current)||void 0===e||e.handleInputChange({target:{value:a}})}),[]),ue=(0,R.useMemo)((function(){return"custom"===H.size?I()(I()({},M().omit(H,["width","height","preview","random_seed"])),{},{size:H.width&&H.height?"".concat(H.width,"x").concat(H.height):""}):I()({},M().omit(H,["width","height","random_seed","preview"]))}),[H]),de=(0,R.useMemo)((function(){return K?$({api:Z.U$,parameters:I()(I()({},ue),{},{prompt:ae})}):V({api:Z.U$,parameters:I()(I()({},ue),{},{prompt:ae})})}),[ue,K,ae]),fe=function(){var e=s()(a()().mark((function e(){var t,n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=_.current)||void 0===t||null===(t=t.form)||void 0===t?void 0:t.validateFields();case 3:if(H.model){e.next=5;break}return e.abrupt("return");case 5:return a=void 0,a={chunk_size:16384,chunk_results:!0},H.preview&&(a={preview_faster:!0}),r=I()(I()({},M().omitBy(ue,(function(e){return!e}))),{},{seed:H.random_seed?(0,L.Hq)():H.seed,stream:!0,stream_options:I()({},a),prompt:ae}),S(I()(I()({},H),{},{seed:r.seed})),null===(n=_.current)||void 0===n||null===(n=n.form)||void 0===n||n.setFieldValue("seed",r.seed),(0,U.gn)(N.Z["/playground/text-to-image"],!0),e.next=12,ce(r);case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(0);case 16:return e.prev=16,(0,U.gn)(N.Z["/playground/text-to-image"],!1),e.finish(16);case 20:case"end":return e.stop()}var a}),e,null,[[0,14,16,20]])})));return function(){return e.apply(this,arguments)}}(),me=(0,R.useCallback)((function(){d(!1)}),[]);return(0,Q.jsxs)("div",{className:"ground-left-wrapper",children:[(0,Q.jsxs)("div",{className:"ground-left",children:[(0,Q.jsx)("div",{className:"message-list-wrap",ref:g,style:{paddingBottom:16},children:(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsxs)("div",{className:"content",style:{height:"100%"},children:[(0,Q.jsx)(P.Z,{style:{padding:0,height:"100%",justifyContent:"center",flexDirection:"column",flexWrap:"unset",alignItems:"center"},autoBgColor:!1,editable:!1,dataList:ne,responseable:!0,gutter:[8,16],autoSize:!0}),!ne.length&&(0,Q.jsxs)("div",{className:"flex-column font-size-14 flex-center gap-20 justify-center hold-wrapper",children:[(0,Q.jsx)("span",{children:(0,Q.jsx)(O.Z,{className:"font-size-32 text-secondary"})}),(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.params.empty.tips"})})]})]})})}),te&&(0,Q.jsx)("div",{style:{height:40},children:(0,Q.jsx)(z.Z,{type:"danger",message:null==te?void 0:te.errorMessage})}),(0,Q.jsx)("div",{className:"ground-left-footer",children:(0,Q.jsx)(X.Z,{ref:w,placeholer:r.formatMessage({id:"playground.input.prompt.holder"}),actions:[],defaultSize:{minRows:5,maxRows:5},title:r.formatMessage({id:"playground.image.prompt"}),loading:ee,disabled:!H.model,isEmpty:!ne.length,handleSubmit:fe,handleAbortFetch:oe,onInputChange:function(e){ie(e.target.value)},shouldResetMessage:!1,clearAll:se,tools:(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(E.Z,{title:r.formatMessage({id:"playground.image.prompt.random"}),children:(0,Q.jsx)(y.ZP,{onClick:le,size:"middle",type:"text",icon:(0,Q.jsx)(l.Z,{type:"icon-random"})})})})})})]}),(0,Q.jsx)("div",{className:b()("params-wrapper",{collapsed:h}),ref:x,children:(0,Q.jsx)("div",{className:"box",children:(0,Q.jsx)(J.Z,{ref:_,watchFields:Y,formFields:D,parametersTitle:(0,Q.jsxs)("div",{className:"flex-between flex-center",children:[(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.parameters"})}),(0,Q.jsx)(E.Z,{title:r.formatMessage({id:"playground.image.params.custom.tips"}),children:(0,Q.jsx)(y.ZP,{size:"small",type:"text",icon:(0,Q.jsx)(T.Z,{}),onClick:j,children:K?r.formatMessage({id:"playground.image.params.custom"}):r.formatMessage({id:"playground.image.params.openai"})})})]}),onValuesChange:C,paramsConfig:F,initialValues:W,modelList:n})})}),(0,Q.jsx)(q.Z,{open:u,viewCodeContent:de,onCancel:me,title:r.formatMessage({id:"playground.viewcode"})})]})})),te=ee,ne=n(46818),re=n(53649),ae=n.n(re),ie=n(54876),se=n(7672),oe=n.n(se),ce=n(97884),le="rgba(0, 0, 255, 0.3)";function ue(e){var t=e.overlayCanvasRef,n=e.canvasRef,r=e.offscreenCanvasRef,a=e.cursorRef,i=e.lineWidth,s=e.translatePos,o=e.autoScale,l=e.baseScale,u=e.isLoadingMaskRef,d=(0,R.useState)(1),f=c()(d,2),m=f[0],h=f[1],p=function(e){var a,i,c=e.deltaY>0?-.1:.1,l=t.current.getBoundingClientRect(),u=e.clientX-l.left,d=e.clientY-l.top;a=o.current,i="scale(".concat(a,")"),t.current.style.transform=i,n.current.style.transform=i,r.current.style.transform=i,function(e){if(!(o.current<=.2||o.current>=8)){var a=t.current.getBoundingClientRect(),i=e.clientX-a.left,s=e.clientY-a.top,c=i/a.width,l=s/a.height;t.current.style.transformOrigin="".concat(100*c,"% ").concat(100*l,"%"),n.current.style.transformOrigin="".concat(100*c,"% ").concat(100*l,"%"),r.current.style.transformOrigin="".concat(100*c,"% ").concat(100*l,"%")}}(e),function(e,t,n){var r=M().round(o.current+e,2);if(!(r<.2||r>8)){var a=o.current,i=s.current,c=(t-i.x)/a,l=(n-i.y)/a;o.current=r;var u=t-c*r,d=n-l*r;s.current={x:u,y:d}}}(c,u,d)},g=function(e){var t;u.current||(p(e),a.current.style.width="".concat(i*o.current,"px"),a.current.style.height="".concat(i*o.current,"px"),t=e,a.current.style.top="".concat(t.clientY-i/2*o.current,"px"),a.current.style.left="".concat(t.clientX-i/2*o.current,"px"),h(o.current))};M().throttle((function(e){g(e)}),16);return{handleOnWheel:g,setActiveScale:h,activeScale:m,autoScale:o,baseScale:l}}var de,fe=n(76574),me=n(27366),he=n(19729),pe=n(51076),ge=n(32362),ve=n(17098),xe=n(96247),ye=n(83603),we=function(e){var t=e.disabled,n=e.loading,r=e.lineWidth,a=e.invertMask,i=e.accept,s=e.handleBrushSizeChange,o=e.undo,c=e.onClear,u=e.handleFitView,f=e.handleUpdateImageList,m=e.handleUpdateMaskList,h=(0,v.useIntl)();return(0,Q.jsxs)("div",{className:"tools",children:[(0,Q.jsx)(E.Z,{placement:"bottomLeft",arrow:!1,overlayInnerStyle:{background:"var(--color-white-1)",display:"flex",alignItems:"center",justifyContent:"flex-start",width:160},title:(0,Q.jsxs)("div",{className:"flex-column",style:{width:"100%"},children:[(0,Q.jsx)("span",{className:"text-secondary",children:h.formatMessage({id:"playground.image.brushSize"})}),(0,Q.jsx)(xe.Z,{disabled:t,style:{marginBlock:"4px 6px",marginLeft:0,flex:1},vertical:!1,defaultValue:r,min:10,max:100,onChange:s})]}),children:(0,Q.jsx)(y.ZP,{size:"middle",type:"text",children:(0,Q.jsx)(me.Z,{className:"font-size-14"})})}),(0,Q.jsx)(E.Z,{title:(0,Q.jsxs)("span",{children:["[",d.d4.UNDO.textKeybinding,"]",(0,Q.jsx)("span",{className:"m-l-5",children:h.formatMessage({id:"common.button.undo"})})]}),children:(0,Q.jsx)(y.ZP,{onClick:o,size:"middle",type:"text",disabled:t,children:(0,Q.jsx)(he.Z,{className:"font-size-14"})})}),(0,Q.jsx)(E.Z,{title:h.formatMessage({id:"common.button.clear"}),children:(0,Q.jsx)(y.ZP,{onClick:c,size:"middle",type:"text",disabled:t,children:(0,Q.jsx)(pe.Z,{className:"font-size-14"})})}),(0,Q.jsx)(fe.Z,{disabled:n||a,handleUpdateImgList:f,size:"middle",accept:i}),(0,Q.jsx)(fe.Z,{title:h.formatMessage({id:"playground.image.mask.upload"}),icon:(0,Q.jsx)(l.Z,{type:"icon-mosaic-2"}),disabled:n||a,handleUpdateImgList:m,size:"middle",accept:i}),(0,Q.jsx)(E.Z,{title:h.formatMessage({id:"playground.image.fitview"}),children:(0,Q.jsx)(y.ZP,{onClick:u,size:"middle",type:"text",disabled:n,children:(0,Q.jsx)(ge.Z,{className:"font-size-14"})})})]})},ke=function(e){var t=(0,v.useIntl)(),n=e.disabled,r=e.isOriginal,a=e.invertMask,i=e.handleOnChangeMask,s=e.downloadMask,o=e.download;return(0,Q.jsxs)("div",{className:"tools",children:[r&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(E.Z,{title:(0,Q.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:t.formatMessage({id:"playground.image.negativeMask.tips"})}),children:(0,Q.jsx)(ye.Z,{onChange:i,className:"flex-center",checked:a,disabled:n,children:(0,Q.jsx)("span",{className:"font-size-12",children:t.formatMessage({id:"playground.image.negativeMask"})})})}),(0,Q.jsx)(E.Z,{title:t.formatMessage({id:"playground.image.saveMask"}),children:(0,Q.jsx)(y.ZP,{onClick:s,size:"middle",type:"text",children:(0,Q.jsx)(l.Z,{className:"font-size-14",type:"icon-save1"})})})]}),!r&&(0,Q.jsx)(E.Z,{title:t.formatMessage({id:"playground.image.download"}),children:(0,Q.jsx)(y.ZP,{onClick:o,size:"middle",type:"text",children:(0,Q.jsx)(ve.Z,{className:"font-size-14"})})})]})},Ce=ce.ZP.div(de||(de=ae()(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  width: ",";\n  z-index: 100;\n"])),(function(e){return"".concat(e.width,"px")||0})),be=function(e){var t=e.width,n=e.height;return(0,Q.jsx)(Ce,{width:t,height:n,children:(0,Q.jsx)(ie.Z,{spinning:!0})})},je=(0,R.forwardRef)((function(e,t){var r=e.loading,i=e.imageSrc,o=e.disabled,l=e.imageStatus,u=e.maskUpload,d=e.accept,f=e.onSave,m=e.onScaleImageSize,h=e.handleUpdateImageList,p=e.handleUpdateMaskList,g=(0,R.useRef)(null),v=(0,R.useRef)(null),x=(0,R.useRef)(null),y=(0,R.useState)(60),w=c()(y,2),k=w[0],C=w[1],j=(0,R.useRef)({x:0,y:0}),S=(0,R.useRef)(!1),Z=(0,R.useState)(!1),_=c()(Z,2),I=_[0],U=_[1],z=(0,R.useRef)(null),N=(0,R.useState)({width:0,height:0,loading:!1}),P=c()(N,2),L=P[0],O=(P[1],function(e){var t=e.isDisabled,n=e.invertMask,r=e.maskUpload,a=e.lineWidth,i=e.translatePos,s=e.onSave,o=(0,R.useRef)(!1),c=(0,R.useRef)(null),l=(0,R.useRef)(null),u=(0,R.useRef)(null),d=(0,R.useRef)([]),f=(0,R.useRef)([]),m=(0,R.useRef)(!1),h=(0,R.useRef)(null),p=(0,R.useRef)(1),g=(0,R.useRef)(1),v=(0,R.useRef)({x:0,y:0}),x=(0,R.useRef)([]),y=(0,R.useRef)(!1),w=(0,R.useMemo)((function(){return t||n||!(null==r||!r.length)}),[t,n,r]),k=(0,R.useCallback)((function(e){for(var t=0;t<e.length;t+=4)e[t+3]>0&&(e[t]=255,e[t+1]=255,e[t+2]=255,e[t+3]=255)}),[]),C=(0,R.useCallback)((function(){return c.current.toDataURL("image/png")}),[]),b=(0,R.useCallback)((function(){if(0===f.current.length&&0===x.current.length)return null;var e=l.current,t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d"),r=e.getContext("2d").getImageData(0,0,e.width,e.height),a=r.data;return k(a),n.putImageData(r,0,0),n.globalCompositeOperation="destination-over",n.fillStyle="black",n.fillRect(0,0,t.width,t.height),t.toDataURL("image/png")}),[]),j=function(){var e=b(),t=C();s({mask:e,img:t})},S=(0,R.useCallback)((function(){u.current||(u.current=document.createElement("canvas"))}),[]),Z=(0,R.useCallback)((function(){var e,t,n;S();var r=null===(e=c.current)||void 0===e?void 0:e.getContext("2d"),a=null===(t=l.current)||void 0===t?void 0:t.getContext("2d"),s=null===(n=u.current)||void 0===n?void 0:n.getContext("2d");if(r&&a){r.resetTransform(),a.resetTransform(),s.resetTransform();var o=p.current,d=i.current,f=d.x,m=d.y;r.setTransform(o,0,0,o,f,m),a.setTransform(o,0,0,o,f,m),s.setTransform(o,0,0,o,f,m)}}),[]),_=function(e,t){var n=p.current,r=i.current;return{x:(e-r.x)/n,y:(t-r.y)/n}},I=function(){return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)||a)/p.current},U=(0,R.useCallback)((function(e,t,n){var r=n.lineWidth,a=n.color,i=n.compositeOperation;e.lineWidth=I(r),e.lineCap="round",e.lineJoin="round",e.globalCompositeOperation=i;var s=_(t.x,t.y),o=s.x,c=s.y;e.lineTo(o,c),"source-over"===i&&(e.strokeStyle=a),e.stroke()}),[I]),z=(0,R.useCallback)((function(e,t,n){var r=n.color,a=n.compositeOperation;e.lineCap="round",e.lineJoin="round",e.globalCompositeOperation=a,e.save(),e.beginPath(),t.forEach((function(t,n){var r=_(t.x,t.y),a=r.x,i=r.y;e.lineWidth=I(t.lineWidth),0===n?e.moveTo(a,i):e.lineTo(a,i)})),"source-over"===a&&(e.strokeStyle=r),e.stroke(),e.restore()}),[I,_]),N=function(e){if(!w&&m.current&&o.current){var t=e.nativeEvent,n=t.offsetX,r=t.offsetY;d.current.push({x:n,y:r,lineWidth:a});var i=l.current.getContext("2d");i.save(),U(i,{x:n,y:r,lineWidth:a},{lineWidth:a,color:le,compositeOperation:"destination-out"}),U(i,{x:n,y:r,lineWidth:a},{lineWidth:a,color:le,compositeOperation:"source-over"}),i.restore()}},P=(0,R.useCallback)((function(){var e,t=l.current.getContext("2d"),n=null===(e=u.current)||void 0===e?void 0:e.getContext("2d");n.resetTransform(),t.resetTransform(),t.clearRect(0,0,l.current.width,l.current.height),n.clearRect(0,0,l.current.width,l.current.height)}),[]),L=(0,R.useCallback)((function(){var e,t=c.current,n=c.current.getContext("2d"),r=null===(e=u.current)||void 0===e?void 0:e.getContext("2d");n.resetTransform(),n.clearRect(0,0,t.width,t.height),r.resetTransform(),r.clearRect(0,0,t.width,t.height)}),[]),O=(0,R.useCallback)((function(){var e,t=c.current,n=l.current,r=u.current,s=t.getContext("2d"),o=n.getContext("2d"),d=null===(e=u.current)||void 0===e?void 0:e.getContext("2d");p.current=1,g.current=1,i.current={x:0,y:0},v.current={x:0,y:0},t.style.transform="scale(1)",n.style.transform="scale(1)",r.style.transform="scale(1)",h.current.style.width="".concat(a,"px"),h.current.style.height="".concat(a,"px"),s.resetTransform(),o.resetTransform(),d.resetTransform()}),[]);return{canvasRef:c,overlayCanvasRef:l,offscreenCanvasRef:u,cursorRef:h,strokesRef:f,currentStroke:d,isDrawing:m,mouseDownState:o,autoScale:p,baseScale:g,maskStorkeRef:x,isLoadingMaskRef:y,creatOffscreenCanvas:S,setMaskStrokes:function(e){x.current=e},fitView:function(){O(),p.current=g.current,i.current={x:0,y:0},Z(),l.current.style.transform="scale(".concat(p.current,")"),c.current.style.transform="scale(".concat(p.current,")"),u.current.style.transform="scale(".concat(p.current,")")},setStrokes:function(e){f.current=e},resetCanvas:O,draw:N,getTransformLineWidth:I,getTransformedPoint:_,drawStroke:z,startDrawing:function(e){if(!w){m.current=!0,d.current=[];var t=e.nativeEvent,n=t.offsetX,r=t.offsetY;d.current.push({x:n,y:r,lineWidth:a});var i=l.current.getContext("2d");Z();var s=_(n,r),o=s.x,c=s.y;i.beginPath(),i.moveTo(o,c),N(e)}},endDrawing:function(e){w||m.current&&(m.current=!1,f.current.push(M().cloneDeep(d.current)),d.current=[],j())},handleMouseMove:function(e){w||(l.current.style.cursor="none",h.current.style.display="block",h.current.style.top="".concat(e.clientY-a/2*p.current,"px"),h.current.style.left="".concat(e.clientX-a/2*p.current,"px"))},handleMouseLeave:function(){w||(m.current=!1,l.current.style.cursor="default",h.current.style.display="none")},handleMouseEnter:function(e){w?l.current.style.cursor="default":(l.current.style.cursor="none",h.current.style.display="block",h.current.style.top="".concat(e.clientY-a/2*p.current,"px"),h.current.style.left="".concat(e.clientX-a/2*p.current,"px"))},saveImage:j,generateMask:b,generateImage:C,setTransform:Z,clearOverlayCanvas:P,clearCanvas:L}}({lineWidth:k,translatePos:j,isDisabled:o,invertMask:I,maskUpload:u,onSave:f})),T=O.canvasRef,E=O.overlayCanvasRef,A=O.offscreenCanvasRef,Y=O.cursorRef,D=O.strokesRef,F=O.currentStroke,W=O.mouseDownState,H=O.autoScale,K=O.baseScale,B=O.maskStorkeRef,G=O.isLoadingMaskRef,V=O.setMaskStrokes,$=O.draw,J=(O.drawStroke,O.startDrawing),X=O.endDrawing,q=O.handleMouseMove,ee=O.handleMouseLeave,te=O.handleMouseEnter,ne=O.saveImage,re=O.resetCanvas,ae=O.creatOffscreenCanvas,ie=O.generateMask,se=(O.getTransformLineWidth,O.getTransformedPoint,O.setStrokes),ce=O.setTransform,de=O.clearOverlayCanvas,fe=O.clearCanvas,me=O.fitView,he=ue({overlayCanvasRef:E,canvasRef:T,offscreenCanvasRef:A,cursorRef:Y,lineWidth:k,translatePos:j,autoScale:H,baseScale:K,isLoadingMaskRef:G}),pe=he.handleOnWheel,ge=he.setActiveScale,ve=he.activeScale,xe=(0,R.useMemo)((function(){return o||I||!(null==u||!u.length)}),[o,I,u]),ye=(0,R.useCallback)((function(){var e=T.current,t=E.current,n=A.current;t.width=e.width,t.height=e.height,n.width=e.width,n.height=e.height}),[]),Ce=(0,R.useCallback)((function(){var e=ie(),t=document.createElement("a");t.download="mask_".concat(oe()().format("YYYYMMDDHHmmss"),".png"),t.href=e||"",t.click()}),[ie]),je=(0,R.useCallback)((function(){de(),se([]),V([]),ne(),F.current=[]}),[]),Me=function(e,t){try{var r,a;if(!(e.length||null!=t&&t.length))return;G.current=!0;var i=new OffscreenCanvas(E.current.width,E.current.height);v.current||(v.current=new Worker(new URL(n.p+n.u(5956),n.b),{type:void 0})),v.current.onmessage=function(e){"done"===e.data.type&&e.data.imageData&&(E.current.getContext("2d").putImageData(e.data.imageData,0,0),G.current=!1,ne())},null===(r=v.current)||void 0===r||r.postMessage({canvas:i,type:"init"},[i]),null===(a=v.current)||void 0===a||a.postMessage({type:"draw",maskStrokes:e,strokes:t||[]})}catch(e){}},Re=function(){var e=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length||B.current.length){e.next=3;break}return de(),e.abrupt("return");case 3:Me(B.current,t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Se=(0,R.useCallback)((function(){if(0!==D.current.length||0!==B.current.length){var e=D.current.length,t=D.current.slice(0,-1);se(t),!t.length&&0===e&&B.current.length&&V([]),clearTimeout(z.current),z.current=setTimeout((function(){Re(t)}),100)}else de()}),[]),Ze=(0,R.useCallback)(s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.current&&T.current){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){var t=new Image;t.src=i,t.onload=function(){var n=T.current,r=n.getContext("2d"),a=x.current;K.current=Math.min(a.offsetWidth/t.width,a.offsetHeight/t.height,1),n.width=t.width,n.height=t.height,H.current=1,ae(),ye(),fe(),r.drawImage(t,0,0,n.width,n.height),e()}})));case 3:case"end":return e.stop()}}),e)}))),[i]),_e=function(e){var t=E.current.getContext("2d");if(t)if(e){var r,a,i=E.current.width,s=E.current.height;de();var o=new OffscreenCanvas(E.current.width,E.current.height);g.current||(g.current=new Worker(new URL(n.p+n.u(2331),n.b),{type:void 0})),g.current.onmessage=function(e){"done"===e.data.type&&e.data.imageData&&(E.current.getContext("2d").putImageData(e.data.imageData,0,0),G.current=!1,ne())},null===(r=g.current)||void 0===r||r.postMessage({canvas:o,type:"init"},[o]);var c=t.getImageData(0,0,i,s);null===(a=g.current)||void 0===a||a.postMessage({type:"draw",width:c.width,height:c.height,strokes:D.current,maskStrokes:B.current})}else Re(D.current)},Ie=function(){Y.current.style.width="".concat(k*H.current,"px"),Y.current.style.height="".concat(k*H.current,"px")},Ue=(0,R.useCallback)(s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ze();case 2:null==m||m({width:T.current.width,height:T.current.height}),l.isResetNeeded?(je(),re()):(D.current.length||B.current.length)&&l.isOriginal&&!S.current?Re(D.current):(D.current.length||B.current.length)&&l.isOriginal&&S.current&&_e(!0),Ie();case 6:case"end":return e.stop()}}),e)}))),[Ze,l.isOriginal,l.isResetNeeded]);(0,R.useEffect)((function(){Ue()}),[Ue]),(0,R.useEffect)((function(){var e=function(e){!e.ctrlKey&&!e.metaKey||"z"!==e.key||S.current||Se()};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[]),(0,R.useEffect)((function(){var e=function(e){W.current=!0},t=function(e){W.current=!1};return window.addEventListener("mousedown",e),window.addEventListener("mouseup",t),function(){clearTimeout(z.current),window.removeEventListener("mousedown",e),window.removeEventListener("mouseup",t)}}),[]);var ze=function(){U(!1),Re(D.current),ne()};return(0,R.useImperativeHandle)(t,(function(){return{clearMask:ze,loadMaskPixs:(e=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:V(t),se([]),ce(),de(),Me(t);case 5:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})};var e})),(0,R.useEffect)((function(){return g.current=new Worker(new URL(n.p+n.u(4602),n.b),{type:void 0}),v.current=new Worker(new URL(n.p+n.u(8437),n.b),{type:void 0}),function(){var e,t;null===(e=g.current)||void 0===e||e.terminate(),null===(t=v.current)||void 0===t||t.terminate()}}),[]),(0,R.useEffect)((function(){null!=u&&u.length&&de()}),[u]),(0,R.useEffect)((function(){xe&&Y.current&&(Y.current.style.display="none")}),[xe]),(0,Q.jsxs)("div",{className:"editor-wrapper",children:[(0,Q.jsxs)("div",{className:"flex-between",children:[(0,Q.jsx)(we,{handleBrushSizeChange:function(e){C(e),Y.current.style.width="".concat(e,"px"),Y.current.style.height="".concat(e,"px")},undo:Se,onClear:je,handleFitView:function(){me(),ge(H.current),Ie()},handleUpdateImageList:h,handleUpdateMaskList:p,disabled:xe,lineWidth:k,invertMask:I,loading:r,accept:d}),(0,Q.jsx)(ke,{handleOnChangeMask:function(e){S.current=e.target.checked,_e(e.target.checked),U(e.target.checked)},invertMask:I,downloadMask:Ce,download:function(){var e,t;l.isOriginal?(e=T.current,(t=document.createElement("a")).download="image_".concat(oe()().format("YYYYMMDDHHmmss"),".png"),t.href=e.toDataURL("image/png"),t.click(),t.remove()):function(){if(i){var e=new Image;e.src=i,e.onload=function(){var t=document.createElement("canvas");t.width=l.width,t.height=l.height,t.getContext("2d").drawImage(e,0,0,t.width,t.height);var n=t.toDataURL("image/png"),r="".concat(t.width,"x").concat(t.height,"_").concat(oe()().format("YYYYMMDDHHmmss"),".png"),a=document.createElement("a");a.href=n,a.download=r,document.body.appendChild(a),a.click(),a.remove()}}}()},isOriginal:l.isOriginal,disabled:o||!(null==u||!u.length),maskUpload:u})]}),(0,Q.jsxs)("div",{className:"editor-content",ref:x,style:{position:"relative",width:"100%",height:"100%",flex:1},children:[L.loading&&(0,Q.jsx)(be,{width:L.width,height:L.height}),(0,Q.jsx)("canvas",{ref:T,style:{position:"absolute",zIndex:1}}),(0,Q.jsx)("canvas",{ref:E,className:b()("overlay-canvas",{"overlay-canvas--disabled":xe}),style:{position:"absolute",zIndex:10,cursor:"none"},onMouseDown:function(e){G.current||(W.current=!0,J(e))},onMouseUp:function(e){G.current||(W.current=!1,X(e))},onMouseEnter:te,onWheel:pe,onMouseMove:function(e){G.current||(q(e),$(e))},onMouseLeave:function(e){G.current||(X(e),ee())}}),(0,Q.jsx)("div",{ref:Y,style:{display:"none",position:"fixed",width:k*ve,height:k*ve,backgroundColor:"rgba(0, 0, 255, 0.3)",borderRadius:"50%",pointerEvents:"none",cursor:"none",zIndex:5}})]})]})})),Me=R.memo(je);function Re(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,{canvas:n,ctx:n.getContext("2d")}}function Se(e,t,n,r){var a=4*(n*r+t);return 255===e[a]&&255===e[a+1]&&255===e[a+2]}function Ze(e,t,n,r,a,i,s){for(var o=[[r,a]],l=[[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1]],u=function(){var r=o.pop(),a=c()(r,2),u=a[0],d=a[1];if(u<0||d<0||u>=t||d>=n||i[d][u]||!Se(e,u,d,t))return 1;i[d][u]=!0,s.push({x:u,y:d}),l.forEach((function(e){var t=c()(e,2),n=t[0],r=t[1];return o.push([u+n,d+r])}))};o.length;)u()}function _e(e){for(var t=e.data,n=e.width,r=e.height,a=Array.from({length:r},(function(){return new Array(n).fill(!1)})),i=[],s=0;s<r;s++)for(var o=0;o<n;o++)if(Se(t,o,s,n)&&!a[s][o]){var c=[];Ze(t,n,r,o,s,a,c),i.push(c)}return i}function Ie(e){return new Promise((function(t,n){var r=new Image;r.src=e,r.onload=function(){return t(r)},r.onerror=function(){return n(new Error("Image loading failed"))}}))}function Ue(e){return ze.apply(this,arguments)}function ze(){return(ze=s()(a()().mark((function e(t){var n,r,i,s,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ie(t);case 2:return n=e.sent,r=Re(n.width,n.height),r.canvas,(i=r.ctx).drawImage(n,0,0),s=i.getImageData(0,0,n.width,n.height),o=_e(s),URL.revokeObjectURL(n.src),e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ne=n(76571),Pe=(0,R.forwardRef)((function(e,t){var n=e.modelList,r=(0,v.useIntl)(),i=(0,R.useState)(!1),o=c()(i,2),u=o[0],d=o[1],f=(0,R.useState)(!1),m=c()(f,2),h=m[0],p=m[1],g=(0,R.useRef)(null),x=(0,R.useRef)(null),w=(0,R.useRef)(null),k=(0,R.useState)(""),C=c()(k,2),j=C[0],S=C[1],_=(0,R.useState)(null),P=c()(_,2),O=P[0],Y=P[1],D=(0,R.useState)([]),F=c()(D,2),H=F[0],K=F[1],G=(0,R.useState)([]),ee=c()(G,2),te=ee[0],re=ee[1],ae=(0,R.useState)({isOriginal:!1,isResetNeeded:!1,width:512,height:512}),ie=c()(ae,2),se=ie[0],oe=ie[1],ce=(0,R.useRef)(!1),le=(0,R.useState)(0),ue=c()(le,2),de=ue[0],me=ue[1],he=(0,R.useRef)(null),pe=(0,A.M)(e,{type:"edit"}),ge=pe.handleOnValuesChange,ve=pe.handleToggleParamsStyle,xe=pe.setParams,ye=pe.updateCacheFormData,we=pe.setInitialValues,ke=pe.updateParamsConfig,Ce=pe.setParamsConfig,be=pe.form,je=pe.modelMeta,Re=pe.watchFields,Se=pe.formFields,Ze=pe.paramsConfig,_e=pe.initialValues,Ie=pe.parameters,ze=pe.isOpenaiCompatible,Pe=B({scroller:g,paramsRef:x,chunkFields:["stream_options_chunk_result"],API:Z.d9}),Le=Pe.loading,Oe=Pe.tokenResult,Te=Pe.imageList,Ee=Pe.currentPrompt,Ae=Pe.setImageList,Ye=Pe.setCurrentPrompt,De=Pe.handleStopConversation,Fe=Pe.submitMessage;(0,R.useImperativeHandle)(t,(function(){return{viewCode:function(){d(!0)},setCollapse:function(){p(!h)},collapse:h}}));var We=(0,R.useMemo)((function(){return"custom"===Ie.size?I()(I()({},M().omit(Ie,["width","height","preview","random_seed"])),{},{image:null,mask:null,size:Ie.width&&Ie.height?"".concat(Ie.width,"x").concat(Ie.height):""}):I()({image:null,mask:null},M().omit(Ie,["width","height","random_seed","preview"]))}),[Ie]),He=(0,R.useMemo)((function(){return ze?$({api:Z.d9,edit:!0,isFormdata:!0,parameters:I()(I()({},We),{},{prompt:Ee})}):V({api:Z.d9,isFormdata:!0,edit:!0,parameters:I()(I()({},We),{},{prompt:Ee})})}),[We,Ee,ze]),Ke=function(){var e=s()(a()().mark((function e(){var t,n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=be.current)||void 0===t||null===(t=t.form)||void 0===t?void 0:t.validateFields();case 3:if(Ie.model){e.next=5;break}return e.abrupt("return");case 5:return a=void 0,a={stream_options_chunk_size:16384,stream_options_chunk_result:!0},Ie.preview&&(a={stream_options_preview_faster:!0}),r=I()(I()(I()({},M().omitBy(We,(function(e){return!e}))),{},{seed:Ie.random_seed?(0,L.Hq)():Ie.seed,stream:!0},a),{},{prompt:Ee}),xe(I()(I()({},Ie),{},{seed:r.seed})),null===(n=be.current)||void 0===n||null===(n=n.form)||void 0===n||n.setFieldValue("seed",r.seed),(0,U.gn)(N.Z["/playground/text-to-image"],!0),e.next=11,Fe(I()(I()({},r),{},{image:(0,L.Ll)(M().get(H,"0.dataUrl"),"image"),mask:O?(0,L.Ll)(O,"mask"):null}));case 11:e.next=15;break;case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.prev=15,(0,U.gn)(N.Z["/playground/text-to-image"],!1),e.finish(15);case 19:case"end":return e.stop()}var a}),e,null,[[0,13,15,19]])})));return function(){return e.apply(this,arguments)}}(),Be=(0,R.useCallback)((function(e){var t=(0,W.gk)({width:e.rawWidth,height:e.rawHeight}),n=t.width,r=t.height,a=je.max_width,i=je.max_height;a&&(n=Math.max(Math.min(n,a),512)),i&&(r=Math.max(Math.min(r,i),512));var s=ke({size:"custom",isOpenaiCompatible:ze});Ce(s);var o=I()(I()({},Ie),{},{size:"custom",width:n||512,height:r||512});xe(o),ye({size:"custom",width:n||512,height:r||512}),we(o)}),[Ie,je,ze]),Ge=(0,R.useCallback)((function(e){var t=M().get(e,"[0]",{}),n=M().get(t,"dataUrl","");Be(t),K(e),S(n),me(M().get(e,"[0].uid","")),oe({isOriginal:!0,isResetNeeded:!0,width:M().get(t,"width",512),height:M().get(t,"height",512)}),Ae([])}),[Be]),Ve=(0,R.useCallback)(function(){var e=s()(a()().mark((function e(t){var n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M().get(t,"[0].dataUrl",""),e.next=3,Ue(r);case 3:i=e.sent,null===(n=he.current)||void 0===n||n.loadMaskPixs(i||[]);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),$e=(0,R.useCallback)((function(){var e;re([]),Y(null),null===(e=he.current)||void 0===e||e.clearMask()}),[]),Je=(0,R.useCallback)((function(e){var t;oe((function(e){return I()(I()({},e),{},{isResetNeeded:!1})})),Y(e.mask||(null===(t=te[0])||void 0===t?void 0:t.dataUrl)||null),S(e.img)}),[]),Xe=(0,R.useMemo)((function(){return j?(0,Q.jsx)(Me,{ref:he,imguid:de,imageStatus:se,imageSrc:j,loading:Le,disabled:Le||!se.isOriginal,onSave:Je,clearUploadMask:$e,handleUpdateImageList:Ge,handleUpdateMaskList:Ve,maskUpload:te,accept:W.vm}):(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(fe.Z,{accept:W.vm,drag:!0,multiple:!1,handleUpdateImgList:Ge,children:(0,Q.jsxs)("div",{className:"flex-column flex-center gap-10 justify-center",style:{width:155,height:155},children:[(0,Q.jsx)(l.Z,{type:"icon-upload_image",className:"font-size-24"}),(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.image.edit.tips"})})]})})})}),[r,j,Le,te,se,Je,Ge]),qe=(0,R.useCallback)((function(e,t){e.progress<100&&!t||e.uid!==de&&(me(e.uid),S(e.dataUrl),oe({isOriginal:t,isResetNeeded:!1,width:e.width,height:e.height}))}),[de]);(0,R.useEffect)((function(){if(Te.length>0){var e=Te.find((function(e){return 100===e.progress}));e&&!ce.current&&(ce.current=!0,qe(e,!1))}}),[Te,qe]);var Qe=(0,R.useMemo)((function(){return H.length?(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(ne.Z,I()(I()({},H[0]),{},{height:125,maxHeight:125,preview:!1,loading:!1,autoSize:!1,editable:!1,autoBgColor:!1,onClick:function(){return qe(H[0],!0)},label:(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.image.origin"})})}))}):null}),[H,r,qe]),et=(0,R.useMemo)((function(){return te.length?(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(ne.Z,I()(I()({},te[0]),{},{height:125,maxHeight:125,preview:!1,loading:!1,autoSize:!1,editable:!0,autoBgColor:!1,onDelete:function(){return $e()},label:(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.image.mask"})})}))}):null}),[te,r]);return(0,Q.jsxs)("div",{className:"ground-left-wrapper",children:[(0,Q.jsxs)("div",{className:"ground-left",children:[(0,Q.jsx)("div",{className:"message-list-wrap",style:{paddingBottom:16},children:(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)("div",{className:"content",style:{height:"100%"},children:(0,Q.jsx)("div",{className:"flex-column font-size-14 flex-center gap-20 justify-center hold-wrapper",children:Xe})})})}),(0,Q.jsxs)("div",{className:"ground-left-footer",style:{padding:10},children:[Oe&&(0,Q.jsx)("div",{style:{height:40},children:(0,Q.jsx)(z.Z,{type:"danger",message:null==Oe?void 0:Oe.errorMessage})}),(0,Q.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,Q.jsx)("div",{className:"m-r-10",children:et}),Qe,Te.length>0&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(Ne.Z,{type:"vertical",style:{margin:"0 30px",height:80}}),(0,Q.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:10},children:M().map(Te,(function(e,t){return(0,Q.jsx)("div",{style:{height:125,width:125,maxHeight:125},children:(0,Q.jsx)(ne.Z,I()(I()({},e),{},{height:125,width:125,maxHeight:125,preview:e.preview,loading:e.loading,autoSize:!1,editable:!1,autoBgColor:!1,onClick:function(){return qe(e,!1)}}))},e.uid)}))})]})]})]})]}),(0,Q.jsxs)("div",{className:b()("params-wrapper",{collapsed:h}),style:{display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,Q.jsx)("div",{style:{flex:1,overflow:"auto"},ref:x,"data-overlayscrollbars-initialize":!0,children:(0,Q.jsx)("div",{className:"box",children:(0,Q.jsx)(J.Z,{ref:be,watchFields:Re,formFields:Se,parametersTitle:(0,Q.jsxs)("div",{className:"flex-between flex-center",children:[(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.parameters"})}),(0,Q.jsx)(E.Z,{title:r.formatMessage({id:"playground.image.params.custom.tips"}),children:(0,Q.jsx)(y.ZP,{size:"small",type:"text",icon:(0,Q.jsx)(T.Z,{}),onClick:ve,children:ze?r.formatMessage({id:"playground.image.params.custom"}):r.formatMessage({id:"playground.image.params.openai"})})})]}),onValuesChange:ge,paramsConfig:Ze,initialValues:_e,modelList:n})})}),(0,Q.jsx)("div",{style:{width:389},children:(0,Q.jsx)(X.Z,{actions:[],defaultSize:{minRows:5,maxRows:5},ref:w,placeholer:r.formatMessage({id:"playground.input.prompt.holder"}),title:(0,Q.jsx)("span",{className:"font-600",children:r.formatMessage({id:"playground.image.prompt"})}),loading:Le,disabled:!Ie.model,isEmpty:!Te.length,handleSubmit:Ke,handleAbortFetch:De,onInputChange:function(e){Ye(e.target.value)},shouldResetMessage:!1,clearAll:function(){Ye("")}})})]}),(0,Q.jsx)(q.Z,{open:u,viewCodeContent:He,onCancel:function(){d(!1)},title:r.formatMessage({id:"playground.viewcode"})})]})})),Le=Pe,Oe=(n(64232),"generate"),Te="edit",Ee=function(){var e=(0,v.useIntl)(),t=(0,f.Z)().size,n=(0,R.useState)(Oe),r=c()(n,2),i=r[0],o=r[1],C=(0,R.useRef)(null),j=(0,R.useRef)(null),_=(0,R.useState)([]),I=c()(_,2),U=I[0],z=I[1],N=(0,R.useMemo)((function(){return[{label:e.formatMessage({id:"playground.image.generate"}),value:Oe,icon:(0,Q.jsx)(h.Z,{})},{label:e.formatMessage({id:"playground.image.edit"}),value:Te,icon:(0,Q.jsx)(p.Z,{})}]}),[e]),P=(0,R.useCallback)((function(){var e,t;if(i===Oe)null===(e=C.current)||void 0===e||null===(t=e.viewCode)||void 0===t||t.call(e);else if(i===Te){var n,r;null===(n=j.current)||void 0===n||null===(r=n.viewCode)||void 0===r||r.call(n)}}),[i]),L=(0,R.useCallback)((function(){var e,t,n,r;i!==Oe?null===(e=j.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e):null===(n=C.current)||void 0===n||null===(r=n.setCollapse)||void 0===r||r.call(n)}),[i]),O=(0,R.useMemo)((function(){return[{key:Oe,label:"Generate",children:(0,Q.jsx)(te,{ref:C,modelList:U})},{key:Te,label:"Edit",children:(0,Q.jsx)(Le,{modelList:U,ref:j})}]}),[U]);(0,R.useEffect)((function(){if(t.width<u.Z.lg){var e,n,r,a,i,s;if(null===(e=C.current)||void 0===e||!e.collapse)null===(r=C.current)||void 0===r||null===(a=r.setCollapse)||void 0===a||a.call(r);if(null===(n=j.current)||void 0===n||!n.collapse)null===(i=j.current)||void 0===i||null===(s=i.setCollapse)||void 0===s||s.call(i)}}),[t.width]),(0,R.useEffect)((function(){var e=function(){var e=s()(a()().mark((function e(){var t,n,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={categories:m.Us.image,with_meta:!0},e.next=4,(0,Z.nb)(t);case 4:return n=e.sent,r=M().map(n.data||[],(function(e){return{value:e.id,label:e.id,meta:e.meta}})),e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var t=s()(a()().mark((function t(){var n;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:n=t.sent,z(n),t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();t()}),[]);var T=(0,R.useMemo)((function(){return(0,Q.jsxs)(x.Z,{children:[(0,Q.jsx)(y.ZP,{size:"middle",onClick:P,icon:(0,Q.jsx)(l.Z,{type:"icon-code",className:"font-size-16"}),children:e.formatMessage({id:"playground.viewcode"})}),(0,Q.jsx)(y.ZP,{size:"middle",onClick:L,icon:(0,Q.jsx)(l.Z,{type:"icon-a-layout6-line",className:"font-size-16"})})]},"buttons")}),[e,P,L]),E=(0,R.useMemo)((function(){return{title:(0,Q.jsxs)("div",{className:"flex items-center",children:[(0,Q.jsx)("span",{className:"font-600",children:e.formatMessage({id:"menu.playground.text2images"})}),(0,Q.jsx)(w.Z,{options:N,size:"middle",className:"m-l-40 font-600",onChange:function(e){return o(e)}})]}),style:{paddingInline:"var(--layout-content-header-inlinepadding)"},breadcrumb:{}}}),[N]);return(0,S.y1)(d.ZP.RIGHT.join(","),(function(){var e,t;null===(e=C.current)||void 0===e||null===(t=e.setCollapse)||void 0===t||t.call(e)}),{preventDefault:!0}),(0,Q.jsx)(g._z,{ghost:!0,header:E,extra:T,className:b()("playground-container chat"),children:(0,Q.jsx)("div",{className:"play-ground",children:(0,Q.jsx)("div",{className:"chat",children:(0,Q.jsx)(k.Z,{items:O,activeKey:i})})})})}}}]);