(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36],{133:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});let l=(0,a(9946).A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},1788:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});let l=(0,a(9946).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},6508:(e,s,a)=>{Promise.resolve().then(a.bind(a,9203))},9203:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>Y});var l=a(5155),n=a(2055),r=a(2115),t=a(6695),i=a(6126),c=a(285),o=a(1788),d=a(9946);let m=(0,d.A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var x=a(4126),u=a(7863),h=a(6474),p=a(6051),g=a(6335),j=a(9076),f=a(342),v=a(793),y=a(1035),b=a(7778),N=a(4416),C=a(4355);let E=(0,d.A)("loader-pinwheel",[["path",{d:"M22 12a1 1 0 0 1-10 0 1 1 0 0 0-10 0",key:"1lzz15"}],["path",{d:"M7 20.7a1 1 0 1 1 5-8.7 1 1 0 1 0 5-8.6",key:"1gnrpi"}],["path",{d:"M7 3.3a1 1 0 1 1 5 8.6 1 1 0 1 0 5 8.6",key:"u9yy5q"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),z=(0,d.A)("barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);function k(e){let{visible:s,setVisible:a,initialResolution:t,camera:i,socket:o}=e,[d,m]=(0,r.useState)(void 0),x=(0,r.useRef)(!1),[u,h]=(0,r.useState)([]),[k,S]=(0,r.useState)([]),[w,P]=(0,r.useState)(void 0),[A,M]=(0,r.useState)(void 0),[_,q]=(0,r.useState)(),{stateRef:I,calibrationdata:T,calibrating:R,pipelines:$,pipelinetypes:O,connection:D}=(0,f.jg)();function V(){if(!w||!D.backend){h([]),S([]);return}let e=[],s=[];w.settings.forEach(a=>{var n,r;let t=(0,l.jsx)(v.Nv,{setting:a,setValue:e=>{(0,f.sG)(e)&&(setTimeout(()=>{if(A){let s={...A.settingsValues,[a.name]:e},l={...A,settingsValues:s},n=new Map($);n.set(A.index,l),I&&(I.current.pipelines=n)}},10),setTimeout(()=>{var s=a.name,l=A;if(l||(l=$.get(9999)),void 0!==l&&(0,f.sG)(e)){let a=g.wS.create({type:g.sE.MESSAGE_TYPE_PROTO_SET_SETTING,setPipelineSetting:j.Ob.create({pipelineIndex:9999,value:e,setting:s})}),l=g.wS.encode(a).finish();null==o||o.sendBinary(l)}},10))},value:null!=(r=null!=(n=null==A?void 0:A.settingsValues[a.name])?n:a.default)?r:(0,v.vR)(""),defaultValue:a.default,locked:!1},a.name+a.category);"Camera Properties"===a.category?e.push(t):s.push(t)}),h(e),S(s)}function B(e){let s=g.wS.create({type:g.sE.MESSAGE_TYPE_PROTO_SET_PIPELINE_INDEX,setPipelineIndex:j.Wi.create({cameraIndex:e.index,pipelineIndex:d})}),l=g.wS.encode(s).finish();null==o||o.sendBinary(l);let n=g.wS.create({type:g.sE.MESSAGE_TYPE_PROTO_DELETE_PIPELINE,removePipelineIndex:9999}),r=g.wS.encode(n).finish();null==o||o.sendBinary(r),a(!1)}return(0,r.useEffect)(()=>{!0===x.current&&!1===R&&(console.log("Calibration just finished!"),void 0!==i&&B(i)),x.current=R},[R]),(0,r.useEffect)(()=>{if(i){let e=T.get(i.index);null==e||e.forEach(e=>{e.resolution==(null==A?void 0:A.settingsValues.resolution.stringValue)&&q(e)})}},[T]),(0,r.useEffect)(()=>{V()},[w,A]),(0,r.useEffect)(()=>{if(s){let e=$.get(9999);if(e){M(e);let s=O.get("$$CalibrationPipeline$$");s?P(s):console.warn("Pipeline type not found for",e.type)}else console.warn("No valid pipeline found for camera",i)}},[$,O,i,s]),(0,r.useEffect)(()=>{if(s&&i){V(),9999!==i.pipelineIndex&&m(i.pipelineIndex);if(i){let e=g.wS.create({type:g.sE.MESSAGE_TYPE_PROTO_ADD_PIPELINE,pipelineInfo:j.hz.create({name:"TemporaryCalibrationPipeline",type:"$$CalibrationPipeline$$",index:9999,settingsValues:{}})}),s=g.wS.encode(e).finish();null==o||o.sendBinary(s);let a=g.wS.create({type:g.sE.MESSAGE_TYPE_PROTO_SET_PIPELINE_INDEX,setPipelineIndex:j.Wi.create({cameraIndex:i.index,pipelineIndex:9999})}),l=g.wS.encode(a).finish();null==o||o.sendBinary(l)}}},[s]),(0,r.useEffect)(()=>{},[R]),(0,r.useEffect)(()=>{P(O.get("$$CalibrationPipeline$$")),M($.get(9999)),V()},[$,s,i]),(0,l.jsxs)(y.L,{visible:s,onClose:()=>{a(!1)},className:"w-[90vw] h-[90vh]",children:[(0,l.jsx)("div",{style:{color:p.zq},children:(0,l.jsx)(c.$,{onClick:()=>{s&&i&&i.pipelineIndex!==d&&B(i)},className:"w-auto cursor-pointer hover:bg-zinc-600 bg-zinc-700",style:{color:p.zq},children:(0,l.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,l.jsx)(N.A,{}),"Close"]})})}),(0,l.jsxs)(n.f,{className:"mt-4 w-full",gap:"gap-10",style:{color:p.zq},children:[(0,l.jsxs)(n.V,{className:"flex-1",style:{color:p.zq},children:[(0,l.jsxs)("h1",{className:"text-xl",style:{color:p.zq},children:["Camera #",null==i?void 0:i.index," Config:"]}),R?void 0:u.length>0?(0,l.jsx)("div",{className:"space-y-2 pr-4",children:u}):(0,l.jsxs)("div",{className:"text-center",style:{color:p.zq},children:[(0,l.jsx)(C.A,{className:"w-16 h-16 mx-auto mb-2 opacity-50"}),(0,l.jsx)("p",{className:"select-none",children:"Camera Settings"}),(0,l.jsx)("p",{className:"text-sm select-none",children:"Configure camera parameters"})]}),(0,l.jsx)("div",{className:"items-center",children:R?(0,l.jsx)(E,{className:"w-16 h-16",color:p.zq}):i?(0,l.jsx)("p",{}):void 0})]}),(0,l.jsxs)(n.V,{className:"flex-1 items-center space-y-10",children:[(0,l.jsx)(b.I,{stream:null==i?void 0:i.streamPath,maxWidth:"max-w-[500px]"}),R?void 0:k.length>0?(0,l.jsx)("div",{className:"space-y-2",children:k}):(0,l.jsxs)("div",{className:"text-center items-center",style:{color:p.zq},children:[(0,l.jsx)(z,{className:"w-16 h-16 mx-auto mb-2 opacity-50"}),(0,l.jsx)("p",{className:"select-none",children:"Calibration Settings"}),(0,l.jsx)("p",{className:"text-sm select-none",children:"Configure calibration parameters"})]})]})]})]})}function S(){return(0,l.jsxs)("div",{className:"flex items-center justify-between",style:{color:p.zq},children:[(0,l.jsx)("div",{className:"flex items-center gap-3",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-lg font-bold",children:"Camera Intrinsic Calibration"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Determines the internal parameters of the camera lens to accurately map data from a 2D image into 3D space."})]})}),(0,l.jsx)(n.f,{className:"items-center gap-3",children:(0,l.jsxs)(c.$,{size:"sm",style:{color:p.zq},className:"hover:bg-zinc-700 cursor-pointer",children:[(0,l.jsx)(o.A,{className:"w-4 h-4 mr-2"}),"Import Results"]})})]})}function w(e){let{resolutions:s,selected:a,onSelect:o,selectedCamera:d,socket:x}=e,[u,h]=(0,r.useState)(!1);return(0,l.jsxs)(t.Zp,{className:"bg-zinc-900 border-gray-700",style:{color:p.zq},children:[(0,l.jsxs)(t.aR,{className:"pb-1",children:[(0,l.jsx)(t.ZB,{children:"Select Resolution"}),(0,l.jsx)(t.BT,{children:"View calibration parameters for specific resolution"})]}),(0,l.jsxs)(t.Wu,{className:"pt-0",children:[(0,l.jsxs)(n.f,{className:"items-center gap-2",children:[s.map(e=>(0,l.jsxs)(c.$,{onClick:()=>o(e),className:"".concat((null==a?void 0:a.resolution)===e?"bg-stone-600 hover:bg-stone-500":"border-gray-600 bg-gray-700 hover:bg-gray-600 hover:border-zinc-700"," cursor-pointer"),children:[e,(0,l.jsx)(i.E,{className:"ml-2",variant:"secondary"})]},e)),(0,l.jsxs)(c.$,{variant:"outline",size:"sm",className:"ml-4 border-gray-600 bg-gray-700 hover:bg-gray-600 hover:border-gray-500 cursor-pointer",style:{color:p.zq},onClick:()=>{h(!0)},children:[(0,l.jsx)(m,{className:"w-4 h-4 mr-2"}),"Calibrate"]})]}),(0,l.jsx)(k,{visible:u,setVisible:h,initialResolution:null==a?void 0:a.resolution,camera:d,socket:x})]})]})}function P(e){var s,a,n,r;let{data:i}=e;return(0,l.jsxs)(t.Zp,{className:"bg-zinc-900 border-gray-700",style:{color:p.zq},children:[(0,l.jsxs)(t.aR,{children:[(0,l.jsxs)(t.ZB,{children:["Camera Matrix (K) - ",i.resolution]}),(0,l.jsx)(t.BT,{children:"Intrinsic camera parameters in pixel coordinates"})]}),(0,l.jsxs)(t.Wu,{children:[(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-4 font-mono text-sm mb-4",children:[(0,l.jsx)(A,{label:"fx",value:null!=(s=i.cameraMatrix.at(0))?s:0,color:"blue"}),(0,l.jsx)(A,{label:"0",value:0}),(0,l.jsx)(A,{label:"cx",value:null!=(a=i.cameraMatrix.at(2))?a:0,color:"green"}),(0,l.jsx)(A,{label:"0",value:0}),(0,l.jsx)(A,{label:"fy",value:null!=(n=i.cameraMatrix.at(4))?n:0,color:"blue"}),(0,l.jsx)(A,{label:"cy",value:null!=(r=i.cameraMatrix.at(5))?r:0,color:"green"}),(0,l.jsx)(A,{label:"0",value:0}),(0,l.jsx)(A,{label:"0",value:0}),(0,l.jsx)(A,{label:"1",value:1})]}),(0,l.jsxs)("div",{className:"text-xs space-y-1",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"fx, fy:"})," Focal lengths"]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"cx, cy:"})," Principal point"]})]})]})]})}function A(e){let{label:s,value:a,color:n}=e,r={red:"bg-red-700",green:"bg-green-700",blue:"bg-violet-600",gray:"bg-gray-700"}[null!=n?n:"gray"],t={red:"text-red-300",green:"text-green-300",blue:"text-blue-300",gray:"text-gray-300"}[null!=n?n:"gray"];return(0,l.jsxs)("div",{className:"text-center p-3 rounded border border-gray-600 ".concat(r," \n        transform transition-transform duration-200 ease-in-out hover:scale-110"),children:[(0,l.jsx)("div",{className:"font-semibold ".concat(t),children:s}),(0,l.jsx)("div",{className:t,children:a.toFixed(2)})]})}function M(e){let{data:s}=e;return(0,l.jsxs)(t.Zp,{className:"bg-zinc-900 border-gray-700",style:{color:p.zq},children:[(0,l.jsxs)(t.aR,{children:[(0,l.jsxs)(t.ZB,{children:["Distortion Coefficients - ",s.resolution]}),(0,l.jsx)(t.BT,{children:"Radial and tangential distortion parameters"})]}),(0,l.jsx)(t.Wu,{children:(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsx)("div",{className:"grid grid-cols-1 gap-3",children:Object.entries(s.distCoeffs).map(e=>{let[s,a]=e;return(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded border border-gray-600  transform transition-transform duration-200 ease-in-out hover:scale-105",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(i.E,{variant:"outline",className:"font-mono border-gray-500 text-gray-300",children:s}),(0,l.jsx)("span",{className:"text-sm",children:s.startsWith("k")?"Radial":"Tangential"})]}),(0,l.jsx)("span",{className:"font-mono font-semibold",children:a.toFixed(6)})]},s)})})})})]})}function _(e){let{selectedCamera:s,socket:a}=e,[n,t]=(0,r.useState)(void 0),[i,o]=(0,r.useState)(void 0),{calibrationdata:d}=(0,f.jg)();(0,r.useEffect)(()=>{if(s){var e;o(Array.from((null!=(e=d.get(s.index))?e:new Map).keys()))}},[s,d]);let[m,g]=(0,r.useState)(!1);return(0,l.jsx)("div",{style:{color:p.zq},children:(0,l.jsxs)("div",{className:"space-y-4",style:{backgroundColor:p.pk,borderRadius:"12px",padding:"24px"},children:[(0,l.jsx)(S,{}),(0,l.jsx)(w,{resolutions:null!=i?i:[],selected:n,onSelect:e=>{if(s){var a;let l=null==(a=d.get(s.index))?void 0:a.get(e);l&&t(l)}},selectedCamera:s,socket:a}),void 0!==n&&(0,l.jsxs)("div",{className:"flex justify-center mt-2 flex-col gap-4",children:[(0,l.jsxs)(c.$,{size:"sm",variant:"outline",onClick:()=>{},className:"flex items-center bg-zinc-800 hover:bg-zinc-700 cursor-pointer border-zinc-700","aria-expanded":m,"aria-controls":"detailed-info-section",style:{color:p.zq},children:[(0,l.jsx)(x.A,{})," Delete Calibration Data for"," ",n.resolution]}),(0,l.jsxs)(c.$,{size:"sm",variant:"outline",onClick:()=>g(!m),className:"flex items-center bg-zinc-800 hover:bg-zinc-700 cursor-pointer border-zinc-700","aria-expanded":m,"aria-controls":"detailed-info-section",style:{color:p.zq},children:[m?"Hide Details & Actions":"Show Details & Actions",m?(0,l.jsx)(u.A,{className:"w-4 h-4"}):(0,l.jsx)(h.A,{className:"w-4 h-4"})]})]}),(0,l.jsx)("div",{id:"detailed-info-section",className:"overflow-hidden transition-all duration-500 ease-in-out\n                      ".concat(m?"max-h-[2000px] opacity-100 space-y-2":"max-h-0 opacity-0 p-0"),style:{color:p.zq},children:n&&(0,l.jsxs)(l.Fragment,{children:[" ",(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[(0,l.jsx)(P,{data:n}),(0,l.jsx)(M,{data:n})]})]})})]})})}function q(e){let{text:s="Coming soon...",className:a=""}=e;return(0,l.jsx)("div",{className:"p-4 border-2 border-dashed border-gray-500 rounded-md text-sm text-gray-400 text-center ".concat(a," w-full h-full"),children:s})}var I=a(1071),T=a(678),R=a(1222),$=a(8698),O=a(6733),D=a.n(O),V=a(6877),B=a(5196),L=a(4020),W=a(3717),G=a(133);function Z(e){var s,a,i,o,d;let{cameras:m,selectedCamera:x,setSelectedCamera:u,socket:h}=e,[j,f]=(0,r.useState)(!1),[v,y]=(0,r.useState)(null==x?void 0:x.name);return(0,r.useEffect)(()=>{x&&y(null==x?void 0:x.name)},[x]),(0,l.jsxs)(t.Zp,{className:"border-none",style:{backgroundColor:p.pk,color:p.zq},children:[(0,l.jsxs)(t.aR,{className:"pb-0",children:[(0,l.jsx)("div",{className:"flex items-center gap-2",children:"Camera Configuration"}),(0,l.jsx)(t.BT,{})]}),(0,l.jsxs)(t.Wu,{children:[(0,l.jsx)(n.f,{gap:"gap-8",className:"items-center",children:j?(0,l.jsxs)(n.f,{gap:"gap-4",className:"items-center",children:[(0,l.jsx)(R.A,{label:"Camera Name",inputWidth:"w-100",value:null!=v?v:"Unknown Camera",onChange:y}),(0,l.jsx)(c.$,{variant:"outline",className:"rounded-md cursor-pointer bg-zinc-900 hover:bg-zinc-700",style:{borderColor:p.Cz,color:p.zq},onClick:()=>{f(!1),y(null==x?void 0:x.name)},children:(0,l.jsx)(V.A,{})}),(0,l.jsx)(c.$,{variant:"outline",className:"rounded-md cursor-pointer bg-zinc-900 hover:bg-zinc-700",style:{borderColor:p.Cz,color:p.zq},onClick:()=>{D()(void 0!==x);let e=g.wS.create({type:g.sE.MESSAGE_TYPE_PROTO_RENAME_CAMERA,renameCamera:I.rY.create({cameraIndex:null==x?void 0:x.index,newName:v})}),s=g.wS.encode(e).finish();null==h||h.sendBinary(s),f(!1),y(null==x?void 0:x.name)},children:(0,l.jsx)(B.A,{})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T.m,{options:m?Array.from(m.values()).map(e=>({label:"".concat(null==e?void 0:e.name),value:e})):[],label:"Camera",value:x,onValueChange:e=>{void 0!==e&&u(e)}}),(0,l.jsx)(F,{selectedCamera:x,setRenamingCamera:()=>{f(!0)}})]})}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-y-2 gap-x-4 mt-4 text-sm",children:[(0,l.jsx)("span",{className:"font-semibold",children:"Camera Index:"}),(0,l.jsxs)("span",{children:["#",null!=(s=null==x?void 0:x.index)?s:"—"]}),(0,l.jsx)("span",{className:"font-semibold",children:"Camera Device Name:"}),(0,l.jsx)("span",{children:null!=(a=null==x?void 0:x.kind)?a:"—"}),(0,l.jsx)("span",{className:"font-semibold",children:"Stream Path:"}),(0,l.jsx)("span",{className:"hover:text-pink-800 underline",children:(0,l.jsx)("a",{href:null==x?void 0:x.streamPath,children:null!=(i=null==x?void 0:x.streamPath)?i:"—"})}),(0,l.jsx)("span",{className:"font-semibold",children:"Default Pipeline:"}),(0,l.jsx)("span",{children:null!=(o=null==x?void 0:x.defaultPipeline)?o:"—"}),(0,l.jsx)("span",{className:"font-semibold",children:"Max FPS:"}),(0,l.jsx)("span",{children:null!=(d=null==x?void 0:x.maxFps)?d:"—"})]})]})]})}function F(e){let{selectedCamera:s,setRenamingCamera:a}=e;return(0,l.jsxs)($.rI,{children:[(0,l.jsx)($.ty,{asChild:!0,children:(0,l.jsx)(c.$,{variant:"outline",className:"rounded-md cursor-pointer bg-zinc-900 hover:bg-zinc-700",style:{borderColor:p.Cz,color:p.zq},children:(0,l.jsx)(L.A,{className:"w-4 h-4",style:{color:p.zq}})})}),(0,l.jsx)($.SQ,{side:"bottom",align:"end",alignOffset:20,className:"rounded-md shadow-lg bg-zinc-800",style:{borderColor:p.Cz,borderWidth:"1px"},children:[{icon:(0,l.jsx)(W.A,{className:"w-5 h-5",style:{color:p.zq}}),label:"Rename",action:a,disabled:()=>void 0===s},{icon:(0,l.jsx)(x.A,{className:"w-5 h-5",style:{color:p.zq}}),label:"Remove Camera",action:()=>{},disabled:()=>!0},{icon:(0,l.jsx)(G.A,{className:"w-5 h-5",style:{color:p.zq}}),label:"Rescan Cameras",action:()=>{},disabled:()=>void 0===s}].map(e=>{let{icon:s,label:a,action:n,disabled:r}=e;return(0,l.jsxs)($._2,{disabled:r(),className:"flex items-center gap-2 text-sm font-medium px-3 py-2 rounded-md ".concat(r()?"cursor-not-allowed opacity-50":"cursor-pointer"),style:{color:r()?"#999":p.zq,transition:"all 0.15s ease"},onClick:n,onMouseEnter:e=>{r()||(e.currentTarget.style.backgroundColor=p.CD)},onMouseLeave:e=>{r()||(e.currentTarget.style.backgroundColor="transparent")},children:[s,a]},a)})})]})}function Y(){let{cameras:e,socket:s}=(0,f.jg)(),[a,i]=(0,r.useState)(void 0),[c,o]=(0,r.useState)(0);return(0,r.useEffect)(()=>{void 0!==c&&i(e.get(c))},[e,c]),(0,r.useEffect)(()=>{document.title="Synapse Client"},[]),(0,l.jsx)("div",{className:"w-full min-h-screen text-pink-600",style:{backgroundColor:p.Tp,color:p.zq,padding:"10px"},children:(0,l.jsxs)(n.f,{className:"h-full",gap:"gap-2",wrap:!0,children:[(0,l.jsxs)(n.V,{className:"flex-[2] space-y-2 h-full",children:[(0,l.jsx)(Z,{cameras:e,selectedCamera:a,setSelectedCamera:e=>o(null==e?void 0:e.index),socket:s}),(0,l.jsx)(_,{selectedCamera:a,socket:s})]}),(0,l.jsxs)(n.V,{className:"flex-auto space-y-2 h-full min-w-[500px]",children:[(0,l.jsx)(t.Zp,{className:"items-center border-none",style:{backgroundColor:p.pk},children:(0,l.jsx)(b.I,{stream:null==a?void 0:a.streamPath})}),(0,l.jsx)(t.Zp,{style:{backgroundColor:p.pk},className:"border-none h-[300px]",children:(0,l.jsx)(q,{text:"TODO: Camera Pose Visualization"})})]})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[15,292,481,342,357,538,441,684,358],()=>s(6508)),_N_E=e.O()}]);