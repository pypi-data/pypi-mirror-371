import{k as w,l as M,f as $,d as b,o as l,w as a,c as e,b as i,a as H,y as u,s as h,C as S,x as g,z as n,$ as f,B as y,H as U,I as Y,K as D,M as K,F as q,v as G}from"./index-rTdk84Tb.js";import{_ as J,P as O}from"./PowerFlowCard-D9lB7ADc.js";import{C as F,h as N,p as P,f as W,B as E,j as I,L as R,k as j}from"./index-CrkaV6us.js";import{f as x}from"./utils-D98hIld_.js";import{V as z,a as B,b as T}from"./VCard-CcKmswOV.js";import{n as L}from"./index-CIfGlkmd.js";import{V as Q}from"./VToolbar-CZdLN_jD.js";import{V as X}from"./VDivider-DRsaEHkx.js";import{V as Z}from"./forwardRefs-DI0R31zo.js";import{V as ee,a as C}from"./VRow-Ntq-oewQ.js";import{V as ae,a as V}from"./VTabs-BWUCSdsh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VImg-CZ1BmD-H.js";import"./VBtn-CyybdnDU.js";import"./group-CDWxOlVP.js";import"./scopeId-TcS2mjah.js";const te={class:""},se={class:"bg-subgroup pa-2 mt-2 items-center rounded-md"},ne={class:"text-left"},oe={class:"float-right"},re={key:0,class:"bg-subgroup pa-2 mt-2 items-center rounded-md"},le=w({__name:"DeviceEnergyCard",props:{measurement:{},device:{},statistics:{},timeframe:{}},setup(v){const{t,d:m}=M(),r=v,_=$(()=>r.measurement.consumed_energy!=0?100*r.measurement.solar_consumed_energy/r.measurement.consumed_energy:0),d=$(()=>r.statistics?{labels:r.statistics.map(o=>m(new Date(o.measurement_date),{month:"numeric",day:"numeric"})),datasets:[{label:"Consumption",backgroundColor:"#2563eb",data:r.statistics.map(o=>{const s=o.device_measurements.find(c=>c.device_id==r.device.id);return s?s.consumed_energy:0})}]}:{labels:[],datasets:[]}),p={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}}};return F.register(N,P,W,E,I,R),(o,s)=>(l(),b(T,{class:"elevation-2 ma-4 pa-4 card-fixed-width"},{default:a(()=>[e(z,null,{default:a(()=>[i("span",{class:H(["mdi pr-2",o.device.icon])},null,2),i("span",te,u(o.device.name),1)]),_:1}),e(B,null,{default:a(()=>[i("div",se,[i("div",ne,[g(u(n(t)("consumption"))+" ",1),i("span",oe,u(n(x)(o.measurement.consumed_energy,"kWh")),1)]),e(J,{"self-sufficiency":_.value,"consumed-energy":o.measurement.consumed_energy,"consumed-solar-energy":o.measurement.solar_consumed_energy},null,8,["self-sufficiency","consumed-energy","consumed-solar-energy"])]),o.timeframe=="week"||o.timeframe=="month"?(l(),h("div",re,[e(n(j),{data:d.value,options:p},null,8,["data"])])):S("",!0)]),_:1})]),_:1}))}}),ie=w({__name:"WeeklyStatistics",props:{data:{}},setup(v){const{d:t}=M(),m=$(()=>({labels:_.data.map(d=>t(new Date(d.measurement_date),{month:"numeric",day:"numeric"})),datasets:[{label:"Solar Production",backgroundColor:"#fbbf24",data:_.data.map(d=>d.solar_produced_energy)},{label:"Consumption",backgroundColor:"#2563eb",data:_.data.map(d=>d.consumed_energy)}]})),r={responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}}};F.register(N,P,W,E,I,R);const _=v;return(d,p)=>(l(),b(n(j),{data:m.value,options:r},null,8,["data"]))}}),ue=w({__name:"WeeklyStatisticsCard",props:{data:{}},setup(v){return(t,m)=>(l(),b(T,{class:"elevation-2 ma-4 pa-4 card-fixed-width"},{default:a(()=>[e(B,{class:"h-100 w-auto"},{default:a(()=>[e(ie,{data:t.data},null,8,["data"])]),_:1})]),_:1}))}}),de={class:"bg-subgroup pa-2 mt-2 items-center rounded-md"},ce={class:"text-left"},me={class:"float-right"},pe={class:"bg-subgroup pa-2 mt-2 items-center rounded-md"},_e={class:"text-left"},fe={class:"float-right"},ge=w({__name:"EnergyConsumptionCard",props:{selfSufficiency:{},selfConsumption:{}},setup(v){return(t,m)=>(l(),b(T,{class:"elevation-2 ma-4 pa-4 card-fixed-width"},{default:a(()=>[e(z,null,{default:a(()=>[g(u(n(f)("consumption")),1)]),_:1}),e(B,null,{default:a(()=>[i("div",de,[i("div",ce,[g(u(n(f)("self_sufficiency"))+" ",1),i("span",me,u(n(x)(t.selfSufficiency,"%")),1)]),e(L,{color:"sun",height:"15",rounded:"","model-value":t.selfSufficiency},null,8,["model-value"])]),i("div",pe,[i("div",_e,[g(u(n(f)("self_consumption"))+" ",1),i("span",fe,u(n(x)(t.selfConsumption,"%")),1)]),e(L,{color:"grid",height:"15",rounded:"","model-value":t.selfConsumption},null,8,["model-value"])])]),_:1})]),_:1}))}}),ve={class:"d-flex min-height-screen w-100 justify-center"},ye={key:0,class:"d-flex w-100 flex-column align-center"},he={key:1},be={key:0,class:"pa-4"},Ee=w({__name:"Statistics",setup(v){const t=y(),m=y(),r=y(!1),_=y(0),d=y(0),p=y("today");U(p,()=>{const s=new Date;switch(p.value){case"week":s.setDate(s.getDate()-7);break;case"month":s.setMonth(s.getMonth()-1);break;case"year":s.setFullYear(s.getFullYear()-1);break}console.log("Load "+s.toString()),o(s)}),Y(()=>{o(new Date)});const o=async function(s){r.value=!0;const c=(await D.getHomeMeasurementDifference(s,new Date)).data;t.value=c,_.value=(1-c.grid_imported_energy/c.consumed_energy)*100,d.value=(c.consumed_energy-c.grid_imported_energy)/c.solar_produced_energy*100,m.value=await D.getDailyMeasurements(s,new Date),r.value=!1};return(s,c)=>(l(),h("div",null,[e(Q,{color:"transparent",title:n(K)("bp4")?n(f)("app.statistics"):""},{append:a(()=>[e(ae,{modelValue:p.value,"onUpdate:modelValue":c[0]||(c[0]=k=>p.value=k),"align-tabs":"end",height:"100%"},{default:a(()=>[e(V,{value:"today"},{default:a(()=>[g(u(n(f)("period.today")),1)]),_:1}),e(V,{value:"week"},{default:a(()=>[g(u(n(f)("period.week")),1)]),_:1}),e(V,{value:"month"},{default:a(()=>[g(u(n(f)("period.month")),1)]),_:1}),e(V,{value:"year"},{default:a(()=>[g(u(n(f)("period.year")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["title"]),e(X),i("div",ve,[r.value?(l(),h("div",ye,[e(Z,{indeterminate:"",color:"primary",class:"py-2"})])):(l(),h("div",he,[t.value?(l(),h("div",be,[e(ee,null,{default:a(()=>[e(C,{cols:"12",lg:"6"},{default:a(()=>[e(O,{"home-consumption-power":t.value.consumed_energy,"solar-power":t.value.solar_produced_energy,"grid-imported-energy":t.value.grid_imported_energy,"grid-exported-energy":t.value.grid_exported_energy,unit:"kWh"},null,8,["home-consumption-power","solar-power","grid-imported-energy","grid-exported-energy"])]),_:1}),e(C,{cols:"12",lg:"6"},{default:a(()=>[e(ge,{"self-sufficiency":_.value,"self-consumption":d.value},null,8,["self-sufficiency","self-consumption"])]),_:1}),p.value=="week"&&m.value!=null?(l(),b(C,{key:0,cols:"12",lg:"6"},{default:a(()=>[e(ue,{data:m.value},null,8,["data"])]),_:1})):S("",!0),(l(!0),h(q,null,G(t.value.device_measurements,(k,A)=>(l(),b(C,{key:A,cols:"12",lg:"6"},{default:a(()=>[e(le,{measurement:k,device:n(D).getDeviceInfo(k.device_id),statistics:m.value,timeframe:p.value},null,8,["measurement","device","statistics","timeframe"])]),_:2},1024))),128))]),_:1})])):S("",!0)]))])]))}});export{Ee as default};
