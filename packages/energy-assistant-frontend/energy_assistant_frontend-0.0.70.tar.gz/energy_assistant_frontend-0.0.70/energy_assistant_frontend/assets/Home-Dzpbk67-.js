import{k as N,l as ge,B as xe,H as te,I as we,s as T,C as G,o as b,c,z as y,J as ke,K as Q,d as A,w as v,b as h,a as Me,y as m,F as ie,v as ne,x as P,$ as M,u as Ce,f as J,L as re}from"./index-rTdk84Tb.js";import{_ as Pe,P as Se}from"./PowerFlowCard-D9lB7ADc.js";import{V as Ie}from"./VSelect-DAxXIMPF.js";import{f as S,a as $e}from"./utils-D98hIld_.js";import{V as se,a as Z,b as ee}from"./VCard-CcKmswOV.js";import{V as le}from"./VContainer-BgDIEsn5.js";import{V as X,a as I}from"./VRow-Ntq-oewQ.js";import{m as j,r as p,v as Te,c as ue,i as D,t as Ae,d as Be,a as Ve,A as de,P as Ee,B as De,b as Re,e as We,C as je,p as Ne,f as ze,g as Oe,D as Fe}from"./index-CrkaV6us.js";import{n as O}from"./index-CIfGlkmd.js";import{V as Le}from"./VToolbar-CZdLN_jD.js";import{V as He}from"./VDivider-DRsaEHkx.js";import{V as Ue}from"./forwardRefs-DI0R31zo.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTextField-BxXSkPUZ.js";import"./VInput-Bt0LTJtD.js";import"./group-CDWxOlVP.js";import"./VImg-CZ1BmD-H.js";import"./scopeId-TcS2mjah.js";import"./VCheckboxBtn-BgJQqK4s.js";import"./VSelectionControl-y06q5-k6.js";const Ge={key:0,class:"bg-subgroup mt-2 w-full items-center rounded-md px-2 pt-1"},Xe=N({__name:"PowerModeSelection",props:{deviceId:{},supportedPowerModes:{},powerMode:{}},setup(e){const{t:a}=ge();function t(i){return{title:a("power_mode."+i),mode:i}}let r=xe("device_controlled");const o=e;return te(r,()=>{r.value!=""&&Q.setPowerMode(o.deviceId,r.value)}),te(()=>o.powerMode,(i,n)=>{console.log("watch power mode: "+r.value),r.value=o.powerMode}),we(()=>{r.value=o.powerMode}),(i,n)=>i.supportedPowerModes&&i.supportedPowerModes.length>1&&i.powerMode?(b(),T("div",Ge,[c(Ie,{modelValue:y(r),"onUpdate:modelValue":n[0]||(n[0]=s=>ke(r)?r.value=s:r=s),class:"my-4",items:i.supportedPowerModes.map(s=>t(s)),"item-title":"title","item-value":"mode","single-line":""},null,8,["modelValue","items"])])):G("",!0)}}),Je={class:""},Ke={class:"float-right"},Ye={class:"float-right"},qe=N({__name:"DeviceCard",props:{device:{},available:{type:Boolean},power:{},today:{},attributes:{}},setup(e){function a(t,r){switch(t){case"session_time":return $e(r);case"session_energy":case"session_solar_energy":return S(parseFloat(r),"kWh")}return r}return(t,r)=>(b(),A(ee,{class:"pa-4 elevation-2 ma-4 card-fixed-width"},{default:v(()=>[c(se,null,{default:v(()=>[h("span",{class:Me(["mdi pr-2",t.device.icon])},null,2),h("span",Je,m(t.device.name),1)]),_:1}),c(Z,null,{default:v(()=>[c(le,{class:"pa-0"},{default:v(()=>[c(X,{"no-gutters":""},{default:v(()=>[t.available&&t.attributes&&Object.entries(t.attributes).length>0?(b(),A(I,{key:0,class:"bg-subgroup pa-2 mb-2"},{default:v(()=>[(b(!0),T(ie,null,ne(Object.entries(t.attributes),(o,i)=>(b(),T("div",{key:i,class:"text-left w-100"},[P(m(y(M)("device_attribute."+o[0]))+" ",1),h("span",Ke,m(a(o[0],o[1])),1)]))),128))]),_:1})):G("",!0),t.available?G("",!0):(b(),A(I,{key:1,class:"pa-2 bg-error text-center"},{default:v(()=>[P(m(y(M)("unavailable")),1)]),_:1}))]),_:1}),t.available?(b(),A(X,{key:0,class:"text-left bg-subgroup","no-gutters":""},{default:v(()=>[c(I,{class:"pa-2"},{default:v(()=>[P(m(y(M)("consumption"))+" ",1),h("span",Ye,m(y(S)(t.power,"W")),1)]),_:1})]),_:1})):G("",!0),c(X,{class:"bg-subgroup","no-gutters":""},{default:v(()=>[c(I,{class:"pa-2"},{default:v(()=>[c(Pe,{"self-sufficiency":t.today.self_sufficiency,"consumed-energy":t.today.consumed_energy,"consumed-solar-energy":t.today.consumed_solar_energy},null,8,["self-sufficiency","consumed-energy","consumed-solar-energy"])]),_:1})]),_:1})]),_:1}),c(Xe,{"device-id":t.device.id,"supported-power-modes":t.device.supported_power_modes,"power-mode":t.device.power_mode},null,8,["device-id","supported-power-modes","power-mode"])]),_:1})]),_:1}))}});/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var ae=(function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var e=window.screen;if(e)return(e.deviceXDPI||1)/(e.logicalXDPI||1)}return 1})(),R={toTextLines:function(e){var a=[],t;for(e=[].concat(e);e.length;)t=e.pop(),typeof t=="string"?a.unshift.apply(a,t.split(`
`)):Array.isArray(t)?e.push.apply(e,t):D(e)||a.unshift(""+t);return a},textSize:function(e,a,t){var r=[].concat(a),o=r.length,i=e.font,n=0,s;for(e.font=t.string,s=0;s<o;++s)n=Math.max(e.measureText(r[s]).width,n);return e.font=i,{height:o*t.lineHeight,width:n}},bound:function(e,a,t){return Math.max(e,Math.min(a,t))},arrayDiff:function(e,a){var t=e.slice(),r=[],o,i,n,s;for(o=0,n=a.length;o<n;++o)s=a[o],i=t.indexOf(s),i===-1?r.push([s,1]):t.splice(i,1);for(o=0,n=t.length;o<n;++o)r.push([t[o],-1]);return r},rasterize:function(e){return Math.round(e*ae)/ae}};function Y(e,a){var t=a.x,r=a.y;if(t===null)return{x:0,y:-1};if(r===null)return{x:1,y:0};var o=e.x-t,i=e.y-r,n=Math.sqrt(o*o+i*i);return{x:n?o/n:0,y:n?i/n:-1}}function Qe(e,a,t,r,o){switch(o){case"center":t=r=0;break;case"bottom":t=0,r=1;break;case"right":t=1,r=0;break;case"left":t=-1,r=0;break;case"top":t=0,r=-1;break;case"start":t=-t,r=-r;break;case"end":break;default:o*=Math.PI/180,t=Math.cos(o),r=Math.sin(o);break}return{x:e,y:a,vx:t,vy:r}}var Ze=0,fe=1,ce=2,ve=4,pe=8;function F(e,a,t){var r=Ze;return e<t.left?r|=fe:e>t.right&&(r|=ce),a<t.top?r|=pe:a>t.bottom&&(r|=ve),r}function et(e,a){for(var t=e.x0,r=e.y0,o=e.x1,i=e.y1,n=F(t,r,a),s=F(o,i,a),u,l,d;!(!(n|s)||n&s);)u=n||s,u&pe?(l=t+(o-t)*(a.top-r)/(i-r),d=a.top):u&ve?(l=t+(o-t)*(a.bottom-r)/(i-r),d=a.bottom):u&ce?(d=r+(i-r)*(a.right-t)/(o-t),l=a.right):u&fe&&(d=r+(i-r)*(a.left-t)/(o-t),l=a.left),u===n?(t=l,r=d,n=F(t,r,a)):(o=l,i=d,s=F(o,i,a));return{x0:t,x1:o,y0:r,y1:i}}function L(e,a){var t=a.anchor,r=e,o,i;return a.clamp&&(r=et(r,a.area)),t==="start"?(o=r.x0,i=r.y0):t==="end"?(o=r.x1,i=r.y1):(o=(r.x0+r.x1)/2,i=(r.y0+r.y1)/2),Qe(o,i,e.vx,e.vy,a.align)}var H={arc:function(e,a){var t=(e.startAngle+e.endAngle)/2,r=Math.cos(t),o=Math.sin(t),i=e.innerRadius,n=e.outerRadius;return L({x0:e.x+r*i,y0:e.y+o*i,x1:e.x+r*n,y1:e.y+o*n,vx:r,vy:o},a)},point:function(e,a){var t=Y(e,a.origin),r=t.x*e.options.radius,o=t.y*e.options.radius;return L({x0:e.x-r,y0:e.y-o,x1:e.x+r,y1:e.y+o,vx:t.x,vy:t.y},a)},bar:function(e,a){var t=Y(e,a.origin),r=e.x,o=e.y,i=0,n=0;return e.horizontal?(r=Math.min(e.x,e.base),i=Math.abs(e.base-e.x)):(o=Math.min(e.y,e.base),n=Math.abs(e.base-e.y)),L({x0:r,y0:o+n,x1:r+i,y1:o,vx:t.x,vy:t.y},a)},fallback:function(e,a){var t=Y(e,a.origin);return L({x0:e.x,y0:e.y,x1:e.x+(e.width||0),y1:e.y+(e.height||0),vx:t.x,vy:t.y},a)}},C=R.rasterize;function tt(e){var a=e.borderWidth||0,t=e.padding,r=e.size.height,o=e.size.width,i=-o/2,n=-r/2;return{frame:{x:i-t.left-a,y:n-t.top-a,w:o+t.width+a*2,h:r+t.height+a*2},text:{x:i,y:n,w:o,h:r}}}function rt(e,a){var t=a.chart.getDatasetMeta(a.datasetIndex).vScale;if(!t)return null;if(t.xCenter!==void 0&&t.yCenter!==void 0)return{x:t.xCenter,y:t.yCenter};var r=t.getBasePixel();return e.horizontal?{x:r,y:null}:{x:null,y:r}}function at(e){return e instanceof de?H.arc:e instanceof Ee?H.point:e instanceof De?H.bar:H.fallback}function ot(e,a,t,r,o,i){var n=Math.PI/2;if(i){var s=Math.min(i,o/2,r/2),u=a+s,l=t+s,d=a+r-s,f=t+o-s;e.moveTo(a,l),u<d&&l<f?(e.arc(u,l,s,-Math.PI,-n),e.arc(d,l,s,-n,0),e.arc(d,f,s,0,n),e.arc(u,f,s,n,Math.PI)):u<d?(e.moveTo(u,t),e.arc(d,l,s,-n,n),e.arc(u,l,s,n,Math.PI+n)):l<f?(e.arc(u,l,s,-Math.PI,0),e.arc(u,f,s,0,Math.PI)):e.arc(u,l,s,-Math.PI,Math.PI),e.closePath(),e.moveTo(a,t)}else e.rect(a,t,r,o)}function it(e,a,t){var r=t.backgroundColor,o=t.borderColor,i=t.borderWidth;!r&&(!o||!i)||(e.beginPath(),ot(e,C(a.x)+i/2,C(a.y)+i/2,C(a.w)-i,C(a.h)-i,t.borderRadius),e.closePath(),r&&(e.fillStyle=r,e.fill()),o&&i&&(e.strokeStyle=o,e.lineWidth=i,e.lineJoin="miter",e.stroke()))}function nt(e,a,t){var r=t.lineHeight,o=e.w,i=e.x,n=e.y+r/2;return a==="center"?i+=o/2:(a==="end"||a==="right")&&(i+=o),{h:r,w:o,x:i,y:n}}function st(e,a,t){var r=e.shadowBlur,o=t.stroked,i=C(t.x),n=C(t.y),s=C(t.w);o&&e.strokeText(a,i,n,s),t.filled&&(r&&o&&(e.shadowBlur=0),e.fillText(a,i,n,s),r&&o&&(e.shadowBlur=r))}function lt(e,a,t,r){var o=r.textAlign,i=r.color,n=!!i,s=r.font,u=a.length,l=r.textStrokeColor,d=r.textStrokeWidth,f=l&&d,g;if(!(!u||!n&&!f))for(t=nt(t,o,s),e.font=s.string,e.textAlign=o,e.textBaseline="middle",e.shadowBlur=r.textShadowBlur,e.shadowColor=r.textShadowColor,n&&(e.fillStyle=i),f&&(e.lineJoin="round",e.lineWidth=d,e.strokeStyle=l),g=0,u=a.length;g<u;++g)st(e,a[g],{stroked:f,filled:n,w:t.w,x:t.x,y:t.y+t.h*g})}var he=function(e,a,t,r){var o=this;o._config=e,o._index=r,o._model=null,o._rects=null,o._ctx=a,o._el=t};j(he.prototype,{_modelize:function(e,a,t,r){var o=this,i=o._index,n=Ae(p([t.font,{}],r,i)),s=p([t.color,Be.color],r,i);return{align:p([t.align,"center"],r,i),anchor:p([t.anchor,"center"],r,i),area:r.chart.chartArea,backgroundColor:p([t.backgroundColor,null],r,i),borderColor:p([t.borderColor,null],r,i),borderRadius:p([t.borderRadius,0],r,i),borderWidth:p([t.borderWidth,0],r,i),clamp:p([t.clamp,!1],r,i),clip:p([t.clip,!1],r,i),color:s,display:e,font:n,lines:a,offset:p([t.offset,4],r,i),opacity:p([t.opacity,1],r,i),origin:rt(o._el,r),padding:Ve(p([t.padding,4],r,i)),positioner:at(o._el),rotation:p([t.rotation,0],r,i)*(Math.PI/180),size:R.textSize(o._ctx,a,n),textAlign:p([t.textAlign,"start"],r,i),textShadowBlur:p([t.textShadowBlur,0],r,i),textShadowColor:p([t.textShadowColor,s],r,i),textStrokeColor:p([t.textStrokeColor,s],r,i),textStrokeWidth:p([t.textStrokeWidth,0],r,i)}},update:function(e){var a=this,t=null,r=null,o=a._index,i=a._config,n,s,u,l=p([i.display,!0],e,o);l&&(n=e.dataset.data[o],s=Te(ue(i.formatter,[n,e]),n),u=D(s)?[]:R.toTextLines(s),u.length&&(t=a._modelize(l,u,i,e),r=tt(t))),a._model=t,a._rects=r},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(e,a){var t=this,r=e.ctx,o=t._model,i=t._rects,n;this.visible()&&(r.save(),o.clip&&(n=o.area,r.beginPath(),r.rect(n.left,n.top,n.right-n.left,n.bottom-n.top),r.clip()),r.globalAlpha=R.bound(0,o.opacity,1),r.translate(C(a.x),C(a.y)),r.rotate(o.rotation),it(r,i.frame,o),lt(r,o.lines,i.text,o),r.restore())}});var ut=Number.MIN_SAFE_INTEGER||-9007199254740991,dt=Number.MAX_SAFE_INTEGER||9007199254740991;function E(e,a,t){var r=Math.cos(t),o=Math.sin(t),i=a.x,n=a.y;return{x:i+r*(e.x-i)-o*(e.y-n),y:n+o*(e.x-i)+r*(e.y-n)}}function oe(e,a){var t=dt,r=ut,o=a.origin,i,n,s,u,l;for(i=0;i<e.length;++i)n=e[i],s=n.x-o.x,u=n.y-o.y,l=a.vx*s+a.vy*u,t=Math.min(t,l),r=Math.max(r,l);return{min:t,max:r}}function U(e,a){var t=a.x-e.x,r=a.y-e.y,o=Math.sqrt(t*t+r*r);return{vx:(a.x-e.x)/o,vy:(a.y-e.y)/o,origin:e,ln:o}}var ye=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};j(ye.prototype,{center:function(){var e=this._rect;return{x:e.x+e.w/2,y:e.y+e.h/2}},update:function(e,a,t){this._rotation=t,this._rect={x:a.x+e.x,y:a.y+e.y,w:a.w,h:a.h}},contains:function(e){var a=this,t=1,r=a._rect;return e=E(e,a.center(),-a._rotation),!(e.x<r.x-t||e.y<r.y-t||e.x>r.x+r.w+t*2||e.y>r.y+r.h+t*2)},intersects:function(e){var a=this._points(),t=e._points(),r=[U(a[0],a[1]),U(a[0],a[3])],o,i,n;for(this._rotation!==e._rotation&&r.push(U(t[0],t[1]),U(t[0],t[3])),o=0;o<r.length;++o)if(i=oe(a,r[o]),n=oe(t,r[o]),i.max<n.min||n.max<i.min)return!1;return!0},_points:function(){var e=this,a=e._rect,t=e._rotation,r=e.center();return[E({x:a.x,y:a.y},r,t),E({x:a.x+a.w,y:a.y},r,t),E({x:a.x+a.w,y:a.y+a.h},r,t),E({x:a.x,y:a.y+a.h},r,t)]}});function me(e,a,t){var r=a.positioner(e,a),o=r.vx,i=r.vy;if(!o&&!i)return{x:r.x,y:r.y};var n=t.w,s=t.h,u=a.rotation,l=Math.abs(n/2*Math.cos(u))+Math.abs(s/2*Math.sin(u)),d=Math.abs(n/2*Math.sin(u))+Math.abs(s/2*Math.cos(u)),f=1/Math.max(Math.abs(o),Math.abs(i));return l*=o*f,d*=i*f,l+=a.offset*o,d+=a.offset*i,{x:r.x+l,y:r.y+d}}function ft(e,a){var t,r,o,i;for(t=e.length-1;t>=0;--t)for(o=e[t].$layout,r=t-1;r>=0&&o._visible;--r)i=e[r].$layout,i._visible&&o._box.intersects(i._box)&&a(o,i);return e}function ct(e){var a,t,r,o,i,n,s;for(a=0,t=e.length;a<t;++a)r=e[a],o=r.$layout,o._visible&&(s=new Proxy(r._el,{get:(u,l)=>u.getProps([l],!0)[l]}),i=r.geometry(),n=me(s,r.model(),i),o._box.update(n,i,r.rotation()));return ft(e,function(u,l){var d=u._hidable,f=l._hidable;d&&f||f?l._visible=!1:d&&(u._visible=!1)})}var W={prepare:function(e){var a=[],t,r,o,i,n;for(t=0,o=e.length;t<o;++t)for(r=0,i=e[t].length;r<i;++r)n=e[t][r],a.push(n),n.$layout={_box:new ye,_hidable:!1,_visible:!0,_set:t,_idx:n._index};return a.sort(function(s,u){var l=s.$layout,d=u.$layout;return l._idx===d._idx?d._set-l._set:d._idx-l._idx}),this.update(a),a},update:function(e){var a=!1,t,r,o,i,n;for(t=0,r=e.length;t<r;++t)o=e[t],i=o.model(),n=o.$layout,n._hidable=i&&i.display==="auto",n._visible=o.visible(),a|=n._hidable;a&&ct(e)},lookup:function(e,a){var t,r;for(t=e.length-1;t>=0;--t)if(r=e[t].$layout,r&&r._visible&&r._box.contains(a))return e[t];return null},draw:function(e,a){var t,r,o,i,n,s;for(t=0,r=a.length;t<r;++t)o=a[t],i=o.$layout,i._visible&&(n=o.geometry(),s=me(o._el,o.model(),n),i._box.update(s,n,o.rotation()),o.draw(e,s))}},vt=function(e){if(D(e))return null;var a=e,t,r,o;if(Re(e))if(!D(e.label))a=e.label;else if(!D(e.r))a=e.r;else for(a="",t=Object.keys(e),o=0,r=t.length;o<r;++o)a+=(o!==0?", ":"")+t[o]+": "+e[t[o]];return""+a},pt={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:vt,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},_="$datalabels",_e="$default";function ht(e,a){var t=e.datalabels,r={},o=[],i,n;return t===!1?null:(t===!0&&(t={}),a=j({},[a,t]),i=a.labels||{},n=Object.keys(i),delete a.labels,n.length?n.forEach(function(s){i[s]&&o.push(j({},[a,i[s],{_key:s}]))}):o.push(a),r=o.reduce(function(s,u){return We(u.listeners||{},function(l,d){s[d]=s[d]||{},s[d][u._key||_e]=l}),delete u.listeners,s},{}),{labels:o,listeners:r})}function q(e,a,t,r){if(a){var o=t.$context,i=t.$groups,n;a[i._set]&&(n=a[i._set][i._key],n&&ue(n,[o,r])===!0&&(e[_]._dirty=!0,t.update(o)))}}function yt(e,a,t,r,o){var i,n;!t&&!r||(t?r?t!==r&&(n=i=!0):n=!0:i=!0,n&&q(e,a.leave,t,o),i&&q(e,a.enter,r,o))}function mt(e,a){var t=e[_],r=t._listeners,o,i;if(!(!r.enter&&!r.leave)){if(a.type==="mousemove")i=W.lookup(t._labels,a);else if(a.type!=="mouseout")return;o=t._hovered,t._hovered=i,yt(e,r,o,i,a)}}function _t(e,a){var t=e[_],r=t._listeners.click,o=r&&W.lookup(t._labels,a);o&&q(e,r,o,a)}var bt={id:"datalabels",defaults:pt,beforeInit:function(e){e[_]={_actives:[]}},beforeUpdate:function(e){var a=e[_];a._listened=!1,a._listeners={},a._datasets=[],a._labels=[]},afterDatasetUpdate:function(e,a,t){var r=a.index,o=e[_],i=o._datasets[r]=[],n=e.isDatasetVisible(r),s=e.data.datasets[r],u=ht(s,t),l=a.meta.data||[],d=e.ctx,f,g,B,V,w,$,x,k;for(d.save(),f=0,B=l.length;f<B;++f)if(x=l[f],x[_]=[],n&&x&&e.getDataVisibility(f)&&!x.skip)for(g=0,V=u.labels.length;g<V;++g)w=u.labels[g],$=w._key,k=new he(w,d,x,f),k.$groups={_set:r,_key:$||_e},k.$context={active:!1,chart:e,dataIndex:f,dataset:s,datasetIndex:r},k.update(k.$context),x[_].push(k),i.push(k);d.restore(),j(o._listeners,u.listeners,{merger:function(z,K,be){K[z]=K[z]||{},K[z][a.index]=be[z],o._listened=!0}})},afterUpdate:function(e){e[_]._labels=W.prepare(e[_]._datasets)},afterDatasetsDraw:function(e){W.draw(e,e[_]._labels)},beforeEvent:function(e,a){if(e[_]._listened){var t=a.event;switch(t.type){case"mousemove":case"mouseout":mt(e,t);break;case"click":_t(e,t);break}}},afterEvent:function(e){var a=e[_],t=a._actives,r=a._actives=e.getActiveElements(),o=R.arrayDiff(t,r),i,n,s,u,l,d,f;for(i=0,n=o.length;i<n;++i)if(l=o[i],l[1])for(f=l[0].element[_]||[],s=0,u=f.length;s<u;++s)d=f[s],d.$context.active=l[1]===1,d.update(d.$context);(a._dirty||o.length)&&(W.update(a._labels),e.render()),delete a._dirty}};const gt="bold",xt=N({__name:"DevicePowerDistributionCard",props:{devices:{},power:{},selfSufficiency:{}},setup(e){const a=Ce(),t={id:"doughnutlabel",beforeDraw:(n,s,u)=>{const{ctx:l}=n;l.save(),l.globalCompositeOperation="destination-over";var d=n.chartArea.width,f=n.chartArea.height;l.font="1.2em sans-serif",l.fillStyle=u.color;const g=2;l.textBaseline="top";let B=0;for(let w=0;w<u.text.length;w++){const $=u.text[w],x=l.measureText($);B+=(x.actualBoundingBoxAscent+x.actualBoundingBoxDescent)*g}let V=n.chartArea.top+(f-B)/2;for(let w=0;w<u.text.length;w++){const $=u.text[w],x=l.measureText($),k=n.chartArea.left+Math.round((d-x.width)/2);l.fillText($,k,V),V+=(x.actualBoundingBoxAscent+x.actualBoundingBoxDescent)*g}l.restore()},defaults:{text:[],color:"black"}},r=J(()=>{const n=i.devices.filter(s=>s.power>0);return{labels:n.map(s=>Q.getDeviceInfo(s.device_id).name),datasets:[{data:n.map(s=>s.power)}]}}),o=J(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",labels:{color:a.current.value.colors["on-surface"]}},tooltip:{callbacks:{label:n=>`${S(n.parsed,"W")}`}},doughnutlabel:{color:a.current.value.colors["on-surface"],text:[S(i.power,"W"),i.selfSufficiency.toFixed(0)+"%"]},datalabels:{backgroundColor:function(n){return n.dataset.backgroundColor},borderColor:"white",borderRadius:25,borderWidth:2,color:"white",display:function(n){var s=n.dataset;const u=s.data.reduce((d,f)=>d+f,0);var l=s.data[n.dataIndex];return l>u/10},font:{weight:gt},padding:6,formatter:Math.round}}}));je.register(de,Ne,ze,Oe,t,bt);const i=e;return(n,s)=>(b(),A(ee,{class:"elevation-2 ma-4 pa-4 card-fixed-width"},{default:v(()=>[c(Z,null,{default:v(()=>[c(y(Fe),{data:r.value,options:o.value},null,8,["data","options"])]),_:1})]),_:1}))}}),wt={class:"bg-subgroup pa-2 mt-2 items-center rounded-md"},kt={class:"text-left"},Mt={class:"float-right"},Ct={class:"pa-2 bg-subgroup mt-2 items-center rounded-md"},Pt={class:"text-left"},St={class:"float-right"},It={class:"pa-2 bg-subgroup mt-2 items-center rounded-md"},$t={class:"text-left"},Tt={class:"float-right"},At={class:"pa-2 bg-subgroup mt-2 items-center rounded-md"},Bt={class:"text-left"},Vt={class:"float-right"},Et=N({__name:"ConsumptionCard",props:{selfSufficiency:{},selfConsumption:{},selfSufficiencyToday:{},selfConsumptionToday:{}},setup(e){return(a,t)=>(b(),A(ee,{class:"elevation-2 ma-4 pa-4 card-fixed-width"},{default:v(()=>[c(se,null,{default:v(()=>[P(m(y(M)("consumption")),1)]),_:1}),c(Z,null,{default:v(()=>[h("div",wt,[h("div",kt,[P(m(y(M)("self_sufficiency"))+" ",1),h("span",Mt,m(y(S)(a.selfSufficiency,"%")),1)]),c(O,{color:"sun",height:"15",rounded:"","model-value":a.selfSufficiency},null,8,["model-value"])]),h("div",Ct,[h("div",Pt,[P(m(y(M)("self_consumption"))+" ",1),h("span",St,m(y(S)(a.selfConsumption,"%")),1)]),c(O,{color:"grid",height:"15",rounded:"","model-value":a.selfConsumption},null,8,["model-value"])]),h("div",null,m(y(M)("period.today"))+":",1),h("div",It,[h("div",$t,[P(m(y(M)("self_sufficiency"))+" ",1),h("span",Tt,m(y(S)(a.selfSufficiencyToday,"%")),1)]),c(O,{color:"sun",height:"15",rounded:"","model-value":a.selfSufficiencyToday},null,8,["model-value"])]),h("div",At,[h("div",Bt,[P(m(y(M)("self_consumption"))+" ",1),h("span",Vt,m(y(S)(a.selfConsumptionToday,"%")),1)]),c(O,{color:"grid",height:"15",rounded:"","model-value":a.selfConsumptionToday},null,8,["model-value"])])]),_:1})]),_:1}))}}),Dt={class:"d-flex min-height-screen w-100 justify-center"},Rt={key:0,class:"d-flex w-100 justify-center pa-4"},Wt={key:1},or=N({__name:"Home",setup(e){const a=J(()=>re.home),t=J(()=>re.state.connected);return(r,o)=>(b(),T("div",null,[c(Le,{color:"transparent",title:a.value.name},null,8,["title"]),c(He),h("div",Dt,[t.value?(b(),T("div",Wt,[c(le,{class:"bg-background pa-4"},{default:v(()=>[c(X,null,{default:v(()=>[c(I,{cols:"12",lg:"6",class:"d-flex justify-center align-center"},{default:v(()=>[c(Se,{"home-consumption-power":a.value.power.home_consumption,"solar-power":a.value.power.solar_production,unit:"W"},null,8,["home-consumption-power","solar-power"])]),_:1}),c(I,{cols:"12",lg:"6",class:"d-flex justify-center align-center"},{default:v(()=>[c(xt,{devices:a.value.devices,power:a.value.power.home_consumption,"self-sufficiency":a.value.power.self_sufficiency},null,8,["devices","power","self-sufficiency"])]),_:1}),c(I,{cols:"12",lg:"6",class:"d-flex justify-center align-center"},{default:v(()=>[c(Et,{"self-sufficiency":a.value.power.self_sufficiency,"self-consumption":a.value.power.self_consumption,"self-sufficiency-today":a.value.today.self_sufficiency,"self-consumption-today":a.value.today.self_consumption},null,8,["self-sufficiency","self-consumption","self-sufficiency-today","self-consumption-today"])]),_:1}),(b(!0),T(ie,null,ne(a.value.devices,(i,n)=>(b(),A(I,{key:n,cols:"12",lg:"6",class:"d-flex justify-center align-center"},{default:v(()=>[c(qe,{device:y(Q).getDeviceInfo(i.device_id),available:i.available,power:i.power,today:i.today,attributes:i.attributes},null,8,["device","available","power","today","attributes"])]),_:2},1024))),128))]),_:1})]),_:1})])):(b(),T("div",Rt,[c(Ue,{indeterminate:"",color:"primary"})]))])]))}});export{or as default};
