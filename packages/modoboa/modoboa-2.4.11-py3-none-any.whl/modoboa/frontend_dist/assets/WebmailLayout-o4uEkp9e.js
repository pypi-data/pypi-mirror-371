import{k as ne,Q as A,R as se,M as G,p as X,g as u,L as j,r as ie,m as M,o as m,F as O,G as re,J as E,e as L,c as D,n as T,a,f as g,t as U,q as K,b as W,h as F,w as f,j as P,s as ue}from"./index-I1VDlN4g.js";import{u as me}from"./logos-q8SEyAa4.js";import{_ as de}from"./ConfirmDialog-BBcgdAnO.js";import{_ as ce,V as pe}from"./ConnectedLayout-1oRW-Rql.js";import{a as _}from"./webmail-CSH_3l6R.js";import{d as H,V as N,e as ve,p as fe}from"./VAvatar-Lpb-Dion.js";import{V as J}from"./VSpacer-C7xukQmu.js";import{V as be,r as xe}from"./VForm-DAkW4nfy.js";import{V as ge,b as ye,a as Me}from"./VCard-er_isjE_.js";import{V as Ve}from"./VTextField-BdyvgvkG.js";import{V as _e}from"./VDialog-Bk6EWNhz.js";import{V as he}from"./VMenu-BPFJwj2f.js";import{V as Ce,a as R}from"./forwardRefs-Dvjn_Xq4.js";import"./VToolbar-BiCiBxBJ.js";import"./tag-BnSYRTcD.js";import"./VProgressCircular-w75-3ogi.js";import"./VContainer-DvTbsotR.js";/* empty css              */import"./VApp-CpkYA7js.js";import"./layout-D8ZJPiJ_.js";import"./ssrBoot-AzTdjPjk.js";import"./global.store-BaiD63EN.js";import"./admin-o-HRGnmT.js";import"./layout.store-DkjrAoXt.js";import"./VRow-BF35mT1S.js";import"./VSheet-Btq_Mu4s.js";const we=["onClick","onMouseover","onMouseleave"],ke={key:0,class:"font-weight-bold"},Ue={key:1},$e={key:0,class:"font-weight-bold"},Be={key:1},Le={__name:"MailboxList",props:A({mailboxes:{type:Array,default:null},lightMode:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},unseenCounters:{type:Boolean,default:!0},allowUnselect:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:A(["update:modelValue"],["update:modelValue"]),setup(S,{emit:y}){const t=S,n=se(S,"modelValue"),i=y,V=G(),r=X(),$={inbox:"mdi-inbox",draft:"mdi-file",junk:"mdi-fire",sent:"mdi-email-fast-outline",trash:"mdi-trash-can-outline",normal:"mdi-folder-outline"},d=u(null),h=u({}),c=u({});function b(e){return e.label.split("/").pop()}function B(e){return d.value===null&&(d.value=e.unseen),d.value}function s(e,C){h.value[e.name]=C}function o(e){return n.value===e.name?"bg-primary-lighten-1":t.lightMode?h.value[e.name]?"bg-primary":"bg-white":h.value[e.name]?"bg-primary-lighten-1":"bg-primary"}function p(e){return c.value[e.name]}function q(e){c.value[e.name]||(c.value[e.name]=!1),c.value[e.name]=!c.value[e.name],c.value[e.name]&&!e.sub.length&&_.getUserMailboxes(e.name).then(C=>{e.sub=C.data.mailboxes})}function I(e){t.allowUnselect&&e===n.value?i("update:modelValue",null):i("update:modelValue",e)}return j(()=>r.mbCounterKey,()=>{_.getUserMailboxUnseen(V.query.mailbox).then(e=>{d.value=e.data.counter})}),(e,C)=>{const Q=ie("MailboxList",!0);return m(),M("div",null,[(m(!0),M(O,null,re(t.mailboxes,l=>(m(),M("div",{key:l.name,class:E(["pl-3 text-body-2",{"py-1":!t.compact}])},[L("div",{class:E([o(l),"d-flex mailbox pa-1 align-center"]),onClick:w=>I(l.name),onMouseover:w=>s(l,!0),onMouseleave:w=>s(l,!1)},[a(H,{icon:$[l.type],class:"mr-4"},null,8,["icon"]),l.name===g(V).query.mailbox?(m(),M(O,{key:0},[d.value>0?(m(),M("span",ke,U(b(l))+" ("+U(B(l))+") ",1)):(m(),M("span",Ue,U(b(l)),1))],64)):(m(),M(O,{key:1},[l.unseen>0?(m(),M("span",$e,U(b(l))+" ("+U(l.unseen)+") ",1)):(m(),M("span",Be,U(b(l)),1))],64)),a(J),l.sub?(m(),D(N,{key:2,icon:p(l)?"mdi-minus":"mdi-plus",size:"xsmall",variant:"flat",color:"transparent",onClick:K(w=>q(l),["stop"])},null,8,["icon","onClick"])):T("",!0)],42,we),p(l)&&l.sub&&l.sub.length?(m(),D(Q,{key:0,modelValue:n.value,"onUpdate:modelValue":C[0]||(C[0]=w=>n.value=w),mailboxes:l.sub,class:"mt-1","light-mode":t.lightMode,compact:t.compact},null,8,["modelValue","mailboxes","light-mode","compact"])):T("",!0)],2))),128))])}}},Y=ne(Le,[["__scopeId","data-v-62d5beb0"]]),Ne={class:"mb-2 rounded-lg"},Se={__name:"MailboxForm",props:{userMailboxes:Array,mailbox:{type:String,default:null},hdelimiter:{type:String,default:null}},emits:["close","mailboxRenamed"],setup(S,{emit:y}){const t=S,n=y,{$gettext:i}=W(),{displayNotification:V}=X(),r=u({}),$=u(),d=u(!1),h=F(()=>t.mailbox?i("Edit mailbox"):i("Create new mailbox")),c=F(()=>t.mailbox?i("Update"):i("Create")),b=()=>{r.value={},n("close")},B=async()=>{const{valid:s}=await $.value.validate();if(s){d.value=!0;try{const o={...r.value};t.mailbox?(o.oldname=t.mailbox,await _.renameUserMailbox(o),V({msg:i("Mailbox renamed")}),n("mailboxRenamed",`${o.parent_mailbox}${t.hdelimiter}${o.name}`)):(await _.createUserMailbox(o),V({msg:i("Mailbox created")})),b()}finally{d.value=!1}}};return j(()=>t.mailbox,s=>{if(s){const o=t.mailbox.split(t.hdelimiter);r.value.name=o.slice(-1)[0],r.value.parent_mailbox=o.slice(0,-1).join(t.hdelimiter)}else r.value={}},{immediate:!0}),(s,o)=>(m(),D(Me,{title:h.value},{default:f(()=>[a(ge,null,{default:f(()=>[a(be,{ref_key:"formRef",ref:$},{default:f(()=>[a(Ve,{modelValue:r.value.name,"onUpdate:modelValue":o[0]||(o[0]=p=>r.value.name=p),label:g(i)("Name"),variant:"outlined",density:"compact",rules:[g(xe).required]},null,8,["modelValue","label","rules"]),L("div",Ne,[L("h4",null,U(g(i)("Parent mailbox")),1),a(Y,{modelValue:r.value.parent_mailbox,"onUpdate:modelValue":o[1]||(o[1]=p=>r.value.parent_mailbox=p),"active-mailbox":t.parent,mailboxes:t.userMailboxes,"light-mode":"",compact:"","unseen-counters":!1,"allow-unselect":""},null,8,["modelValue","active-mailbox","mailboxes"])])]),_:1},512)]),_:1}),a(ye,null,{default:f(()=>[a(J),a(N,{text:g(i)("Close"),variant:"flat",loading:d.value,onClick:b},null,8,["text","loading"]),a(N,{text:c.value,variant:"tonal",color:"primary",loading:d.value,onClick:B},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},qe={class:"d-flex align-center"},Fe={class:"d-flex justify-center mb-4"},Ie={class:"border-t-sm d-flex align-center bg-grey"},ra={__name:"WebmailLayout",async setup(S){let y,t;const{$gettext:n}=W(),i=G(),V=ue(),r=X(),{menuLogoPath:$}=me(),d=u(),h=u(!0),c=u(!1),b=u(null),B=u(null),s=u(null),o=u(i.query.mailbox||"INBOX"),p=u(!1),q=u([]),I=F(()=>["INBOX"].includes(i.query.mailbox||"INBOX")),e=F(()=>s.value.usage<50?"info":s.value.usage<80?"warning":"error"),C=F(()=>`${s.value.current} / ${s.value.limit} (${s.value.usage}%)`);function Q(x){V.push({name:"MailboxView",query:{mailbox:x}}),_.getUserMailboxQuota(x).then(v=>{s.value=v.data})}const l=async()=>{const x=await _.getUserMailboxes();q.value=x.data.mailboxes,B.value=x.data.hdelimiter},w=()=>{V.push({name:"ComposeEmailView"})},Z=()=>{p.value=!1,b.value=null,l()},ee=()=>{p.value=!0},ae=()=>{b.value=o.value,p.value=!0},z=x=>{o.value=x,V.push({name:"MailboxView",query:{mailbox:x}})},le=async()=>{await _.compressUserMailbox({name:o.value}),r.displayNotification({msg:n("Mailbox compressed")})},te=async()=>{await d.value.open(n("Warning"),n("Delete this mailbox?"),{color:"warning",agreeLabel:n("Yes"),cancelLabel:n("No")})&&(await _.deleteUserMailbox({name:o.value}),r.displayNotification({msg:n("Mailbox deleted")}),z("INBOX"))};j(()=>r.dataKey,()=>{l()}),[y,t]=P(()=>l()),await y,t();const oe=([y,t]=P(()=>_.getUserMailboxQuota(i.query.mailbox||"INBOX")),y=await y,t(),y);return s.value=oe.data,(x,v)=>(m(),M(O,null,[a(ce,null,{navbar:f(()=>[a(pe,{modelValue:h.value,"onUpdate:modelValue":v[2]||(v[2]=k=>h.value=k),rail:c.value,permanent:"",color:"primary",app:""},{prepend:f(()=>[L("div",qe,[a(fe,{src:g($),"max-width":"190",class:"logo"},null,8,["src"]),a(N,{icon:c.value?"mdi-chevron-right":"mdi-chevron-left",variant:"text",onClick:v[0]||(v[0]=K(k=>c.value=!c.value,["stop"]))},null,8,["icon"])]),L("div",Fe,[a(N,{text:g(n)("Compose"),color:"secondary",variant:"flat","prepend-icon":"mdi-pencil",onClick:w},null,8,["text"])])]),append:f(()=>[L("div",Ie,[a(N,{class:"ml-2",variant:"text",icon:"",size:"small"},{default:f(()=>[a(H,{icon:"mdi-cog"}),a(he,{activator:"parent"},{default:f(()=>[a(Ce,{density:"compact"},{default:f(()=>[a(R,{title:g(n)("Create a new mailbox"),"prepend-icon":"mdi-plus",onClick:ee},null,8,["title"]),a(R,{title:g(n)("Edit this mailbox"),"prepend-icon":"mdi-pencil",disabled:I.value,onClick:ae},null,8,["title","disabled"]),a(R,{title:g(n)("Delete this mailbox"),"prepend-icon":"mdi-trash-can",disabled:I.value,onClick:te},null,8,["title","disabled"]),a(R,{title:g(n)("Compress this mailbox"),"prepend-icon":"mdi-folder-zip-outline",onClick:le},null,8,["title"])]),_:1})]),_:1})]),_:1}),s.value?(m(),D(ve,{key:0,color:e.value,"model-value":s.value.usage,title:C.value},null,8,["color","model-value","title"])):T("",!0)])]),default:f(()=>[a(Y,{modelValue:o.value,"onUpdate:modelValue":[v[1]||(v[1]=k=>o.value=k),Q],mailboxes:q.value,class:"mr-2"},null,8,["modelValue","mailboxes"])]),_:1},8,["modelValue","rail"])]),_:1}),a(_e,{modelValue:p.value,"onUpdate:modelValue":v[4]||(v[4]=k=>p.value=k),"max-width":"800"},{default:f(()=>[a(Se,{"user-mailboxes":q.value,mailbox:b.value,hdelimiter:B.value,onMailboxRenamed:z,onClose:v[3]||(v[3]=k=>Z())},null,8,["user-mailboxes","mailbox","hdelimiter"])]),_:1},8,["modelValue"]),a(de,{ref_key:"confirm",ref:d},null,512)],64))}};export{ra as default};
